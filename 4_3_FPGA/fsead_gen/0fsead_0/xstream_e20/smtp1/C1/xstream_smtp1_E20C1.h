#ifndef XSTREAM_GENERATOR_1_H_
#define XSTREAM_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void xstream_smtp1_c1(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_xstream
);
    
#define ENSEMBLE 140
#define DIM_MAX 3
#define BATCH_SIZE 128
#define K_NUM 20
#define HASH_NUM 2
#define MATRIX_COL 128
const static param_t bottom_xstream = -7.908198388578782;
const static param_t delta_xstream = 0.1447555417130586;

static param_t xstream_fs[20][2] = {{9,2},
{6,13},
{1,6},
{10,15},
{5,16},
{0,7},
{4,16},
{10,7},
{11,6},
{6,13},
{16,11},
{16,11},
{8,17},
{8,12},
{17,11},
{12,16},
{19,19},
{19,7},
{6,18},
{16,14}};

static param_t xstream_R_T[3][20] = {{0.0,0.0,0.38729833462074165,-0.38729833462074165,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.0,0.0,0.0,0.38729833462074165,0.38729833462074165,0.0,-0.38729833462074165,0.0,0.0,0.0},
{0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.0,0.38729833462074165,0.0,-0.38729833462074165,0.0,-0.38729833462074165,-0.38729833462074165,0.38729833462074165,0.0,0.38729833462074165},
{-0.38729833462074165,0.0,0.0,0.0,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.38729833462074165,-0.38729833462074165,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,-0.38729833462074165}};

static param_t xstream_deltamax[20] = {0.39105317842609216,1.0,0.24811202011695074,0.5663290447231158,1.0,1.0,0.24811202011695074,0.39105317842609216,1.0,1.0,0.39105317842609216,0.28774244127026105,1.0,0.27401342464691647,0.5663290447231158,0.28774244127026105,0.24811202011695074,0.35045884862783616,1.0,0.28774244127026105};

static param_t xstream_shift_deltamax[20][20] = {{-0.6818615155975541,-0.7693282477248182,-0.10514406644897512,-0.430979478695402,-0.9001001604983179,-0.48531595280247763,-0.25492773728504314,-0.9799502739586401,-0.6336712741528177,-0.30982314365337194,-0.10316095393892788,-0.5478046091941539,-0.2199684837463265,-0.3319598705679111,-0.17997016671162347,-0.13073272423154925,-0.36775822929754876,-0.4276962280004743,-0.497070065087286,-0.43126069466837436},
{-0.8403560167304331,-0.7148905976944997,-0.6124450387645793,-0.880267960337395,-0.9955939376515975,-0.7161319147946266,-0.7804621753495704,-0.3754158307151464,-0.031028625198245674,-0.24819945660439058,-0.6340135819747696,-0.5764742384575344,-0.1010884176986161,-0.6785563709722228,-0.3352963186330925,-0.9580959094157407,-0.32377858145811056,-0.7602094600818724,-0.9451301357517548,-0.7579448377356276},
{-0.7955562923157422,-0.44384230770934596,-0.495212706506438,-0.6499608734586975,-0.687017548103478,-0.26640565156031637,-0.10906696515422942,-0.6203908982741925,-0.9379320296982837,-0.1763005512798118,-0.6916127187425174,-0.7157094149342919,-0.6210174237051526,-0.27952344852230515,-0.856971227853318,-0.6934981118387611,-0.9181440438822228,-0.5011223006850996,-0.0621909364944474,-0.7063585516322843},
{-0.8031071620301317,-0.14645052597594788,-0.3542232071843021,-0.3885692622383483,-0.46835058019361187,-0.9580463394266725,-0.5478270276584069,-0.7506513594223821,-0.5053506495630762,-0.33281793605560506,-0.6889657329103989,-0.5653654142095031,-0.13282638674969072,-0.9317083507456088,-0.8670671853863066,-0.5757316599686433,-0.36279978717968864,-0.8485694579958122,-0.3012977108833784,-0.9534048178103733},
{-0.36097592364313713,-0.18166662672842138,-0.5198613400152329,-0.916539058218522,-0.4277478384035236,-0.9357602374672985,-0.6839240241992156,-0.10870184801450267,-0.20581753028319894,-0.6821935749579704,-0.2735445830441954,-0.6801558312712641,-0.07619606302863269,-0.8303059509414172,-0.7972310601505183,-0.14196852953164385,-0.35210250958265377,-0.32347157527423687,-0.9281389923398352,-0.8838529289698726},
{-0.9114756352850718,-0.5399684157251773,-0.9402023504264089,-0.3950403757593671,-0.5977429446874363,-0.21475591878005962,-0.7486236129067604,-0.07337900169209,-0.15611628602593486,-0.16318133033163307,-0.53025469574822,-0.3284414548931186,-0.4622785482966597,-0.4921263625599158,-0.38270568930315796,-0.17983275548119293,-0.6178825836877676,-0.28950937866293613,-0.33787859982518886,-0.28592339189081395},
{-0.5308617556340468,-0.2421993206518963,-0.7399713698552915,-0.5151230879026264,-0.7265122748535441,-0.002146971927819985,-0.11099785337037471,-0.16749678165073179,-0.5195105894142164,-0.43706797293232535,-0.2387931683820119,-0.38285217387416914,-0.3049248371291825,-0.5747795001628555,-0.6863075744195037,-0.8850029352484512,-0.726989646304913,-0.37549897866622406,-0.07328535544662595,-0.8627500529904608},
{-0.6045956167085429,-0.3313404337663388,-0.9396479252376692,-0.32255540091621293,-0.8798540821143667,-0.10727692040890824,-0.6429499682108412,-0.8377882088244357,-0.803439117354976,-0.699276521260818,-0.12938345336214474,-0.13821379943641854,-0.13444109685165018,-0.2768300413050613,-0.24057506623295255,-0.5398101699561929,-0.2986408505016873,-0.9772275484160254,-0.7889214689475607,-0.4147161897422741},
{-0.016389544200836936,-0.48909607890189477,-0.2869779442865379,-0.3897926171198489,-0.35413689597768183,-0.43894524457717454,-0.06995901407021188,-0.32882099674741627,-0.4966515858739732,-0.07426894200847334,-0.5956066226387325,-0.8733101177219709,-0.22033036265318595,-0.16136706823487365,-0.5975536030707284,-0.0067945621824548885,-0.0021457227589262162,-0.03719846543772065,-0.8353853224662192,-0.7363864303767921},
{-0.7292978446341819,-0.6810780348482286,-0.7884893697072376,-0.4212867903568185,-0.9484695646226381,-0.9102445213757036,-0.9127311842380181,-0.3379794765874008,-0.22822573517743883,-0.43565141660271034,-0.39971973431875096,-0.381756339564607,-0.6870205308665444,-0.4319341430932476,-0.3503416702451919,-0.46833466169663,-0.0738341867990645,-0.917743862164017,-0.8727062309006143,-0.9734546547041572},
{-0.04257957916379118,-0.4922203873930957,-0.21286322257440693,-0.4380069895213794,-0.4407970513692546,-0.7421932434205993,-0.19727707775111458,-0.46309018887819065,-0.5754327977886257,-0.874035931929343,-0.6619864927015884,-0.0943256733941058,-0.36355135277935435,-0.835956811797195,-0.013137364636899294,-0.04969084647195399,-0.20233622133578333,-0.9405591961025238,-0.35146250913829813,-0.5978886144882416},
{-0.4025324871020267,-0.5266430316295095,-0.7469415891007025,-0.4275973761610551,-0.08551688446296224,-0.6862406929615544,-0.7335650001577759,-0.9639940142266652,-0.9407065938476001,-0.21181807864087465,-0.3305352583213138,-0.17522230925834903,-0.11746178443985444,-0.04104360959068232,-0.5785543322794624,-0.40805234341254126,-0.19142569119096842,-0.5561175321979589,-0.08467471278774308,-0.16527340967159243},
{-0.5781892784317063,-0.957010942808168,-0.33607025660951195,-0.8005550996125242,-0.674952796504497,-0.12361490904864747,-0.04031583258431626,-0.9936141274227289,-0.5290493241863669,-0.11366345841721892,-0.4340900964649577,-0.3698498139705223,-0.45290396031049307,-0.020500380019228936,-0.926368788126595,-0.5989259733483951,-0.9648355209435332,-0.37493304790055815,-0.5904542115801366,-0.15574590171727132},
{-0.4828220628262999,-0.48168565071853897,-0.19812178871102992,-0.01615185941540276,-0.09736808056506285,-0.047489297943353215,-0.49203582590086925,-0.5460829285015323,-0.9635317217804625,-0.7436953626910051,-0.47403989737209085,-0.5315387061100633,-0.8150144658608415,-0.7431933010611567,-0.9022731427825332,-0.1449454283846091,-0.9744835810365864,-0.24203602828581036,-0.11348625412498292,-0.1133105155608991},
{-0.7881579924245087,-0.9244933093200767,-0.14861593276013907,-0.3659142108323753,-0.09276150014083429,-0.6938133279371745,-0.6011950825176249,-0.178280898772467,-0.6856389094495347,-0.7535325094363263,-0.3202712678980335,-0.4657016296244766,-0.3693780014229784,-0.8614049583083343,-0.2588127890174333,-0.4999473639877692,-0.7667669298814966,-0.10883036213026585,-0.3217199155450551,-0.961455696450078},
{-0.23857271542786807,-0.32772502678729765,-0.649929008602923,-0.7688220724746925,-0.6296543601419691,-0.30120729800358537,-0.7463343839752822,-0.34473421160477624,-0.6106339345506923,-0.05824289273869154,-0.9026774204150289,-0.7445554876231227,-0.43952416865655264,-0.34389799159409085,-0.4178903911397811,-0.8681521142631181,-0.46218101347692553,-0.5691774997748974,-0.9295932213062837,-0.814846013406585},
{-0.004347018993988483,-0.49530168270091346,-0.4480086800091353,-0.7280954807016597,-0.12118008808015612,-0.09513088732731545,-0.47168001001751736,-0.7203754140490809,-0.6488950000167225,-0.6800605492575773,-0.5346796055218601,-0.45460848365164414,-0.10379208851608446,-0.8536949962163612,-0.9511029191722857,-0.6212031975745235,-0.20381045119804508,-0.22659868025768037,-0.05653147209944975,-0.41464077828021195},
{-0.7929820737916098,-0.06911315788075867,-0.8191292331178613,-0.6557707778943378,-0.9137002075898607,-0.6645135485204713,-0.6434175141865475,-0.07647112701979353,-0.5372114526348172,-0.5121093453097119,-0.42169044008337264,-0.39556956367921864,-0.1947149494225925,-0.9758588389740377,-0.05252767084179455,-0.5375100224955836,-0.8693974863558973,-0.008364837652561685,-0.8499885005589208,-0.7219026878552705},
{-0.8695689211831175,-0.4882703453397722,-0.06597609881433797,-0.6902318968649146,-0.9876489435893916,-0.684187727555832,-0.4918175457863415,-0.3719633989738925,-0.9148852537929933,-0.9862201272605842,-0.0038899548705541016,-0.484904132590789,-0.43320337392711994,-0.06035311714067504,-0.09839985600563983,-0.7172935803016076,-0.5283619630393329,-0.8982072109043436,-0.4912363297670992,-0.15638598254714253},
{-0.11553462239393054,-0.013402414047136713,-0.8972540003583722,-0.5919664335056182,-0.6149477780413315,-0.0580324873026532,-0.5335815954901428,-0.5990920632326556,-0.7485462763551687,-0.6353979129021872,-0.23462668855276236,-0.7809199168204006,-0.2479409821346158,-0.4066555788243069,-0.09330893259629458,-0.3805503593403915,-0.9931327647302096,-0.8343843007657186,-0.5308737896190253,-0.9279628256254937}};

static param_t xstream_shift[20][20] = {{1.7436541964494578,0.7693282477248182,0.4237765925222572,0.7610054308729872,0.9001001604983179,0.48531595280247763,1.0274703223361759,2.5059258638498645,0.6336712741528177,0.30982314365337194,0.26380287804878433,1.903801909707266,0.2199684837463265,1.211473018140123,0.31778374849132585,0.45433938648195105,1.4822265729979598,1.2203892972742687,0.497070065087286,1.4987733222966377},
{2.1489558533002895,0.7148905976944997,2.468421475412177,1.5543401288340546,0.9955939376515975,0.7161319147946266,3.145604050064522,0.9600122219338996,0.031028625198245674,0.24819945660439058,1.6212976059331436,2.003438338510804,0.1010884176986161,2.476361776239924,0.5920521325142742,3.329699661913456,1.3049693493507224,2.1691832380844347,0.9451301357517548,2.634108595136755},
{2.0343941341116087,0.44384230770934596,1.9959238825793817,1.1476735645378564,0.687017548103478,0.26640565156031637,0.4395875907294589,1.5864617205545728,0.9379320296982837,0.1763005512798118,1.768589943511302,2.487326554173718,0.6210174237051526,1.020108590965894,1.5132037387775161,2.4101349414332502,3.70052222157332,1.4299034042004113,0.0621909364944474,2.4548292164131587},
{2.053703195208568,0.14645052597594788,1.427674511768251,0.6861192549789211,0.46835058019361187,0.9580463394266725,2.2079826176909187,1.919563376120859,0.5053506495630762,0.33281793605560506,1.7618210793819473,1.964831505959476,0.13282638674969072,3.400228846255155,1.5310307558218645,2.0008576330520853,1.462241881746311,2.421309837997374,0.3012977108833784,3.3133965695206262},
{0.9230865354323171,0.18166662672842138,2.095268660382474,1.6183861074379957,0.4277478384035236,0.9357602374672985,2.756513061627725,0.27797203554771,0.20581753028319894,0.6821935749579704,0.6995073768359473,2.363766110653208,0.07619606302863269,3.0301652264348675,1.4077170640970618,0.4933875201201216,1.4191271725436188,0.9229944586667921,0.9281389923398352,3.071680788791657},
{2.330822725833791,0.5399684157251773,3.7894268483374267,0.6975456749750606,0.5977429446874363,0.21475591878005962,3.0172807127759755,0.18764456022944306,0.15611628602593486,0.16318133033163307,1.3559656972547445,1.141442511723987,0.4622785482966597,1.795993620363862,0.6757656045881715,0.624978208592752,2.490337160595931,0.8260866569540543,0.33787859982518886,0.9936782027308283},
{1.357518068950763,0.2421993206518963,2.982408387576292,0.9095826758355214,0.7265122748535441,0.002146971927819985,0.4473699150813188,0.42832226124557166,0.5195105894142164,0.43706797293232535,0.6106411648234259,1.330537727364927,0.3049248371291825,2.0976326284140825,1.2118530398790452,3.075677440357904,2.9300863616451847,1.0714495585899126,0.07328535544662595,2.9983413262978673},
{1.546070074514967,0.3313404337663388,3.787192272243619,0.5695547560586683,0.8798540821143667,0.10727692040890824,2.5913696882068775,2.142389462723099,0.803439117354976,0.699276521260818,0.3308589739198292,0.4803385931747264,0.13444109685165018,1.010279119213864,0.42479733023506183,1.8760185934795004,1.2036532948339995,2.788423098010505,0.7889214689475607,1.4412757044510975},
{0.04191129264516261,0.48909607890189477,1.1566466797991777,0.688279403558443,0.35413689597768183,0.43894524457717454,0.28196543656867495,0.8408600540490491,0.4966515858739732,0.07426894200847334,1.5230834461848017,3.0350410383212028,0.22033036265318595,0.5889020526742632,1.0551350114188096,0.02361334724366615,0.008648201557968867,0.10614217784303381,0.8353853224662192,2.5591860106766235},
{1.8649582329683505,0.6810780348482286,3.1779571555443913,0.7438904896053671,0.9484695646226381,0.9102445213757036,3.6787060288646667,0.8642800908758702,0.22822573517743883,0.43565141660271034,1.0221620904029982,1.326729341279355,0.6870205308665444,1.5763247499636994,0.6186185813875705,1.627617600063205,0.29758407820895505,2.618692225227846,0.8727062309006143,3.383076373463598},
{0.10888437049703865,0.4922203873930957,0.8579319231453242,0.7734143138209087,0.4407970513692546,0.7421932434205993,0.7951129399459387,1.1842128243069971,0.5754327977886257,0.874035931929343,1.6928298482726738,0.3278128627035271,0.36355135277935435,3.050787795796421,0.023197405747258273,0.172692100103794,0.8155035021697441,2.683793546047213,0.35146250913829813,2.0778603665445265},
{1.029354853276315,0.5266430316295095,3.0105014208848977,0.7550334565130982,0.08551688446296224,0.6862406929615544,2.9565879146524248,2.465122564932322,0.9407065938476001,0.21181807864087465,0.8452437585385435,0.608955385534427,0.11746178443985444,0.14978685677013667,1.0215868984122536,1.4181166379598467,0.7715292918929824,1.5868269109921047,0.08467471278774308,0.5743796742044041},
{1.4785438664858783,0.957010942808168,1.3545101783101883,1.4135865131267,0.674952796504497,0.12361490904864747,0.16249044510343708,2.540867028422629,0.5290493241863669,0.11366345841721892,1.110053876079157,1.28535023313833,0.45290396031049307,0.07481523960238431,1.635743030943268,2.0814655311339907,3.8887093035184095,1.069834730578345,0.5904542115801366,0.5412684379465159},
{1.2346711124291547,0.48168565071853897,0.7985174947092152,0.02852027379824669,0.09736808056506285,0.047489297943353215,1.9831196637266584,1.3964416059713483,0.9635317217804625,0.7436953626910051,1.2122133856065382,1.8472725252609412,0.8150144658608415,2.7122514235162307,1.5931959541712433,0.5037332266478883,3.9275952071054485,0.6906261012768333,0.11348625412498292,0.3937914582940255},
{2.0154752241029747,0.9244933093200767,0.5989872344358289,0.6461159183726389,0.09276150014083429,0.6938133279371745,2.423079229431303,0.4558993727912163,0.6856389094495347,0.7535325094363263,0.8189967134062403,1.6184669441483885,0.3693780014229784,3.143659692653047,0.45700073381185946,1.7374821794821549,3.090406218610736,0.31053677930054613,0.3217199155450551,3.341376031306533},
{0.6100774231987417,0.32772502678729765,2.6194982745961712,1.3575536689109378,0.6296543601419691,0.30120729800358537,3.008054118552934,0.8815532787439803,0.6106339345506923,0.05824289273869154,2.308323957493756,2.587576182144787,0.43952416865655264,1.2550406683074926,0.7378932707646878,3.0171152730566755,1.8627917069840898,1.6240922493565737,0.9295932213062837,2.8318589701588155},
{0.011116183766832767,0.49530168270091346,1.8056710021463722,1.2856403666487444,0.12118008808015612,0.09513088732731545,1.9010768192334455,1.8421418205790896,0.6488950000167225,0.6800605492575773,1.3672810630866996,1.5799145987805627,0.10379208851608446,3.1155225234544655,1.6794175189042084,2.158886241571366,0.8214452935491656,0.646577140639736,0.05653147209944975,1.4410136247185101},
{2.0278113503211967,0.06911315788075867,3.3014492112544747,1.1579324493500964,0.9137002075898607,0.6645135485204713,2.5932541030590315,0.19555173372474285,0.5372114526348172,0.5121093453097119,1.0783455124456196,1.3747348563977788,0.1947149494225925,3.5613541206292836,0.09275115117480134,1.8680248215129625,3.5040522661743503,0.02386824497458925,0.8499885005589208,2.5088502226796146},
{2.2236590038289723,0.4882703453397722,0.26591254540283576,1.2187824433450631,0.9876489435893916,0.684187727555832,1.9822398993588342,0.951183673972343,0.9148852537929933,0.9862201272605842,0.009947380778773779,1.6852019828918616,0.43320337392711994,0.22025605941914642,0.17375032575584842,2.4928320519387412,2.129529890532038,2.5629463043125487,0.4912363297670992,0.543492930193977},
{0.29544478543540653,0.013402414047136713,3.6163262059429453,1.0452694224698236,0.6149477780413315,0.0580324873026532,2.150567293106688,1.5319964042841354,0.7485462763551687,0.6353979129021872,0.5999866552602541,2.713954581649373,0.2479409821346158,1.4840717360775597,0.1647609873901387,1.3225381617686385,4.002759577154238,2.380833881160692,0.5308737896190253,3.2249772453758667}};

const static score_t log_LUT_xstream_d0[128] = {1.0,2.0,2.584962500721156,3.0,3.321928094887362,3.584962500721156,3.807354922057604,4.0,4.169925001442312,4.321928094887362,4.459431618637297,4.584962500721156,4.700439718141093,4.807354922057604,4.906890595608519,5.0,5.087462841250339,5.169925001442312,5.247927513443585,5.321928094887363,5.392317422778761,5.459431618637297,5.523561956057013,5.584962500721156,5.643856189774724,5.700439718141092,5.754887502163468,5.807354922057604,5.857980995127572,5.906890595608519,5.954196310386875,6.0,6.044394119358453,6.087462841250339,6.129283016944966,6.169925001442312,6.20945336562895,6.247927513443585,6.285402218862249,6.321928094887363,6.357552004618084,6.392317422778761,6.426264754702098,6.459431618637297,6.491853096329675,6.523561956057013,6.554588851677638,6.584962500721156,6.614709844115208,6.643856189774724,6.672425341971495,6.700439718141092,6.727920454563199,6.754887502163468,6.78135971352466,6.807354922057604,6.832890014164741,6.857980995127572,6.882643049361842,6.906890595608519,6.930737337562887,6.954196310386875,6.977279923499917,7.0,7.022367813028454,7.044394119358453,7.066089190457772,7.087462841250339,7.108524456778169,7.129283016944966,7.149747119504682,7.169925001442312,7.189824558880018,7.20945336562895,7.22881869049588,7.247927513443585,7.266786540694901,7.285402218862249,7.303780748177103,7.321928094887363,7.339850002884624,7.357552004618084,7.3750394313469245,7.392317422778761,7.409390936137702,7.426264754702098,7.442943495848728,7.459431618637297,7.475733430966398,7.491853096329675,7.507794640198696,7.523561956057013,7.539158811108031,7.554588851677638,7.569855608330948,7.584962500721156,7.599912842187128,7.614709844115208,7.6293566200796095,7.643856189774724,7.658211482751795,7.672425341971495,7.6865005271832185,7.700439718141092,7.714245517666122,7.727920454563199,7.7414669864011465,7.754887502163468,7.768184324776926,7.78135971352466,7.794415866350106,7.807354922057604,7.820178962415188,7.832890014164741,7.845490050944375,7.857980995127572,7.870364719583405,7.882643049361842,7.894817763307944,7.906890595608519,7.918863237274595,7.930737337562887,7.94251450533924,7.954196310386875,7.965784284662087,7.977279923499917,7.9886846867721655,8.0};
#endif