#ifndef XSTREAM_GENERATOR_1_H_
#define XSTREAM_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void xstream_smtp1_c5(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_xstream
);
    
#define ENSEMBLE 140
#define DIM_MAX 3
#define BATCH_SIZE 128
#define K_NUM 20
#define HASH_NUM 2
#define MATRIX_COL 128
const static param_t bottom_xstream = -7.908198388578782;
const static param_t delta_xstream = 0.1447555417130586;

static param_t xstream_fs[20][2] = {{17,10},
{13,10},
{8,3},
{0,7},
{4,5},
{10,11},
{19,5},
{9,7},
{2,2},
{14,10},
{11,10},
{18,7},
{12,8},
{9,16},
{6,17},
{3,19},
{8,18},
{1,13},
{2,2},
{4,19}};

static param_t xstream_R_T[3][20] = {{0.0,0.0,0.38729833462074165,-0.38729833462074165,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.0,0.0,0.0,0.38729833462074165,0.38729833462074165,0.0,-0.38729833462074165,0.0,0.0,0.0},
{0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.0,0.38729833462074165,0.0,-0.38729833462074165,0.0,-0.38729833462074165,-0.38729833462074165,0.38729833462074165,0.0,0.38729833462074165},
{-0.38729833462074165,0.0,0.0,0.0,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.38729833462074165,-0.38729833462074165,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,-0.38729833462074165}};

static param_t xstream_deltamax[20] = {0.39105317842609216,1.0,0.24811202011695074,0.5663290447231158,1.0,1.0,0.24811202011695074,0.39105317842609216,1.0,1.0,0.39105317842609216,0.28774244127026105,1.0,0.27401342464691647,0.5663290447231158,0.28774244127026105,0.24811202011695074,0.35045884862783616,1.0,0.28774244127026105};

static param_t xstream_shift_deltamax[20][20] = {{-0.07695109821223689,-0.4996375232293164,-0.14721268246908803,-0.05884238845979084,-0.8871704788077399,-0.14504859294488393,-0.989374416259138,-0.12113076938921485,-0.36544157955440604,-0.48848002621848374,-0.2933121445753981,-0.4504460906268377,-0.8958710868311988,-0.7573004685072348,-0.16609088413700912,-0.08631654123400123,-0.21859088970460905,-0.726285732723141,-0.5810707704233731,-0.6134772350349628},
{-0.4277310157416905,-0.6551123751278123,-0.6498906817688999,-0.7098387991482298,-0.7801594171003747,-0.5328064346079788,-0.2822663375200355,-0.5607991038879742,-0.06573294377308059,-0.8128791309413375,-0.41153701704467177,-0.6592181390257358,-0.6501229459488825,-0.05565036089704989,-0.8107911775376234,-0.44520671201518397,-0.7330686693695223,-0.9313502570599527,-0.557238670690805,-0.3663559747546389},
{-0.680555212565456,-0.46545371562089066,-0.030423019140991214,-0.06012954315666752,-0.7972062359688866,-0.15633524122238085,-0.46251709345401504,-0.5038531261194585,-0.5158354684808724,-0.17782762645665084,-0.27938134554380145,-0.42287563679357343,-0.32411635036670217,-0.372999507793525,-0.8951016812472135,-0.00348959719166253,-0.9659382927953956,-0.20736857493622704,-0.29675925295773387,-0.9896270766579125},
{-0.15163150549212268,-0.6389205124799594,-0.38049776237249633,-0.5221426018187814,-0.1527084592416449,-0.79313498987203,-0.6143497443604908,-0.9337112046628078,-0.9419087196689948,-0.6802005025953052,-0.3341376136003742,-0.7151645072778393,-0.8615502505749129,-0.3604649073568147,-0.026754992079570217,-0.08393844933217498,-0.24613000369939286,-0.6447050994994628,-0.91918857695335,-0.4711645942814804},
{-0.6773136851668269,-0.04836396273664911,-0.8330169856733208,-0.25509281581163257,-0.7637630573918368,-0.4842156850680891,-0.5852419009810261,-0.08748604117375303,-0.6745775555585524,-0.4044288241190098,-0.2141778924515536,-0.461307324056609,-0.4077566146667738,-0.09256428626248081,-0.6590289732972786,-0.7835989206900145,-0.7740204558806788,-0.9597259372312925,-0.6933218525233773,-0.5497254811393227},
{-0.5586131902197886,-0.5011387096681527,-0.5575031181914716,-0.03265345249636409,-0.5640095443350223,-0.7891241850058001,-0.5028325034321023,-0.029905959900587087,-0.03288163229160879,-0.6020975686312366,-0.5652033585850991,-0.8297462938511965,-0.712157894325365,-0.8349107776413426,-0.29173997371096494,-0.7983718632572396,-0.30421398093534313,-0.9895884109237211,-0.3281189064940988,-0.700156167837425},
{-0.9338871878564224,-0.3600854859415127,-0.22172965537845057,-0.28255100809937084,-0.2807888857077717,-0.009207160118081092,-0.5214240433915016,-0.4619144162266988,-0.255841600797034,-0.4021348935857152,-0.5558695139165416,-0.34613320442429263,-0.9167122452993237,-0.445339464635103,-0.588632154777622,-0.19684165393536335,-0.097040278664281,-0.12074868172856247,-0.1669954941827534,-0.7316970155839707},
{-0.1639185546655364,-0.47209939473738805,-0.7832900267179562,-0.23618763302935317,-0.376814623956614,-0.8893626122555477,-0.6029233300050056,-0.5107805735214496,-0.06396647291211344,-0.37145968247522376,-0.23364205458917894,-0.013953673901702546,-0.23758609813615583,-0.20231149400871784,-0.8889045734920438,-0.7908659470313862,-0.590155242015383,-0.594424114121436,-0.6985988812611327,-0.440316900265329},
{-0.2405046160711498,-0.3848079270170729,-0.40922340696894965,-0.4841337379883351,-0.12231145193106685,-0.40724613283231137,-0.20199511844771156,-0.17183727893909417,-0.2804600702157256,-0.26125158557046446,-0.58564763514385,-0.2877961958113932,-0.05882564723263317,-0.1919430818610257,-0.9662477545586465,-0.7592911576382612,-0.0143954865389605,-0.2090096811950296,-0.708435997715081,-0.976137509531565},
{-0.12007911275540782,-0.8907938554625958,-0.9866928902767851,-0.8895018403536652,-0.651281402511071,-0.7018931711004612,-0.9858068391938445,-0.738597030470283,-0.9445136323985026,-0.8709623873160671,-0.48990388827599685,-0.43801244750548507,-0.6124158791057702,-0.35143755621287565,-0.15004885748187635,-0.4127015505688403,-0.7641073831356507,-0.6908341005973229,-0.7244304946823029,-0.5679791569876359},
{-0.48836483506371936,-0.8862623184068652,-0.05704817659315864,-0.45108322103778514,-0.40928383869202156,-0.21379164459313116,-0.9707168054117851,-0.5464155258968411,-0.9734694844731127,-0.6344737109714473,-0.5424151602790703,-0.49808421043188045,-0.7231342249428987,-0.6814148938870509,-0.9108896199669922,-0.9556364720218712,-0.9448142318088832,-0.06280795076884549,-0.7912175285305939,-0.6325655407992975},
{-0.5469833146931036,-0.3971369597308211,-0.752244366672533,-0.9473786969765386,-0.7559656507888552,-0.07997201371976481,-0.9731356270663055,-0.7441224868586003,-0.5259909376136399,-0.7678899661124771,-0.3551638680423703,-0.7257776639650602,-0.1375360271844409,-0.23018557579818666,-0.6577287648582842,-0.23255336776451718,-0.9034831281849306,-0.6983607505691464,-0.06663532295816721,-0.4186899668678613},
{-0.37773801668251816,-0.5752668818844213,-0.4786792151215882,-0.4776275184298425,-0.420013759262042,-0.8205161012953355,-0.07690921137796536,-0.610837312742136,-0.5828028536352259,-0.2738461812651788,-0.7362009067638463,-0.09268268054265838,-0.6410345119142016,-0.034270399118525474,-0.52050833841726,-0.37402164785604286,-0.7243793980017617,-0.33639599425443645,-0.8847980310383654,-0.06143562640483414},
{-0.008744738881837688,-0.8251122400381156,-0.3255549051255323,-0.32132590179472365,-0.934441439886848,-0.35145361326008073,-0.5501794345913772,-0.6950478236438713,-0.9154796484702574,-0.8912413141869286,-0.46529187512109754,-0.8761782132160639,-0.4355583451167986,-0.2252908908624799,-0.16659798774784418,-0.9191554668970187,-0.9841139300914007,-0.03493092706366252,-0.7873695790373764,-0.4262119041868532},
{-0.9093591430615363,-0.792217643075666,-0.4142623464356937,-0.8771405149402682,-0.15783637188199806,-0.7092501661664835,-0.303288961926788,-0.1120193085871456,-0.5027187762991017,-0.5437946308554068,-0.2526168834241316,-0.9989766984715419,-0.0320426501838309,-0.8764168586316381,-0.014066920250766389,-0.6032396350344726,-0.3791070616158748,-0.5603835787929345,-0.5051692707581913,-0.8410796040293105},
{-0.6661269371587015,-0.3537952467597446,-0.8386924427682945,-0.40359636148251765,-0.942923151460912,-0.7135335623423006,-0.32022319851361336,-0.9062099293937826,-0.9149208310230336,-0.5656673006543088,-0.6335205282001106,-0.3559769414498132,-0.0329791335472831,-0.7889325773380703,-0.6784258532940223,-0.4776755289414537,-0.9103032972906286,-0.199112567164589,-0.3461668154582319,-0.7768341223748412},
{-0.957423895592901,-0.047367626050278,-0.09303198114237599,-0.49736504667000947,-0.7496130364535358,-0.8639922865660482,-0.983289419939452,-0.1707243096073433,-0.012813372511376153,-0.7969025056756621,-0.6134460134413949,-0.6167130237996346,-0.5183125537871116,-0.4696825393205173,-0.37800754324159225,-0.27141897165021156,-0.4682637361274459,-0.63999861780158,-0.27092415790986324,-0.9880089166955379},
{-0.24874863279509507,-0.6681886846206243,-0.6144920152826548,-0.7453360699491829,-0.7667238391199505,-0.8115096698380485,-0.4969501478942021,-0.2694157896796101,-0.20286249145222301,-0.7611167087916377,-0.22583598418996678,-0.9010892293135188,-0.9410734939673668,-0.5952479331214834,-0.6230358705267169,-0.39559936802578266,-0.882855101937936,-0.1369998740400361,-0.22795446690415666,-0.06821030893699498},
{-0.7520661118499528,-0.5195400142148031,-0.39082566281283715,-0.988897161470829,-0.14865025418945377,-0.5140970137598682,-0.3798458511791709,-0.668607261052793,-0.24389413015716965,-0.98438439378513,-0.1788445545883829,-0.012917690677200278,-0.6689658886760288,-0.8923314354414656,-0.5481147944494495,-0.7200151104037898,-0.3069341212277167,-0.062282583838061394,-0.28501267561072086,-0.3367336704243228},
{-0.7929854245402345,-0.071748979640742,-0.546214410302687,-0.11134746579776655,-0.7771693332213417,-0.9993405166411473,-0.04143107101491106,-0.5063752506470898,-0.859627471760845,-0.7625346387384665,-0.32800480328241943,-0.7633839308480234,-0.03598660206515636,-0.709515561862927,-0.2538046348931362,-0.7645962461226298,-0.6357808463271698,-0.11597624951468531,-0.40366149127286066,-0.8045298838903597}};

static param_t xstream_shift[20][20] = {{0.19677911460008862,0.4996375232293164,0.5933315217847869,0.10390141386543135,0.8871704788077399,0.14504859294488393,3.987611788388099,0.309755235532776,0.36544157955440604,0.48848002621848374,0.7500569251371862,1.5654489085388616,0.8958710868311988,2.7637349136563802,0.29327629526437704,0.2999784837195036,0.8810169277634089,2.072385204616157,0.5810707704233731,2.1320359705253087},
{1.0937924541700927,0.6551123751278123,2.619343800685536,1.253403486475389,0.7801594171003747,0.5328064346079788,1.1376568430138359,1.4340737649673994,0.06573294377308059,0.8128791309413375,1.052381209893301,2.2910007161806467,0.6501229459488825,0.20309355634220796,1.4316609488641496,1.5472403377471353,2.954587484411199,2.6575167404290148,0.557238670690805,1.2732079881484717},
{1.7403137223038296,0.46545371562089066,0.1226180784254263,0.1061742174746935,0.7972062359688866,0.15633524122238085,1.8641462563401876,1.2884516835980282,0.5158354684808724,0.17782762645665084,0.7144331281700698,1.469632477318106,0.32411635036670217,1.3612453779378082,1.5805328891172057,0.012127502554914859,3.8931539565881907,0.5917059185354986,0.29675925295773387,3.4392808801132286},
{0.38775162524546664,0.6389205124799594,1.5335724653450642,0.9219774381765328,0.1527084592416449,0.79313498987203,2.4760982723485516,2.387683456303313,0.9419087196689948,0.6802005025953052,0.854455690515568,2.485432820131402,0.8615502505749129,1.3155009022689175,0.047242839350842426,0.2917138290813905,0.9920116066258151,1.8396028578639099,0.91918857695335,1.6374525502789514},
{1.7320244982865856,0.04836396273664911,3.3574229304999723,0.45043216163555605,0.7637630573918368,0.4842156850680891,2.3587809276840557,0.2237190387401176,0.6745775555585524,0.4044288241190098,0.5476950559859279,1.6031952812387789,0.4077566146667738,0.3378093112837654,1.1636856337104955,2.7232650047408957,3.1196411020950716,2.738483964633626,0.6933218525233773,1.9104775740155586},
{1.4284839531750917,0.5011387096681527,2.2469814962156427,0.05765809258878591,0.5640095443350223,0.7891241850058001,2.0266349981556147,0.0764754298148205,0.03288163229160879,0.6020975686312366,1.4453363117004323,2.8836423649852203,0.712157894325365,3.046970339928336,0.5151421711976641,2.7746058583946316,1.2261154489490191,2.8236936085314763,0.3281189064940988,2.433273884611988},
{2.388133479991454,0.3600854859415127,0.893667526764465,0.4989166823282266,0.2807888857077717,0.009207160118081092,2.1015670387340437,1.1812061420541535,0.255841600797034,0.4021348935857152,1.4214678324666763,1.2029271834084019,0.9167122452993237,1.625246884195367,1.0393818933750967,0.6840897472975859,0.39111478201878264,0.34454453697298276,0.1669954941827534,2.5428887457610982},
{0.41917203006832615,0.47209939473738805,3.157001528377152,0.4170501852767021,0.376814623956614,0.8893626122555477,2.4300448229828207,1.3061665310514425,0.06396647291211344,0.37145968247522376,0.597468752279523,0.04849362450705215,0.23758609813615583,0.7383269424460094,1.569590296974153,2.7485203209510836,2.3785838418356593,1.696130990696356,0.6985988812611327,1.5302466272320352},
{0.6150176736553605,0.3848079270170729,1.6493493816867761,0.8548629855723419,0.12231145193106685,0.40724613283231137,0.8141287082846635,0.43942176772658786,0.2804600702157256,0.26125158557046446,1.497616353614514,1.0001868147809367,0.05882564723263317,0.7004878761263483,1.706159632040513,2.6387875013721023,0.05802010935292456,0.5963886545121418,0.708435997715081,3.392400179905095},
{0.30706594238333856,0.8907938554625958,3.976804065404388,1.5706449256695847,0.651281402511071,0.7018931711004612,3.973232891857363,1.8887380827410296,0.9445136323985026,0.8709623873160671,1.2527807349572206,1.5222378929289873,0.6124158791057702,1.2825559793857728,0.2649499595332194,1.4342741680613316,3.0796870815669433,1.9712274445406925,0.7244304946823029,1.9739151252079754},
{1.2488450727578444,0.8862623184068652,0.22992911252855971,0.7965037732760545,0.40928383869202156,0.21379164459313116,3.912413453222562,1.397292123020327,0.9734694844731127,0.6344737109714473,1.387062400214157,1.7310071056360317,0.7231342249428987,2.486793830503366,1.6084105670623616,3.321152304829071,3.808014748191293,0.17921633599710685,0.7912175285305939,2.198374136282393},
{1.3987440708054026,0.3971369597308211,3.0318739346765753,1.6728414440402257,0.7559656507888552,0.07997201371976481,3.9221623628214615,1.9028677630329942,0.5259909376136399,0.7678899661124771,0.9082239645048562,2.52231704423254,0.1375360271844409,0.8400521839205333,1.1613897803526123,0.8081997453621805,3.6414323165764495,1.9927040030618794,0.06663532295816721,1.455085892159399},
{0.9659505088357426,0.5752668818844213,1.9292866782349225,0.843374576812248,0.420013759262042,0.8205161012953355,0.3099777727081228,1.5620313206521665,0.5828028536352259,0.2738461812651788,1.8826107224774444,0.3221029200054868,0.6410345119142016,0.12506832160754547,0.9190917246205197,1.2998487334885171,2.9195659188954903,0.9598730223863358,0.8847980310383654,0.21350908866144963},
{0.022362019705436092,0.8251122400381156,1.3121287109430566,0.5673837582386813,0.934441439886848,0.35145361326008073,2.2174638469028753,1.7773741833304986,0.9154796484702574,0.8912413141869286,1.189842969679471,3.0450086172484947,0.4355583451167986,0.8221892454823385,0.29417171748501025,3.194368765481159,3.9664097274590975,0.09967197917937815,0.7873695790373764,1.481227108191993},
{2.3254104383488663,0.792217643075666,1.6696585124752357,1.5488178173328746,0.15783637188199806,0.7092501661664835,1.222387217611742,0.2864554356468858,0.5027187762991017,0.5437946308554068,0.6459911269379323,3.4717739032917168,0.0320426501838309,3.1984449658295255,0.02483877594101474,2.0964569299246403,1.5279673328086962,1.5989996571267184,0.5051692707581913,2.9230293602719852},
{1.703417780261304,0.3537952467597446,3.3802975058321083,0.7126534745888587,0.942923151460912,0.7135335623423006,1.290639600462211,2.317357278723803,0.9149208310230336,0.5656673006543088,1.6200367703182958,1.2371374201119782,0.0329791335472831,2.879174910333899,1.1979358283234647,1.6600801982242122,3.668920582169077,0.5681482089671339,0.3461668154582319,2.6997550967644792},
{2.448321477519588,0.047367626050278,0.3749595892150819,0.8782262737613544,0.7496130364535358,0.8639922865660482,3.9630865907905872,0.43657568593221313,0.012813372511376153,0.7969025056756621,1.5687022821560683,2.143281404985332,0.5183125537871116,1.7140858697917183,0.6674698159378424,0.9432705528319413,1.8873077407000427,1.8261733733001435,0.27092415790986324,3.433657239904884},
{0.636099248179638,0.6681886846206243,2.476671686414089,1.3160830737783993,0.7667238391199505,0.8115096698380485,2.0029265315721436,0.6889492389857378,0.20286249145222301,0.7611167087916377,0.5775070927665381,3.1315826241537095,0.9410734939673668,2.1723312786170887,1.1001305271766975,1.3748384363439015,3.558292345214839,0.3909157225632525,0.22795446690415666,0.2370533475558049},
{1.9231811767311615,0.5195400142148031,1.5751984229890053,1.7461530018371405,0.14865025418945377,0.5140970137598682,1.5309449779987514,1.7097604569889917,0.24389413015716965,0.98438439378513,0.45734075173150385,0.04489324070573024,0.6689658886760288,3.256524517334473,0.9678380431952393,2.502290267731197,1.2370788044974177,0.1777172529154809,0.28501267561072086,1.1702606989006772},
{2.0278199188454016,0.071748979640742,2.2014830641628,0.1966126703817663,0.7771693332213417,0.9993405166411473,0.1669853439401364,1.2949012527788293,0.859627471760845,0.7625346387384665,0.8387728865996452,2.6530112397670864,0.03598660206515636,2.589345988347769,0.44815754596733415,2.657224435669834,2.5624749902382256,0.3309268690711369,0.40366149127286066,2.796007013559421}};

const static score_t log_LUT_xstream_d0[128] = {1.0,2.0,2.584962500721156,3.0,3.321928094887362,3.584962500721156,3.807354922057604,4.0,4.169925001442312,4.321928094887362,4.459431618637297,4.584962500721156,4.700439718141093,4.807354922057604,4.906890595608519,5.0,5.087462841250339,5.169925001442312,5.247927513443585,5.321928094887363,5.392317422778761,5.459431618637297,5.523561956057013,5.584962500721156,5.643856189774724,5.700439718141092,5.754887502163468,5.807354922057604,5.857980995127572,5.906890595608519,5.954196310386875,6.0,6.044394119358453,6.087462841250339,6.129283016944966,6.169925001442312,6.20945336562895,6.247927513443585,6.285402218862249,6.321928094887363,6.357552004618084,6.392317422778761,6.426264754702098,6.459431618637297,6.491853096329675,6.523561956057013,6.554588851677638,6.584962500721156,6.614709844115208,6.643856189774724,6.672425341971495,6.700439718141092,6.727920454563199,6.754887502163468,6.78135971352466,6.807354922057604,6.832890014164741,6.857980995127572,6.882643049361842,6.906890595608519,6.930737337562887,6.954196310386875,6.977279923499917,7.0,7.022367813028454,7.044394119358453,7.066089190457772,7.087462841250339,7.108524456778169,7.129283016944966,7.149747119504682,7.169925001442312,7.189824558880018,7.20945336562895,7.22881869049588,7.247927513443585,7.266786540694901,7.285402218862249,7.303780748177103,7.321928094887363,7.339850002884624,7.357552004618084,7.3750394313469245,7.392317422778761,7.409390936137702,7.426264754702098,7.442943495848728,7.459431618637297,7.475733430966398,7.491853096329675,7.507794640198696,7.523561956057013,7.539158811108031,7.554588851677638,7.569855608330948,7.584962500721156,7.599912842187128,7.614709844115208,7.6293566200796095,7.643856189774724,7.658211482751795,7.672425341971495,7.6865005271832185,7.700439718141092,7.714245517666122,7.727920454563199,7.7414669864011465,7.754887502163468,7.768184324776926,7.78135971352466,7.794415866350106,7.807354922057604,7.820178962415188,7.832890014164741,7.845490050944375,7.857980995127572,7.870364719583405,7.882643049361842,7.894817763307944,7.906890595608519,7.918863237274595,7.930737337562887,7.94251450533924,7.954196310386875,7.965784284662087,7.977279923499917,7.9886846867721655,8.0};
#endif