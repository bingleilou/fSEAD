#ifndef XSTREAM_GENERATOR_1_H_
#define XSTREAM_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void xstream_smtp1_c4(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_xstream
);
    
#define ENSEMBLE 140
#define DIM_MAX 3
#define BATCH_SIZE 128
#define K_NUM 20
#define HASH_NUM 2
#define MATRIX_COL 128
const static param_t bottom_xstream = -7.908198388578782;
const static param_t delta_xstream = 0.1447555417130586;

static param_t xstream_fs[20][2] = {{7,10},
{8,14},
{19,0},
{9,1},
{15,2},
{13,15},
{19,5},
{6,17},
{4,1},
{9,7},
{4,0},
{10,13},
{5,2},
{9,1},
{3,19},
{17,10},
{17,0},
{3,16},
{0,11},
{9,6}};

static param_t xstream_R_T[3][20] = {{0.0,0.0,0.38729833462074165,-0.38729833462074165,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.0,0.0,0.0,0.38729833462074165,0.38729833462074165,0.0,-0.38729833462074165,0.0,0.0,0.0},
{0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.0,0.38729833462074165,0.0,-0.38729833462074165,0.0,-0.38729833462074165,-0.38729833462074165,0.38729833462074165,0.0,0.38729833462074165},
{-0.38729833462074165,0.0,0.0,0.0,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.38729833462074165,-0.38729833462074165,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,-0.38729833462074165}};

static param_t xstream_deltamax[20] = {0.39105317842609216,1.0,0.24811202011695074,0.5663290447231158,1.0,1.0,0.24811202011695074,0.39105317842609216,1.0,1.0,0.39105317842609216,0.28774244127026105,1.0,0.27401342464691647,0.5663290447231158,0.28774244127026105,0.24811202011695074,0.35045884862783616,1.0,0.28774244127026105};

static param_t xstream_shift_deltamax[20][20] = {{-0.37844021940819295,-0.5854963349409031,-0.20742454834678659,-0.6338037168664389,-0.9681050664390067,-0.23183245141178477,-0.24781410817999594,-0.49065308464736446,-0.3726966347467572,-0.39667518409688507,-0.08646590194338355,-0.3345111980937291,-0.8326132281337119,-0.12590259978562401,-0.02982951044774418,-0.9189993442004762,-0.7679287501553528,-0.7573696150176827,-0.7397087608539917,-0.5076867302262273},
{-0.27147600643186154,-0.33970161505915863,-0.31254630368445946,-0.36639001229616763,-0.05913592585025762,-0.04962979445326088,-0.28366507328969304,-0.7113213544814105,-0.7715248652788543,-0.30183778721695265,-0.7886492056323844,-0.8123661406523879,-0.7377117994640908,-0.9387336423774616,-0.9337733110314057,-0.209199173766898,-0.03930251604738688,-0.42414006074924776,-0.6635040420646491,-0.26980924999611966},
{-0.4874859602191823,-0.1513050071583052,-0.19201947560852395,-0.17139960943662702,-0.7777369314919856,-0.32420600074923733,-0.0024000097220551186,-0.27033561779415416,-0.5930516186247721,-0.26072731986385367,-0.7481052811007601,-0.08322398899466432,-0.6384344163746661,-0.05951029162160637,-0.6233911930742073,-0.1909899965265901,-0.15478483941678645,-0.9698560503766694,-0.1684254558338556,-0.8787834495137341},
{-0.3207393817594003,-0.37363523204189064,-0.3849749094555067,-0.7126680230921216,-0.8200695169959326,-0.020628638087925588,-0.5265156053708276,-0.6009888434180977,-0.9992615408379029,-0.14889455289169962,-0.016454666654557526,-0.3245627833913902,-0.44549871449522227,-0.46774351250656865,-0.87406919708787,-0.31329537062041923,-0.07877500638221901,-0.00466996879936088,-0.9776566509892184,-0.6028461416727202},
{-0.026151287283228908,-0.3683060778389361,-0.21310614865971178,-0.39987837791736447,-0.04905579906934998,-0.9606295571736794,-0.8196013857650353,-0.511810852781253,-0.15782310713370507,-0.2961138121128162,-0.9725696896617241,-0.6607232773327892,-0.4097211047202043,-0.6475353475394248,-0.2535578554282367,-0.9327090579004842,-0.27884036747768026,-0.59364402604413,-0.9876660284095223,-0.47986768402490076},
{-0.5900274780737292,-0.5084182468801325,-0.11883714066610818,-0.3367339188694016,-0.9734170776097866,-0.8220944463505245,-0.21796007293095665,-0.48950690512547645,-0.14844022306954363,-0.8473787938814153,-0.14293244719295328,-0.3586568236046276,-0.5320951321545455,-0.6610627417310069,-0.8221347623447929,-0.7404431951931689,-0.19383556562397397,-0.7719982478501358,-0.12365641987044607,-0.8606781797161007},
{-0.11690030263886508,-0.038451387146773985,-0.7284518667850143,-0.4442179128177105,-0.23313873316720757,-0.9061909440307065,-0.08754864172365717,-0.3610918950346711,-0.2633743540285428,-0.2255700889746859,-0.5592332462918651,-0.35846951053561005,-0.48081071608860326,-0.14054388660756956,-0.2846916159226812,-0.2714102591605213,-0.5663417177956167,-0.06400180154329538,-0.17119499708568287,-0.27961796246265225},
{-0.6510977765088425,-0.9264444492114765,-0.025533929381961418,-0.2446659518988662,-0.9656155921546362,-0.9653950747091654,-0.12036955578536856,-0.9177309046272849,-0.2423488063553909,-0.48970477232535337,-0.7895502226024141,-0.596518289848016,-0.7937674190954223,-0.8549807539958276,-0.21955112572390467,-0.889767339420377,-0.42366596397179435,-0.6910147002865956,-0.19491613278995223,-0.323716863871476},
{-0.047109472360020055,-0.7859448360062415,-0.23547239739329962,-0.9604307405995391,-0.04829767260178708,-0.25227287752367145,-0.28174029024539504,-0.8974086950914003,-0.18989872570925093,-0.46555455320991224,-0.7337806433410233,-0.9660808024743707,-0.6792342495698726,-0.5804171495405768,-0.7599299777198342,-0.11116651450242532,-0.17950348041535336,-0.7713558230912326,-0.09315538518300026,-0.4849724102021624},
{-0.6224890784893523,-0.88493316892425,-0.43603583132272616,-0.9241638171447971,-0.8223231087368018,-0.9726719182234153,-0.24179408815503967,-0.20361120575751582,-0.16093033343393737,-0.5346260426530921,-0.625739574796757,-0.7445823509749768,-0.697984925438628,-0.9012122238593234,-0.1620935267790786,-0.8980702209216082,-0.08704315646188732,-0.9914929427685396,-0.9265933353733339,-0.8932395511569101},
{-0.2758810587959085,-0.8127896952683569,-0.5075557753086558,-0.27808846140113386,-0.8902461748947383,-0.3003943120697078,-0.2424045043824804,-0.5022455547495863,-0.28654548260769663,-0.2409710601936761,-0.9740737169052065,-0.319778440930088,-0.4500723234418905,-0.29313287110431124,-0.41596519133421095,-0.23041922606061202,-0.16316385538363887,-0.21003124063426704,-0.30612571410482325,-0.5417845108811423},
{-0.0056671610323241195,-0.7787523155694328,-0.6816860386579607,-0.5897360205327499,-0.5035090235434062,-0.3102003660198599,-0.4045205156756836,-0.9723797393136778,-0.8820458798884706,-0.63938005835281,-0.08496163819427249,-0.9530868857616491,-0.5125653200599614,-0.3879374439753974,-0.4875187755831054,-0.2149637941193897,-0.8920159972401018,-0.16535485266524286,-0.34435803770689444,-0.22666367753069416},
{-0.539877240757336,-0.8477291305283197,-0.7794175379807547,-0.9829864438834829,-0.23072103502041663,-0.6076892233660325,-0.26615327017086465,-0.3381117307795266,-0.9915893765235745,-0.17094764981997745,-0.8094615068507844,-0.3906158893775097,-0.8382830575401754,-0.09721328008842756,-0.8225458137246062,-0.9934059333522756,-0.6514932635249285,-0.45314733641723204,-0.49760863936151356,-0.23146873826363334},
{-0.9401131423913752,-0.4870158996730446,-0.03676791152464476,-0.5993790229011816,-0.582754957656841,-0.4157580412200277,-0.9923213600003279,-0.14808462712837323,-0.9483843983181011,-0.8368758733736744,-0.3924706897946968,-0.8876045941317693,-0.1998792471426052,-0.6077697768163998,-0.7501875877215598,-0.5325089866366653,-0.5414822332422444,-0.8457128732469206,-0.2871554535107652,-0.2518754459157718},
{-0.9838367397770595,-0.022966581629017213,-0.42108722513726926,-0.39717676034729477,-0.6312726980843281,-0.6815186303375045,-0.3692544383322587,-0.06632266916891671,-0.7684640369893541,-0.9786384468618249,-0.1312997663929778,-0.7157095179934034,-0.7681884556418365,-0.011459242496410504,-0.2382933986033028,-0.9330594801727085,-0.45227300717104435,-0.14290762480077013,-0.9234606586765612,-0.9052877612821807},
{-0.33222877739494905,-0.4887069283185591,-0.953740675498134,-0.6544878964415358,-0.2084373463048551,-0.1824964202173749,-0.7179930192979525,-0.8938869738222682,-0.778990550282021,-0.38280076482987346,-0.6644907160088989,-0.05633855433054291,-0.43529371117726,-0.14998111437428763,-0.18573381799967936,-0.2298040235316262,-0.6981207104900214,-0.3335629238106448,-0.06644437365325406,-0.39494404375617387},
{-0.6900153012502993,-0.8983334630685975,-0.38633076914660225,-0.5284168236289573,-0.619814002364716,-0.405594317865264,-0.4677295894526873,-0.8859737259685362,-0.27285992430097417,-0.13931083711134318,-0.21276374688726007,-0.9641781447864931,-0.7741489550698156,-0.9561466597663444,-0.011814579865122243,-0.8595864692183165,-0.08463696347352823,-0.7162505893784608,-0.46594466197037,-0.78070076724919},
{-0.9164201920258717,-0.729193638567084,-0.16622436845323052,-0.5043176617937126,-0.5729342747054613,-0.3569279593677823,-0.9230491042750559,-0.5705289562389527,-0.9940863209414172,-0.19096347560280102,-0.23017781175575328,-0.9597380987892017,-0.8945438778066322,-0.12940222278114566,-0.016669427254263236,-0.8920688762540689,-0.4620671226793692,-0.05712367240101468,-0.8986081500385144,-0.6652175670504277},
{-0.2525669445200207,-0.369248425521847,-0.4911444835899754,-0.2039945797003876,-0.4380531516662399,-0.9950423056499573,-0.9637765598426336,-0.40105199967147226,-0.4045338253760309,-0.8910859357295865,-0.1856090869370003,-0.3498314462423105,-0.6094074216647952,-0.2820736354832246,-0.8085287490676709,-0.10997795034964053,-0.3075402107253007,-0.9216839488006034,-0.7898197610100397,-0.5370769142486226},
{-0.41029293189588867,-0.27036886223065515,-0.6221945446384983,-0.8582642153853421,-0.0872351329423009,-0.12205336857607596,-0.9216320942157232,-0.8607323133523035,-0.9980731092457668,-0.9903236075358236,-0.7502979403187823,-0.4830394709120834,-0.6636560072006414,-0.7051514437502772,-0.5409560243366452,-0.5030836695094523,-0.7590583976579744,-0.7846203078729592,-0.49492078551115004,-0.011050023637593553}};

static param_t xstream_shift[20][20] = {{0.9677461795128127,0.5854963349409031,0.8360116863705934,1.119143937207586,0.9681050664390067,0.23183245141178477,0.9987992845456888,1.2546965776423076,0.3726966347467572,0.39667518409688507,0.22111034179901273,1.16253687366036,0.8326132281337119,0.4594760273072658,0.05267169453109744,3.193826187556772,3.0950888626571973,2.161080018333218,0.7397087608539917,1.76437903280797},
{0.6942176190064382,0.33970161505915863,1.2596983553522993,0.6469560685789999,0.05913592585025762,0.04962979445326088,1.1432943601683785,1.818988806955441,0.7715248652788543,0.30183778721695265,2.016731353026035,2.82324059344925,0.7377117994640908,3.4258673405767577,1.6488176259579574,0.727036209338366,0.15840633609311286,1.2102421223202047,0.6635040420646491,0.937676238531327},
{1.2465976166750825,0.1513050071583052,0.7739225029001543,0.3026502190443474,0.7777369314919856,0.32420600074923733,0.009673089280091482,0.691301420646161,0.5930516186247721,0.26072731986385367,1.9130525523708273,0.28923084348372674,0.6384344163746661,0.2171802045767981,1.1007579407815642,0.6637533055028313,0.6238506274054222,2.767389250332759,0.1684254558338556,3.0540626736684278},
{0.820193772750575,0.37363523204189064,1.5516173270204479,1.2583992110815232,0.8200695169959326,0.020628638087925588,2.1220882612726615,1.5368468448126493,0.9992615408379029,0.14889455289169962,0.04207782358599959,1.1279628474638046,0.44549871449522227,1.7070094763031614,1.543394613488721,1.0888048674271087,0.3174977429351767,0.013325298583971763,0.9776566509892184,2.095089410555529},
{0.06687399240298317,0.3683060778389361,0.8589110215589777,0.7060884156363005,0.04905579906934998,0.9606295571736794,3.3033521930082457,1.3088011580450145,0.15782310713370507,0.2961138121128162,2.4870522561052057,2.296231568815416,0.4097211047202043,2.3631519089760467,0.4477217931709715,3.2414719698038583,1.1238486847442752,1.6939050857709694,0.9876660284095223,1.6676986610195148},
{1.5088164746504997,0.5084182468801325,0.4789656728847429,0.5945905865273683,0.9734170776097866,0.8220944463505245,0.8784744601580302,1.2517655708505941,0.14844022306954363,0.8473787938814153,0.3655064197872696,1.2464508955345952,0.5320951321545455,2.412519541999914,1.4516909736578019,2.5732846080141174,0.7812421402744096,2.202821389366448,0.12365641987044607,2.9911408825078807},
{0.29893709880933467,0.038451387146773985,2.9359797499599143,0.7843813008652828,0.23313873316720757,0.9061909440307065,0.35285933217741733,0.9233830971224707,0.2633743540285428,0.2255700889746859,1.4300695586791106,1.2457999207663593,0.48081071608860326,0.5129087627318595,0.5026964775607967,0.9432402740532815,2.2826049198610545,0.18262287225414306,0.17119499708568287,0.97176475332682},
{1.6649852563003729,0.9264444492114765,0.10291290752429356,0.43202084402802604,0.9656155921546362,0.9653950747091654,0.4851419763082451,2.346818681594563,0.2423488063553909,0.48970477232535337,2.0190354308848475,2.073098035919346,0.7937674190954223,3.1202148401945053,0.38767414062481204,3.092235318128361,1.7075592056043638,1.9717427680657793,0.19491613278995223,1.1250229977976245},
{0.1204681996183381,0.7859448360062415,0.9490567900833934,1.695888193530854,0.04829767260178708,0.25227287752367145,1.13553664233032,2.2948507891005616,0.18989872570925093,0.46555455320991224,1.8764216322044436,3.357449802015764,0.6792342495698726,2.118206983064719,1.3418523821100714,0.3863403466366387,0.7234775660233717,2.200988293237135,0.09315538518300026,1.6854392701376082},
{1.5918271806273039,0.88493316892425,1.7574151833401508,1.631849585953393,0.8223231087368018,0.9726719182234153,0.9745359698456647,0.52067395686952,0.16093033343393737,0.5346260426530921,1.6001393399108246,2.587669541163135,0.697984925438628,3.288934565963664,0.28621792982263133,3.121090573072948,0.3508220054024727,2.8291280036174484,0.9265933353733339,3.10430240048578},
{0.7054822055309012,0.8127896952683569,2.045671850438415,0.4910369051212872,0.8902461748947383,0.3003943120697078,0.9769962143237557,1.2843408069741828,0.28654548260769663,0.2409710601936761,2.490898350003575,1.1113356775538623,0.4500723234418905,1.0697755830103264,0.7344938339469781,0.8007828982176167,0.6576217279063284,0.5993035743186674,0.30612571410482325,1.8828800801487366},
{0.014492046977173965,0.7787523155694328,2.7474930006883156,1.041331053082538,0.5035090235434062,0.3102003660198599,1.6303946720719444,2.486566515652179,0.8820458798884706,0.63938005835281,0.21726364310916854,3.3122916506656925,0.5125653200599614,1.4157607222174577,0.8608401425384397,0.7470701686216866,3.5952147615405283,0.4718238769335188,0.34435803770689444,0.7877311269414062},
{1.3805724401224146,0.8477291305283197,3.1413937043975797,1.7357161054031323,0.23072103502041663,0.6076892233660325,1.0727141314854876,0.8646182908942363,0.9915893765235745,0.17094764981997745,2.0699525064818523,1.3575192024266767,0.8382830575401754,0.35477561077050507,1.4524167908901042,3.4524136549575686,2.625802906355923,1.2930115424149105,0.49760863936151356,0.8044302996867506},
{2.4040544720161474,0.4870158996730446,0.14819077087564617,1.0583582609545026,0.582754957656841,0.4157580412200277,3.999489261070804,0.37868155866775743,0.9483843983181011,0.8368758733736744,1.003624855765934,3.0847190640816513,0.1998792471426052,2.21802919911515,1.3246496797428682,1.8506445704911085,2.182410320092553,2.413158853195375,0.2871554535107652,0.8753503473587294},
{2.515864322435118,0.022966581629017213,1.6971657597998857,0.701318012996276,0.6312726980843281,0.6815186303375045,1.488256950059114,0.16960012813564562,0.7684640369893541,0.9786384468618249,0.33575936378124355,2.4873269123381623,0.7681884556418365,0.04182000393293306,0.4207684575312695,3.2426898029141817,1.8228581064224931,0.40777291074344785,0.9234606586765612,3.1461739091588936},
{0.8495744203693751,0.4887069283185591,3.8439922219349802,1.155667191255433,0.2084373463048551,0.1824964202173749,2.8938260184231193,2.2858450541687905,0.778990550282021,0.38280076482987346,1.6992336405072477,0.1957950800786705,0.43529371117726,0.5473495124100132,0.3279609614415707,0.7986448662808959,2.8137319189975294,0.9517891333509068,0.06644437365325406,1.372560968109755},
{1.7645050323525502,0.8983334630685975,1.5570820348183871,0.9330561950734944,0.619814002364716,0.405594317865264,1.8851548958902393,2.2656093207946717,0.27285992430097417,0.13931083711134318,0.5440788072445543,3.350837438266162,0.7741489550698156,3.4894153853899654,0.020861688050801835,2.9873468280299775,0.34112399485375,2.0437509059418013,0.46594466197037,2.7131929645231567},
{2.3434669313116765,0.729193638567084,0.6699569346736146,0.8905029090292884,0.5729342747054613,0.3569279593677823,3.7202917611164708,1.4589549138437214,0.9940863209414172,0.19096347560280102,0.5886100010289423,3.3354068122601737,0.8945438778066322,0.47224774825499355,0.029434173312465534,3.1002339186251513,1.8623326772381605,0.1629968044027794,0.8986081500385144,2.3118507096616465},
{0.6458634233240355,0.369248425521847,1.979527164215858,0.360205046167326,0.4380531516662399,0.9950423056499573,3.8844412269439634,1.0255689553160603,0.4045338253760309,0.8910859357295865,0.47463899330530523,1.2157797949372806,0.6094074216647952,1.0294153866610523,1.4276660478591012,0.3822096937251746,1.239521610361069,2.6299348765462907,0.7898197610100397,1.8665196273363616},
{1.0491998391298916,0.27036886223065515,2.5077162498826904,1.5154868417616767,0.0872351329423009,0.12205336857607596,3.7145805905788047,2.2010620571262773,0.9980731092457668,0.9903236075358236,1.9186596138626868,1.6787216678209465,0.6636560072006414,2.5734193303080284,0.955197388121113,1.7483818768220316,3.0593374609588952,2.23883720141469,0.49492078551115004,0.03840248101327137}};

const static score_t log_LUT_xstream_d0[128] = {1.0,2.0,2.584962500721156,3.0,3.321928094887362,3.584962500721156,3.807354922057604,4.0,4.169925001442312,4.321928094887362,4.459431618637297,4.584962500721156,4.700439718141093,4.807354922057604,4.906890595608519,5.0,5.087462841250339,5.169925001442312,5.247927513443585,5.321928094887363,5.392317422778761,5.459431618637297,5.523561956057013,5.584962500721156,5.643856189774724,5.700439718141092,5.754887502163468,5.807354922057604,5.857980995127572,5.906890595608519,5.954196310386875,6.0,6.044394119358453,6.087462841250339,6.129283016944966,6.169925001442312,6.20945336562895,6.247927513443585,6.285402218862249,6.321928094887363,6.357552004618084,6.392317422778761,6.426264754702098,6.459431618637297,6.491853096329675,6.523561956057013,6.554588851677638,6.584962500721156,6.614709844115208,6.643856189774724,6.672425341971495,6.700439718141092,6.727920454563199,6.754887502163468,6.78135971352466,6.807354922057604,6.832890014164741,6.857980995127572,6.882643049361842,6.906890595608519,6.930737337562887,6.954196310386875,6.977279923499917,7.0,7.022367813028454,7.044394119358453,7.066089190457772,7.087462841250339,7.108524456778169,7.129283016944966,7.149747119504682,7.169925001442312,7.189824558880018,7.20945336562895,7.22881869049588,7.247927513443585,7.266786540694901,7.285402218862249,7.303780748177103,7.321928094887363,7.339850002884624,7.357552004618084,7.3750394313469245,7.392317422778761,7.409390936137702,7.426264754702098,7.442943495848728,7.459431618637297,7.475733430966398,7.491853096329675,7.507794640198696,7.523561956057013,7.539158811108031,7.554588851677638,7.569855608330948,7.584962500721156,7.599912842187128,7.614709844115208,7.6293566200796095,7.643856189774724,7.658211482751795,7.672425341971495,7.6865005271832185,7.700439718141092,7.714245517666122,7.727920454563199,7.7414669864011465,7.754887502163468,7.768184324776926,7.78135971352466,7.794415866350106,7.807354922057604,7.820178962415188,7.832890014164741,7.845490050944375,7.857980995127572,7.870364719583405,7.882643049361842,7.894817763307944,7.906890595608519,7.918863237274595,7.930737337562887,7.94251450533924,7.954196310386875,7.965784284662087,7.977279923499917,7.9886846867721655,8.0};
#endif