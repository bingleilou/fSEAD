#ifndef XSTREAM_GENERATOR_1_H_
#define XSTREAM_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void xstream_smtp1_c2(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_xstream
);
    
#define ENSEMBLE 140
#define DIM_MAX 3
#define BATCH_SIZE 128
#define K_NUM 20
#define HASH_NUM 2
#define MATRIX_COL 128
const static param_t bottom_xstream = -7.908198388578782;
const static param_t delta_xstream = 0.1447555417130586;

static param_t xstream_fs[20][2] = {{2,0},
{2,16},
{13,4},
{8,2},
{3,14},
{10,10},
{11,5},
{17,9},
{11,4},
{0,6},
{19,8},
{14,12},
{0,14},
{9,14},
{3,6},
{11,0},
{15,5},
{6,19},
{13,7},
{12,14}};

static param_t xstream_R_T[3][20] = {{0.0,0.0,0.38729833462074165,-0.38729833462074165,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.0,0.0,0.0,0.38729833462074165,0.38729833462074165,0.0,-0.38729833462074165,0.0,0.0,0.0},
{0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.0,0.38729833462074165,0.0,-0.38729833462074165,0.0,-0.38729833462074165,-0.38729833462074165,0.38729833462074165,0.0,0.38729833462074165},
{-0.38729833462074165,0.0,0.0,0.0,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.38729833462074165,-0.38729833462074165,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,-0.38729833462074165}};

static param_t xstream_deltamax[20] = {0.39105317842609216,1.0,0.24811202011695074,0.5663290447231158,1.0,1.0,0.24811202011695074,0.39105317842609216,1.0,1.0,0.39105317842609216,0.28774244127026105,1.0,0.27401342464691647,0.5663290447231158,0.28774244127026105,0.24811202011695074,0.35045884862783616,1.0,0.28774244127026105};

static param_t xstream_shift_deltamax[20][20] = {{-0.4235393316976914,-0.8970355739948876,-0.9130918182272413,-0.7390936855984181,-0.7630283041171627,-0.9869423307739874,-0.4208603580581941,-0.42853664144918346,-0.06065792877721976,-0.1494084532235065,-0.6528221137248146,-0.9589545736238998,-0.5487245735845983,-0.3619822490109247,-0.7525210225445975,-0.9229945012076824,-0.08355084056039286,-0.9410248518027661,-0.6103551999398111,-0.8510103568370526},
{-0.9095743525318432,-0.42429384938340364,-0.09477316162035332,-0.6722006425816414,-0.48765261166424145,-0.6563792574950127,-0.7004394744500186,-0.16107846483201782,-0.2834626448403905,-0.3340768756345973,-0.06295314418329545,-0.5261384041816694,-0.2762320813300758,-0.7545615599296384,-0.8560434722537674,-0.980348418412259,-0.697530581136761,-0.565037627275732,-0.021726619260071356,-0.9320283952777463},
{-0.139334632647936,-0.19729489849172122,-0.9410005790191006,-0.4816122102525031,-0.41191963028720346,-0.5163436820394515,-0.5671257704019085,-0.6036122207047441,-0.348303367926291,-0.5377092337230922,-0.40696450612541996,-0.36903696537287345,-0.8308115734013344,-0.5444501241268663,-0.7576896288400492,-0.07841186336860362,-0.7146770852790374,-0.8201199616655512,-0.32567114528466323,-0.34532733519461545},
{-0.7835499594882349,-0.5760149878999257,-0.16983817237044818,-0.7789462853649011,-0.37480731233583686,-0.6176538118596948,-0.3505034485333345,-0.34414051909490806,-0.333373838277811,-0.8888930154908171,-0.7059905132111836,-0.22054920990880741,-0.4240638900369873,-0.5170316836964228,-0.8655202127281468,-0.04230304815324104,-0.25769294959015887,-0.9224517450935926,-0.5807181408790009,-0.8543737131715204},
{-0.6031068276952878,-0.10095022684356203,-0.779876286157234,-0.7185926460132579,-0.532277462030829,-0.6746857096657916,-0.1069313039054891,-0.45132902682398124,-0.1977408229280846,-0.9175252351625993,-0.8274738787615096,-0.3132668176033715,-0.24270204312878008,-0.42583138852929825,-0.31419218183061337,-0.472722547634723,-0.9265799249076462,-0.5191019735241598,-0.768433843475204,-0.38428131217400185},
{-0.7920518686554181,-0.5361343019098778,-0.18299459219028558,-0.8167163918566246,-0.48395611361089297,-0.5557617602937984,-0.36309972465459406,-0.847603382158529,-0.9484680176879351,-0.30320577430203144,-0.0955840825564207,-0.6966481020727664,-0.469257428059094,-0.06740152331443794,-0.5672394814279185,-0.41288228285466455,-0.93291949628073,-0.36761834017264666,-0.04624603541280381,-0.019011142948271886},
{-0.9482411538248063,-0.028213168706006764,-0.023988303541221723,-0.5125763928540984,-0.7778776489117613,-0.6247697571467891,-0.05864606965143759,-0.4230766087109708,-0.14813925360846236,-0.4240030873426085,-0.5767738726636203,-0.6721084262308888,-0.7901731602159823,-0.9968528428102612,-0.16624801166630288,-0.43167963489192096,-0.029116886571903255,-0.8248242181199731,-0.8456681582139695,-0.5290144872870663},
{-0.7015142382974212,-0.18820999529802962,-0.7094738784595828,-0.41856235250323626,-0.07803728203881188,-0.028995059029964687,-0.25696565328791865,-0.8226430779729738,-0.2013231991117891,-0.7368857141689393,-0.3707217285414861,-0.9021025831623001,-0.9042774648148759,-0.47379198931266875,-0.6483776003111199,-0.552360905765335,-0.6349100619738728,-0.09678823271465642,-0.5191618460093,-0.35517863357251855},
{-0.4155583962445175,-0.22344663743329818,-0.32236393129606145,-0.7085960028766248,-0.4089163197423954,-0.27431526641369286,-0.6739605056743192,-0.8141612612551365,-0.7508416829228308,-0.3998040280328945,-0.3122905389006605,-0.7732125576133194,-0.4655924010471254,-0.34041904307874327,-0.47780324765355786,-0.5659138064673119,-0.3198514279553575,-0.37319592719966765,-0.38090732302292174,-0.49070328732231094},
{-0.9200539399772768,-0.7156532741102234,-0.03525689417571021,-0.9958619844086081,-0.5831292811416918,-0.9910049554417582,-0.462915732762197,-0.6524490178843595,-0.8215927723737249,-0.08758321348289078,-0.32983172639576896,-0.042355750098895244,-0.9561320448555941,-0.3892939555327152,-0.6636796807964084,-0.8823954197634609,-0.9314721079594657,-0.19081080559091324,-0.5883550431030695,-0.1325375826909989},
{-0.7649422996231828,-0.5660767233839927,-0.551858194229845,-0.9530270089863911,-0.9516717795896813,-0.919133444419077,-0.6847441002246801,-0.7819389395995374,-0.7617221465794012,-0.7723363406512026,-0.7972876476874321,-0.44527563971717865,-0.7020282997665339,-0.9367893343412711,-0.3113634412718509,-0.6470590021887844,-0.12343245181179097,-0.008933338232477772,-0.27822899248328536,-0.5219919028063046},
{-0.5370454457244255,-0.4045032886455934,-0.32384191526022266,-0.980173637614344,-0.25766752816316474,-0.4484194333297852,-0.8222970013762687,-0.5113499855313495,-0.935638419526385,-0.4718116146415744,-0.3540324641086616,-0.11219004553330769,-0.9166442673469868,-0.0025740126205032743,-0.6585513011220316,-0.5419085664711288,-0.6163349090137991,-0.22211173548651952,-0.07136158733978892,-0.5763042721501394},
{-0.9784870443343336,-0.6622899749331407,-0.6199150143371895,-0.7008744141448403,-0.866451523153617,-0.6089701972106518,-0.16169555632262733,-0.38515764989386614,-0.3087022756576485,-0.6777569942126047,-0.826614641833758,-0.48967778897697245,-0.6383265580130884,-0.8446876725606026,-0.08413789061057918,-0.6330200691631146,-0.35452251923248634,-0.03427130523318467,-0.6954446173000564,-0.6772630709171058},
{-0.6850352593033701,-0.4005678995321602,-0.4133997165795299,-0.4360364364784852,-0.5464193913721834,-0.8241898082137766,-0.2548623710446226,-0.3299632969624725,-0.3684950284363565,-0.7011770217584593,-0.9367176925099047,-0.5537451515534701,-0.8767938139810953,-0.2935361691101489,-0.5909255843882938,-0.27387692323782364,-0.08097090124441098,-0.07903769702299523,-0.12078398449799588,-0.5821575268166704},
{-0.52712240111417,-0.7698370599195385,-0.49502167744877934,-0.09477815356602948,-0.8026276664459027,-0.9519210455030019,-0.7638309146131189,-0.5495507199696307,-0.7196062990191988,-0.8562501510370208,-0.7559388315710173,-0.6877139554546927,-0.4658360220725881,-0.316734925787981,-0.47164069206880954,-0.7850299053475556,-0.9543901152210871,-0.26353745142171014,-0.8498775604810646,-0.04855708037140005},
{-0.9165781137850728,-0.844186623731223,-0.032320016876302926,-0.9214361798625837,-0.9831962581421948,-0.9387111546916534,-0.7702963615682474,-0.30407332303236123,-0.8845220158620566,-0.7985127074203103,-0.45209844294016815,-0.44799366254423323,-0.2791069074175079,-0.27064681109990785,-0.6546228050413375,-0.2228859265675662,-0.6657683129966571,-0.6836785974417924,-0.1825717105543826,-0.6506508821759039},
{-0.9521162555480324,-0.7757016940119493,-0.6378235652980182,-0.24286648934136712,-0.769127489002292,-0.7850048160416856,-0.2151188119816595,-0.9868397093582775,-0.34604192789626287,-0.7242950723156459,-0.6262503249430986,-0.40439328240503336,-0.0280533760520838,-0.49783245725744196,-0.9784798950067872,-0.9868690823764021,-0.6632803951743637,-0.8802950990428272,-0.2604803979729168,-0.0790861904475254},
{-0.14034546557616456,-0.5915842736984636,-0.43456881462999153,-0.49788436410327114,-0.38700187082075177,-0.9175229902809869,-0.012176452783587588,-0.22443281411380178,-0.7399246965911127,-0.5418530707885802,-0.8760515330367417,-0.2013925339818742,-0.2973776393436971,-0.945333843996415,-0.5783611070648562,-0.38378918439591597,-0.45058595551029357,-0.8845411675347216,-0.9115282841143508,-0.14067905363665656},
{-0.2350222359433867,-0.295506820067301,-0.057320334371446235,-0.1660619299737056,-0.8829653324089947,-0.14187171612459892,-0.3534224146130214,-0.7042921511441138,-0.6440965668246789,-0.9815635779391676,-0.07023981613563535,-0.8614533390016531,-0.25807634432371085,-0.19274158776673767,-0.47349146281493915,-0.6468877333848071,-0.5037018337225493,-0.06615577125951355,-0.22381443900636988,-0.2703809043311901},
{-0.6539675679612582,-0.39493221534889833,-0.8719707174450093,-0.2210395916772786,-0.7799678520968375,-0.5393219373404221,-0.6225173824200778,-0.0008847205019560932,-0.05780271973261686,-0.6845379238946354,-0.17848273463788256,-0.07143435339225379,-0.316198227301005,-0.8466955837876633,-0.925049763475556,-0.9463769509737402,-0.7454509748685753,-0.9542181814297724,-0.8139039459106217,-0.5140696973307753}};

static param_t xstream_shift[20][20] = {{1.0830734924655243,0.8970355739948876,3.680159541633025,1.305060534127768,0.7630283041171627,0.9869423307739874,1.6962513862077953,1.0958525977821085,0.06065792877721976,0.1494084532235065,1.6693947261911743,3.3326838035797612,0.5487245735845983,1.3210383742233125,1.3287699607787429,3.207710677413636,0.33674644429161515,2.6851222489807114,0.6103551999398111,2.957542005552612},
{2.32596077135261,0.42429384938340364,0.3819773083774046,1.1869436131609448,0.48765261166424145,0.6563792574950127,2.8230775523082583,0.4119093609731679,0.2834626448403905,0.3340768756345973,0.16098358907775354,1.8285046928044086,0.2762320813300758,2.753739386681285,1.5115655469733078,3.407034478766621,2.8113534394987036,1.6122795286466405,0.021726619260071356,3.2391064424255087},
{0.3563060993615471,0.19729489849172122,3.7926440588228982,0.8504105779846914,0.41191963028720346,0.5163436820394515,2.285764994918773,1.5435553372412365,0.348303367926291,0.5377092337230922,1.0406883988601439,1.282525315847504,0.8308115734013344,1.9869468980522562,1.3378964683163859,0.27250711790185844,2.880461353473182,2.340131986612967,0.32567114528466323,1.2001265217259625},
{2.0036915762757914,0.5760149878999257,0.6845221456437008,1.3754305780762772,0.37480731233583686,0.6176538118596948,1.41268225686172,0.880035090061158,0.333373838277811,0.8888930154908171,1.80535679585229,0.7664813328724676,0.4240638900369873,1.8868844997746028,1.5282991765878946,0.1470170613917467,1.038615337816733,2.632125708069008,0.5807181408790009,2.969230779442275},
{1.542262947772647,0.10095022684356203,3.14324266026946,1.268860660968899,0.532277462030829,0.6746857096657916,0.4309799414598522,1.1541372164279213,0.1977408229280846,0.9175252351625993,2.116013689217206,1.0887056362642615,0.24270204312878008,1.554053014293036,0.5547873356631836,1.6428669526394961,3.7345225131410036,1.481206639685709,0.768433843475204,1.3355044548783368},
{2.025432632572538,0.5361343019098778,0.7375482739773299,1.4421234430169934,0.48395611361089297,0.5557617602937984,1.463450761004817,2.1674887941582694,0.9484680176879351,0.30320577430203144,0.2444273255650978,2.4210821976673302,0.469257428059094,0.24597890924975313,1.0016076108285206,1.434902272434904,3.760073759590473,1.0489629284921629,0.04624603541280381,0.06606999949102307},
{2.4248393981639023,0.028213168706006764,0.09668335911301086,0.9050858288659772,0.7778776489117613,0.6247697571467891,0.23636932069552302,1.0818902186494592,0.14813925360846236,0.4240030873426085,1.4749243951551947,2.3357987207720026,0.7901731602159823,3.637970818746449,0.2935537444447746,1.500229277913394,0.11735379268678173,2.3535551216624615,0.8456681582139695,1.8385000313186033},
{1.793910079240042,0.18820999529802962,2.8594901533797645,0.7390797918688344,0.07803728203881188,0.028995059029964687,1.0356840154974944,2.1036603801149023,0.2013231991117891,0.7368857141689393,0.9480084781143171,3.135104363401864,0.9042774648148759,1.729083127672228,1.1448778874269436,1.9196365448450894,2.5589653482914687,0.2761757424405598,0.5191618460093,1.2343630366259326},
{1.0626646685677221,0.22344663743329818,1.2992676902316587,1.2512090091071786,0.4089163197423954,0.27431526641369286,2.7163557225346815,2.0819707041685906,0.7508416829228308,0.3998040280328945,0.798588417456585,2.687168963326763,0.4655924010471254,1.2423443979702622,0.8436848720820258,1.966737350142169,1.2891412024479565,1.0648780267950282,0.38090732302292174,1.7053559605460482},
{2.352759140535062,0.7156532741102234,0.14210070982893705,1.7584511931495503,0.5831292811416918,0.9910049554417582,1.8657529471727963,1.6684406466412864,0.8215927723737249,0.08758321348289078,0.8434446888356033,0.14720021805581596,0.9561320448555941,1.4207112517729557,1.1718976573431588,3.0666154630094145,3.754240151365518,0.5444599454058628,0.5883550431030695,0.4606118656180909},
{1.956108124991892,0.5660767233839927,2.2242299827703613,1.6828149957456906,0.9516717795896813,0.919133444419077,2.759818326826396,1.9995718811100816,0.7617221465794012,0.7723363406512026,2.0388215508088936,1.5474798842724597,0.7020282997665339,3.418771673498782,0.5497924645981732,2.248743700554888,0.4974867874341981,0.025490405699427437,0.27822899248328536,1.8140942312921629},
{1.3733309824661748,0.4045032886455934,1.3052246122843048,1.7307493704363355,0.25766752816316474,0.4484194333297852,3.3142167033611214,1.307622629713501,0.935638419526385,0.4718116146415744,0.9053307418023523,0.3898974549532427,0.9166442673469868,0.009393746396987854,1.1628421802805544,1.8833112142888337,2.4840993544902896,0.633774083194536,0.07136158733978892,2.0028476494673497},
{2.5021840974993244,0.6622899749331407,2.49852874538277,1.2375745525951352,0.866451523153617,0.6089701972106518,0.651703840250908,0.9849239723457708,0.3087022756576485,0.6777569942126047,2.1138164511555955,1.7017920151620745,0.6383265580130884,3.0826506900128554,0.14856714730517676,2.1999537724382923,1.4288808702834215,0.09778981289063841,0.6954446173000564,2.3537128131925065},
{1.751770084213341,0.4005678995321602,1.6661817367198442,0.7699347941648799,0.5464193913721834,0.8241898082137766,1.0272068677869375,0.8437811406891161,0.3684950284363565,0.7011770217584593,2.3953716378933394,1.9244472560562138,0.8767938139810953,1.0712474014307463,1.0434315348901158,0.9518127462489474,0.32634816002160766,0.22552632736326764,0.12078398449799588,2.0231896422602498},
{1.3479558029312744,0.7698370599195385,1.995153951894167,0.16735527596393632,0.8026276664459027,0.9519210455030019,3.0785727924551076,1.4053094317797346,0.7196062990191988,0.8562501510370208,1.9330844838380143,2.390033087989129,0.4658360220725881,1.1559102485438948,0.8328032907077891,2.7282381489570353,3.8466097481743255,0.7519783063077095,0.8498775604810646,0.16875188851891676},
{2.3438707683545994,0.844186623731223,0.1302638093110865,1.627033238800393,0.9831962581421948,0.9387111546916534,3.104631372575817,0.7775753779989546,0.8845220158620566,0.7985127074203103,1.1561047649830403,1.5569259111256957,0.2791069074175079,0.9877136912129516,1.155905407184951,0.7746021948782362,2.683337601631871,1.950809917109022,0.1825717105543826,2.2612266695992282},
{2.4347487965194468,0.7757016940119493,2.570708041461965,0.42884342875281467,0.769127489002292,0.7850048160416856,0.8670229353670996,2.523543507126326,0.34604192789626287,0.7242950723156459,1.6014454286335842,1.4054001926855426,0.0280533760520838,1.8168177632133549,1.7277586310007749,3.429695939256624,2.6733102042445105,2.5118358474596305,0.2604803979729168,0.27485062717336156},
{0.35889099825508625,0.5915842736984636,1.7515024641899735,0.8791432626357562,0.38700187082075177,0.9175229902809869,0.049076432402783476,0.5739189105100674,0.7399246965911127,0.5418530707885802,2.2402363191693446,0.6999055582235676,0.2973776393436971,3.449954487501979,1.02124570945787,1.3337941483420006,1.816058550077115,2.5239515880337926,0.9115282841143508,0.48890616558203265},
{0.6009981478460357,0.295506820067301,0.231026027454968,0.2932251692210048,0.8829653324089947,0.14187171612459892,1.4244469673272226,1.801013749533359,0.6440965668246789,0.9815635779391676,0.17961704446013205,2.9938348169936324,0.25807634432371085,0.7034019884795693,0.8360713038237939,2.248148484905708,2.030138779592875,0.18876901387576764,0.22381443900636988,0.939662926113968},
{1.6723238782851526,0.39493221534889833,3.514423513354955,0.39030241118102493,0.7799678520968375,0.5393219373404221,2.5090174273968926,0.0022624045801568717,0.05780271973261686,0.6845379238946354,0.4564155068531562,0.24825796666248245,0.316198227301005,3.089978474152074,1.633413952709811,3.288972411563225,3.004493593326101,2.7227681228933336,0.8139039459106217,1.786561951241448}};

const static score_t log_LUT_xstream_d0[128] = {1.0,2.0,2.584962500721156,3.0,3.321928094887362,3.584962500721156,3.807354922057604,4.0,4.169925001442312,4.321928094887362,4.459431618637297,4.584962500721156,4.700439718141093,4.807354922057604,4.906890595608519,5.0,5.087462841250339,5.169925001442312,5.247927513443585,5.321928094887363,5.392317422778761,5.459431618637297,5.523561956057013,5.584962500721156,5.643856189774724,5.700439718141092,5.754887502163468,5.807354922057604,5.857980995127572,5.906890595608519,5.954196310386875,6.0,6.044394119358453,6.087462841250339,6.129283016944966,6.169925001442312,6.20945336562895,6.247927513443585,6.285402218862249,6.321928094887363,6.357552004618084,6.392317422778761,6.426264754702098,6.459431618637297,6.491853096329675,6.523561956057013,6.554588851677638,6.584962500721156,6.614709844115208,6.643856189774724,6.672425341971495,6.700439718141092,6.727920454563199,6.754887502163468,6.78135971352466,6.807354922057604,6.832890014164741,6.857980995127572,6.882643049361842,6.906890595608519,6.930737337562887,6.954196310386875,6.977279923499917,7.0,7.022367813028454,7.044394119358453,7.066089190457772,7.087462841250339,7.108524456778169,7.129283016944966,7.149747119504682,7.169925001442312,7.189824558880018,7.20945336562895,7.22881869049588,7.247927513443585,7.266786540694901,7.285402218862249,7.303780748177103,7.321928094887363,7.339850002884624,7.357552004618084,7.3750394313469245,7.392317422778761,7.409390936137702,7.426264754702098,7.442943495848728,7.459431618637297,7.475733430966398,7.491853096329675,7.507794640198696,7.523561956057013,7.539158811108031,7.554588851677638,7.569855608330948,7.584962500721156,7.599912842187128,7.614709844115208,7.6293566200796095,7.643856189774724,7.658211482751795,7.672425341971495,7.6865005271832185,7.700439718141092,7.714245517666122,7.727920454563199,7.7414669864011465,7.754887502163468,7.768184324776926,7.78135971352466,7.794415866350106,7.807354922057604,7.820178962415188,7.832890014164741,7.845490050944375,7.857980995127572,7.870364719583405,7.882643049361842,7.894817763307944,7.906890595608519,7.918863237274595,7.930737337562887,7.94251450533924,7.954196310386875,7.965784284662087,7.977279923499917,7.9886846867721655,8.0};
#endif