#ifndef XSTREAM_GENERATOR_1_H_
#define XSTREAM_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void xstream_http1_c7(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_xstream
);
    
#define ENSEMBLE 140
#define DIM_MAX 3
#define BATCH_SIZE 128
#define K_NUM 20
#define HASH_NUM 2
#define MATRIX_COL 128
const static param_t bottom_xstream = -7.964051379979506;
const static param_t delta_xstream = 0.1435945752604345;

static param_t xstream_fs[20][2] = {{6,12},
{11,17},
{2,16},
{6,3},
{7,8},
{17,3},
{8,19},
{12,5},
{5,1},
{16,4},
{9,6},
{11,10},
{6,0},
{0,10},
{17,3},
{19,18},
{15,0},
{14,19},
{14,13},
{11,2}};

static param_t xstream_R_T[3][20] = {{0.0,0.0,0.38729833462074165,-0.38729833462074165,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.0,0.0,0.0,0.38729833462074165,0.38729833462074165,0.0,-0.38729833462074165,0.0,0.0,0.0},
{0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.0,0.38729833462074165,0.0,-0.38729833462074165,0.0,-0.38729833462074165,-0.38729833462074165,0.38729833462074165,0.0,0.38729833462074165},
{-0.38729833462074165,0.0,0.0,0.0,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.38729833462074165,-0.38729833462074165,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,-0.38729833462074165}};

static param_t xstream_deltamax[20] = {0.2779276393653878,1.0,0.2774557911045441,0.4964907665775345,1.0,1.0,0.2774557911045441,0.2779276393653878,1.0,1.0,0.2779276393653878,0.20501063765127978,1.0,0.2981485530810293,0.4964907665775345,0.20501063765127978,0.2774557911045441,0.39093570056855725,1.0,0.20501063765127978};

static param_t xstream_shift_deltamax[20][20] = {{-0.6198531400652684,-0.03470471051053681,-0.9491500368604369,-0.6731992355462723,-0.9079605935066858,-0.35426356334995535,-0.05319793349359547,-0.8955725645722137,-0.5934303217496262,-0.970072609349229,-0.5886473498882013,-0.29894233621268806,-0.3369680219357989,-0.5719981815030885,-0.4670868577730578,-0.32606648737250665,-0.14990593671822058,-0.8965759699057454,-0.20720217712748645,-0.22102987820334888},
{-0.409232767062374,-0.9304482625040522,-0.6623161265946776,-0.31993351230228895,-0.4485973350735951,-0.3851217786674157,-0.08880503062449928,-0.28630823949935347,-0.32583455568349085,-0.25621326021547297,-0.9311525409125476,-0.5702427808429525,-0.02895720044723271,-0.0958075326390494,-0.44359841434259784,-0.23072969276772914,-0.8422735639945528,-0.21944205796415361,-0.9555274714819829,-0.8458794242966852},
{-0.27644616748392903,-0.2565498546336963,-0.31901988567421435,-0.9883321472335553,-0.9696230199866547,-0.411400051664488,-0.06512939202694634,-0.8350160344220857,-0.1590070823560552,-0.3481723024310772,-0.7304148177941561,-0.11736955199757604,-0.17345832677564066,-0.46067247623329666,-0.388068264385669,-0.3051204524318981,-0.31235077232534425,-0.34513743810074415,-0.3861909408369638,-0.07212735353393773},
{-0.6326599415783836,-0.8015624759902779,-0.5751340967084242,-0.17125817719369674,-0.17522795892601772,-0.8970878764035349,-0.5931634556256887,-0.7163806673097907,-0.9991797723974604,-0.27148166756383374,-0.32218260878722127,-0.41263743625071037,-0.7811502070545949,-0.8185362580740908,-0.5867938531412973,-0.1825096882228351,-0.39997194793131874,-0.8506907673947729,-0.12066733896288206,-0.8641898734026678},
{-0.12367670885663617,-0.2377261076223517,-0.18706538892867897,-0.8071899994788692,-0.6657597043943888,-0.3092497564912505,-0.5508025791614255,-0.3152317232070171,-0.37902613696630605,-0.8963217312941728,-0.6836102899981078,-0.8164466464333291,-0.28462092504570713,-0.39743081994016105,-0.07846738458216151,-0.7771103322957815,-0.6610193392728481,-0.9470186364208742,-0.2590710898237163,-0.4752762175492261},
{-0.43138248856943956,-0.2742876179150612,-0.6749125451546641,-0.19990910504662018,-0.4596200816603975,-0.7966770559634846,-0.771094129927086,-0.42946743912966656,-0.09286519286734363,-0.6490205884783861,-0.9635831823757396,-0.7285134287022732,-0.40358464882356226,-0.6964271445253225,-0.4416097526741749,-0.8372661382561336,-0.3389222658334573,-0.03109683307356115,-0.5870600351488898,-0.8560314507576154},
{-0.34865111546662897,-0.7580781641713302,-0.9166176721195143,-0.958787909920701,-0.7845906462180483,-0.7897954501335667,-0.3934606538087113,-0.576716071471788,-0.590636099175649,-0.4597709473362892,-0.9292001124091224,-0.15966977178880548,-0.7724273255259442,-0.2851517650344685,-0.5934442990452804,-0.7134801071087379,-0.3208497588452316,-0.26310034455319686,-0.6356502851435089,-0.5486489893950178},
{-0.5130905727236351,-0.4161328047870352,-0.3647999644942586,-0.11618732922296549,-0.8952898095750289,-0.58013164850569,-0.17126607352428705,-0.545989707374774,-0.5723468965329718,-0.6694768694435879,-0.8405017358460145,-0.3661543988800634,-0.47573335511160975,-0.5879452063708694,-0.6538756970340591,-0.8923373367363404,-0.08594451018164195,-0.8112806250886264,-0.9067496462477761,-0.005573043012734202},
{-0.7942887067593724,-0.2155489296807096,-0.7813714237078428,-0.12709851461536992,-0.032146265585274,-0.9984864760142114,-0.9333643687367849,-0.621441556881867,-0.8922361509131799,-0.2752281021626075,-0.6785147905695768,-0.8162479188203994,-0.521935630931442,-0.1524138545030963,-0.3541736704821403,-0.5214075825868936,-0.2272499685887226,-0.9575194991388278,-0.046274699152862975,-0.9910826660027307},
{-0.797829344069461,-0.6219178427473532,-0.12749205069341374,-0.28780122766625726,-0.7523771856538286,-0.6359929767351813,-0.7989273191444024,-0.578554517677177,-0.26077996955834115,-0.5936430915353882,-0.8999964150435016,-0.3404846068989479,-0.4075232352115703,-0.362100852888667,-0.5962638931729028,-0.7723650748997801,-0.9003091157824384,-0.11841865586651089,-0.6763502893970513,-0.34016871022337913},
{-0.03358748925206523,-0.7302894976773635,-0.7668422495974773,-0.02734151695526632,-0.9852224211236651,-0.9315381406436698,-0.3632758009292518,-0.9158080235490517,-0.7406577504874002,-0.3969514258924588,-0.26620324660912253,-0.6573303818162074,-0.44048824807618203,-0.24725126631932837,-0.8203330004127046,-0.277967033211872,-0.07532770849894943,-0.393860713217566,-0.6162852259119285,-0.6288619971122011},
{-0.7021921544129515,-0.5423187532376397,-0.4127753983466561,-0.4654056786989268,-0.35876812660934554,-0.3671253791418011,-0.9221336010380329,-0.34738993961502174,-0.20731163136914976,-0.03798683874654485,-0.4183615138854331,-0.005944300256709445,-0.3350675217552933,-0.35643747298654815,-0.7275260696828306,-0.2694573609660883,-0.3329324217509261,-0.4635487960236818,-0.09170615903267765,-0.933768895743471},
{-0.005718753518169084,-0.9841027500510482,-0.2515753814134145,-0.17834137838284758,-0.4380691220995627,-0.9033439423744106,-0.8834068469430364,-0.2662192729525348,-0.2972696156959468,-0.8881896444144951,-0.883989981681809,-0.3788220874445959,-0.543681888399583,-0.9430776007366022,-0.027163678247457912,-0.4187658643213159,-0.6140133634174311,-0.7238322403447656,-0.7508945339187357,-0.9488566290506659},
{-0.6177805062372496,-0.496550274138034,-0.8327043953268849,-0.47028921213722885,-0.9083007786169436,-0.6011802444411047,-0.7574120582954114,-0.9764429286042515,-0.8759954457051347,-0.026254695492307967,-0.8399064052368792,-0.12169916346527156,-0.02201134686698425,-0.9496306642359086,-0.9148922657168047,-0.6957957081677917,-0.07488748891113794,-0.7249956577184273,-0.17536154223082856,-0.9627794210884255},
{-0.5123883520640269,-0.668826702310852,-0.9606634018393727,-0.6566220535286619,-0.6243232497579192,-0.7740512088297383,-0.6471189396049044,-0.6684468936600743,-0.3844573145010989,-0.2803489895011412,-0.6887091700330207,-0.13362103809580683,-0.6329137308948776,-0.014993595357710722,-0.9629562919329919,-0.06221520972658545,-0.6350067433945786,-0.5232357592949702,-0.17612986632373195,-0.5932721704213829},
{-0.8714160364948188,-0.8248228567654916,-0.5297587063901346,-0.6731114171953404,-0.9695590898541014,-0.07931774145358295,-0.662560858245286,-0.7138404966008159,-0.7652175380142457,-0.2770069718550392,-0.9750549254694919,-0.9316897591481532,-0.02290259735154354,-0.9292617662157722,-0.16266177683057503,-0.5697493010175035,-0.26941546214291934,-0.8092718976309392,-0.6935349280249691,-0.9530368325739093},
{-0.7935764233487429,-0.9214741495430356,-0.13842006951328667,-0.027082485343501994,-0.7410457550593789,-0.08069961942105242,-0.356538581738976,-0.5753016501548776,-0.6735314036072263,-0.687667005476561,-0.20332723378775308,-0.4132987041529729,-0.1401443803040141,-0.7164726167838967,-0.6982652454026659,-0.5140390038642395,-0.45847739341285176,-0.5319941036150573,-0.23996782764165925,-0.24603745339297567},
{-0.9596460638902843,-0.13105738339932305,-0.531067665893948,-0.1709441034735637,-0.10198437672367444,-0.7482561050457166,-0.7208199195955067,-0.7024027228301943,-0.7878751917262993,-0.42731984528199496,-0.6132930355886826,-0.6272769905115779,-0.32325978663776656,-0.2930604277426232,-0.8891811077425622,-0.859936325928703,-0.4429585768596771,-0.27154243303229697,-0.2108459607563783,-0.24196041745786634},
{-0.34234924208176665,-0.13455627783987656,-0.11553696311341421,-0.10467979060624688,-0.8031736418786029,-0.2466097329366892,-0.6494337859592465,-0.7191628121189214,-0.3392423662566141,-0.35054826971551634,-0.14278593340642776,-0.4719556517743126,-0.4089680548883856,-0.6822048238126207,-0.44603861268098144,-0.958201269202717,-0.06907549155063653,-0.061569433140515106,-0.2624312698404285,-0.8041400782405551},
{-0.02714987932284429,-0.5853613479702114,-0.6062148151179771,-0.8218201384072931,-0.7411252094355031,-0.21195650776808939,-0.6736944410303296,-0.11085436686575967,-0.11424998023537558,-0.4357644805778923,-0.6402047578949549,-0.3097263493876131,-0.33239077659209915,-0.19789332011254301,-0.2592961551528802,-0.6196331915976445,-0.4683742889002186,-0.9617523371819087,-0.2274203447333033,-0.010659652925145258}};

static param_t xstream_shift[20][20] = {{2.2302680707849847,0.03470471051053681,3.4209054822099616,1.3559149149677934,0.9079605935066858,0.35426356334995535,0.191734810370387,3.222322783790555,0.5934303217496262,0.970072609349229,2.1179878015454032,1.4581796322256446,0.3369680219357989,1.9185006118330339,0.9407765243910435,1.5904856992208432,0.5402876477057806,2.2934103193998663,0.20720217712748645,1.078138582151613},
{1.4724435755896919,0.9304482625040522,2.3871050734173354,0.6443896520124438,0.4485973350735951,0.3851217786674157,0.32006911901520896,1.0301538924055977,0.32583455568349085,0.25621326021547297,3.350341632227422,2.781527765466139,0.02895720044723271,0.3213415985051295,0.8934676014228016,1.1254522956033,3.0357036724354685,0.5613251940025127,0.9555274714819829,4.126026990538482},
{0.9946695769991013,0.2565498546336963,1.1498043865085845,1.9906355037505261,0.9696230199866547,0.411400051664488,0.23473790821834342,3.004436825098569,0.1590070823560552,0.3481723024310772,2.628075492822394,0.5725046921575845,0.17345832677564066,1.5451105546975352,0.781622319103222,1.488315220749197,1.1257677162977358,0.8828496287210239,0.3861909408369638,0.3518224925314624},
{2.276347696195246,0.8015624759902779,2.072885537616031,0.3449372852877662,0.17522795892601772,0.8970878764035349,2.137866552593193,2.577579793595032,0.9991797723974604,0.27148166756383374,1.159231983990092,2.012761098536754,0.7811502070545949,2.7453973853484817,1.1818827109036691,0.8902449663772155,1.4415700113486227,2.176037558497653,0.12066733896288206,4.2153416198462965},
{0.4449960757376853,0.2377261076223517,0.6742169200504939,1.6257905560723338,0.6657597043943888,0.3092497564912505,1.9851904224766588,1.1342222886748812,0.37902613696630605,0.8963217312941728,2.459670047783101,3.982459914212322,0.28462092504570713,1.3329959707439847,0.15804399570824174,3.790585411561108,2.382431221353671,2.422440915586829,0.2590710898237163,2.3183002745333843},
{1.5521395768857187,0.2742876179150612,2.4325048054245157,0.4026441547436137,0.4596200816603975,0.7966770559634846,2.7791603370662434,1.5452491163178321,0.09286519286734363,0.6490205884783861,3.4670289884660574,3.553539645788841,0.40358464882356226,2.3358394241009486,0.8894621660707378,4.08401314121227,1.221536103046243,0.07954462339544707,0.5870600351488898,4.175546501219673},
{1.254467228458203,0.7580781641713302,3.3036530557552384,1.931129387420283,0.7845906462180483,0.7897954501335667,1.4181021496879014,2.075058359753803,0.590636099175649,0.4597709473362892,3.34331667958909,0.7788365209633732,0.7724273255259442,0.9564083477439228,1.1952776143976993,3.4802101748610603,1.156399574750043,0.6730015810031086,0.6356502851435089,2.6761976631098627},
{1.846130071464687,0.4161328047870352,1.3148039298152678,0.23401709970133167,0.8952898095750289,0.58013164850569,0.6172733783731144,1.9645030937602022,0.5723468965329718,0.6694768694435879,3.0241747016064786,1.7860263402667276,0.47573335511160975,1.9719874548949454,1.3169946775474355,4.352639194528987,0.3097592947672822,2.0752277776338683,0.9067496462477761,0.02718416505885841},
{2.8578975037280534,0.2155489296807096,2.8162015310519344,0.2559937126152407,0.032146265585274,0.9984864760142114,3.3640111277587184,2.2359832879552726,0.8922361509131799,0.2752281021626075,2.4413361410145407,3.9814905615230836,0.521935630931442,0.5112010537299977,0.7133539923079935,2.5433196470214416,0.8190492895608577,2.4493017592055666,0.046274699152862975,4.8342987337493595},
{2.870636925104687,0.6219178427473532,0.4595040175080552,0.5796708560164386,0.7523771856538286,0.6359929767351813,2.8794760994675728,2.0816731973769587,0.26077996955834115,0.5936430915353882,3.238240058090402,1.6608143401714959,0.4075232352115703,1.2144981055475963,1.2009566608521958,3.7674390155966555,3.2448741192185313,0.30291082572988026,0.6763502893970513,1.6592734607362245},
{0.12084976265317823,0.7302894976773635,2.76383580441662,0.05506953763458667,0.9852224211236651,0.9315381406436698,1.3093105733459753,3.295131155865542,0.7406577504874002,0.3969514258924588,0.9578149449869887,3.2063232881325754,0.44048824807618203,0.8292888352610307,1.6522623493434037,1.3558663901367403,0.2714944539419121,1.0074820811830558,0.6162852259119285,3.067460324580262},
{2.5265286893247376,0.5423187532376397,1.4877159229706767,0.9373904008469545,0.35876812660934554,0.3671253791418011,3.323533444254465,1.249929443535167,0.20731163136914976,0.03798683874654485,1.5052893438044093,0.02899508203481917,0.3350675217552933,1.1955029440967215,1.465336555396376,1.3143579477296758,1.199947640038548,1.1857417865636721,0.09170615903267765,4.554733873526108},
{0.020576411656023585,0.9841027500510482,0.9067224021956781,0.359203816844793,0.4380691220995627,0.9033439423744106,3.1839553372673075,0.9578726087135934,0.2972696156959468,0.8881896444144951,3.1806479690191556,1.8478167366562068,0.543681888399583,3.163113122606023,0.05471134626471627,2.042654318424348,2.2130133271792967,1.851537834206649,0.7508945339187357,4.628328753675006},
{2.2228106123157536,0.496550274138034,3.001214687254899,0.9472265020739034,0.9083007786169436,0.6011802444411047,2.729847718370462,3.5132991120776405,0.8759954457051347,0.026254695492307967,3.0220326670449116,0.5936236522139896,0.02201134686698425,3.185092311944988,1.8427175836993748,3.3939492903355113,0.2699078242808083,1.8545138156070937,0.17536154223082856,4.69624128834768},
{1.8436034402119925,0.668826702310852,3.462401696554962,1.3225262134378897,0.6243232497579192,0.7740512088297383,2.33233170959864,2.4051112555281917,0.3844573145010989,0.2803489895011412,2.4780161181723415,0.6517761206279176,0.6329137308948776,0.05028900929677106,1.9395250763089706,0.30347308041845444,2.2886772010295178,1.338418974102397,0.17612986632373195,2.8938604221627298},
{3.135406174371811,0.8248228567654916,1.9093445636192319,1.3557380368527436,0.9695590898541014,0.07931774145358295,2.387987129796963,2.568440109917745,0.7652175380142457,0.2770069718550392,3.5083049951271676,4.544592270050613,0.02290259735154354,3.116774361682789,0.32762296457566237,2.7791206717118704,0.9710212249323885,2.0700895222768727,0.6935349280249691,4.648718932307364},
{2.8553346661050814,0.9214741495430356,0.4988905402271117,0.05454781270191589,0.7410457550593789,0.08069961942105242,1.2850284375741643,2.069969188629477,0.6735314036072263,0.687667005476561,0.7315833511630035,2.015986628245058,0.1401443803040141,2.4030725937790396,1.4064012715000234,2.5073772256570055,1.6524340385459806,1.360822515931269,0.23996782764165925,1.2001204240507848},
{3.452863004491073,0.13105738339932305,1.9140622863908583,0.34430469805498026,0.10198437672367444,0.7482561050457166,2.597963144780442,2.527286326880051,0.7878751917262993,0.42731984528199496,2.2066644288745763,3.0597289862517636,0.32325978663776656,0.9829342611734115,1.7909318110223167,4.1945936844089164,1.5965014645982727,0.6945961513296925,0.2108459607563783,1.1802334758327888},
{1.2317927172104126,0.13455627783987656,0.4164157563749693,0.2108393502014897,0.8031736418786029,0.2466097329366892,2.340674827416173,2.5875901143226985,0.3392423662566141,0.35054826971551634,0.5137521900753058,2.3021032331849165,0.4089680548883856,2.2881372951932946,0.8983824931038789,4.673909998917246,0.24896035247867357,0.15749248035155555,0.2624312698404285,3.9224309892074287},
{0.09768686333190024,0.5853613479702114,2.184905972604328,1.655257647735033,0.7411252094355031,0.21195650776808939,2.4281145415937075,0.39886053477402045,0.11424998023537558,0.4357644805778923,2.3034943892474335,1.5107818449618857,0.33239077659209915,0.663740669097799,0.5222577590723174,3.0224440970308666,1.6881042094512897,2.460129212510355,0.2274203447333033,0.0519956088487329}};

const static score_t log_LUT_xstream_d0[128] = {1.0,2.0,2.584962500721156,3.0,3.321928094887362,3.584962500721156,3.807354922057604,4.0,4.169925001442312,4.321928094887362,4.459431618637297,4.584962500721156,4.700439718141093,4.807354922057604,4.906890595608519,5.0,5.087462841250339,5.169925001442312,5.247927513443585,5.321928094887363,5.392317422778761,5.459431618637297,5.523561956057013,5.584962500721156,5.643856189774724,5.700439718141092,5.754887502163468,5.807354922057604,5.857980995127572,5.906890595608519,5.954196310386875,6.0,6.044394119358453,6.087462841250339,6.129283016944966,6.169925001442312,6.20945336562895,6.247927513443585,6.285402218862249,6.321928094887363,6.357552004618084,6.392317422778761,6.426264754702098,6.459431618637297,6.491853096329675,6.523561956057013,6.554588851677638,6.584962500721156,6.614709844115208,6.643856189774724,6.672425341971495,6.700439718141092,6.727920454563199,6.754887502163468,6.78135971352466,6.807354922057604,6.832890014164741,6.857980995127572,6.882643049361842,6.906890595608519,6.930737337562887,6.954196310386875,6.977279923499917,7.0,7.022367813028454,7.044394119358453,7.066089190457772,7.087462841250339,7.108524456778169,7.129283016944966,7.149747119504682,7.169925001442312,7.189824558880018,7.20945336562895,7.22881869049588,7.247927513443585,7.266786540694901,7.285402218862249,7.303780748177103,7.321928094887363,7.339850002884624,7.357552004618084,7.3750394313469245,7.392317422778761,7.409390936137702,7.426264754702098,7.442943495848728,7.459431618637297,7.475733430966398,7.491853096329675,7.507794640198696,7.523561956057013,7.539158811108031,7.554588851677638,7.569855608330948,7.584962500721156,7.599912842187128,7.614709844115208,7.6293566200796095,7.643856189774724,7.658211482751795,7.672425341971495,7.6865005271832185,7.700439718141092,7.714245517666122,7.727920454563199,7.7414669864011465,7.754887502163468,7.768184324776926,7.78135971352466,7.794415866350106,7.807354922057604,7.820178962415188,7.832890014164741,7.845490050944375,7.857980995127572,7.870364719583405,7.882643049361842,7.894817763307944,7.906890595608519,7.918863237274595,7.930737337562887,7.94251450533924,7.954196310386875,7.965784284662087,7.977279923499917,7.9886846867721655,8.0};
#endif