#ifndef LODA_GENERATOR_1_H_
#define LODA_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void loda_smtp1_c1(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_loda
);
    
#define ENSEMBLE 35
#define DIM_MAX 3
#define BATCH_SIZE 128
#define N_BINS 20
const static param_t bottom_loda = 0.9718000593034282;
const static param_t delta_loda = 0.07128498340681227;
static param_t loda_min_X[35] = {-7.300350249847751,-8.684076790658226,-5.505715456311795,-1.8599031404916893,-7.723582008531954,-13.181684869965514,-7.67491480915203,-3.6709536733872787,-7.763232601568697,-13.457377023433587,-2.116659732506305,-5.531817927701745,-6.514013525158761,-8.115472951773489,-2.593603113141379,-9.155924444013625,0.3778900689725142,-7.723973895177794,1.8271411336131955,-6.636202581131882,-7.714425701750791,-4.939520037575342,-0.31242273859845765,-3.709628249860376,-5.970234505493184,-8.019561183560109,-1.6929964535987174,-12.614300817222528,-5.490784388966301,-14.155453105842303,-9.010593988281586,-6.711042909707342,-6.56900803641904,-4.8697525445135135,-5.429345722510278};

static param_t loda_projections[35][3] = {{-0.35534597090887576,-0.7611226760545963,0.5426062227382936},
{0.22180331100535713,-0.8377565703256792,0.4989661512599988},
{0.2848229555261605,0.3933570550990739,-0.8741545122054378},
{-0.009908971452286171,0.9947600218840728,0.10175613566737342},
{-0.563728453609407,-0.6950304163300541,0.4462543568047469},
{0.14779775260372569,-0.18801546053417903,-0.9709819828016422},
{0.2819668364737423,-0.6421460960013884,0.7128415634060388},
{0.4773676146978671,0.8695922303102228,-0.12621217620246156},
{0.03291386639988711,-0.7290976384149664,0.6836178106634797},
{0.20872234128844433,-0.9702194613203624,-0.12291940905445303},
{0.3209139451444953,0.11953445045628892,0.9395348609636095},
{0.9381477157557644,0.032253314894614624,-0.34472973051442823},
{-0.3155102356134887,-0.6824692479896526,0.6593094999858254},
{0.5906487652756708,-0.6914410851147821,0.4159846894942388},
{0.9585762712594529,0.04000915635630219,0.28201205574581506},
{0.8992670876417634,-0.3338015540695736,-0.28265743858076425},
{0.25648454106290336,0.44749564724132784,0.8567165960198372},
{-0.8067702548108535,0.194803241132597,-0.5578292330065409},
{-0.1479715925795654,0.5980976855435601,0.787644314609649},
{-0.0517680520093862,0.30205081871558426,-0.9518851672887852},
{0.6887093107904505,-0.634642368204288,0.3505831566270627},
{0.43785038529885917,0.7570178988102402,-0.48498550594277495},
{-0.7332801760770566,0.480580001285098,0.48098133616307426},
{-0.30403108184490474,-0.2754750570679555,0.9119641408551235},
{-0.06196856488918123,0.34251237343267826,-0.9374674239732754},
{-0.9577919163704035,-0.2575772491570049,0.12762682183702675},
{0.012361496927385912,0.09545360618024205,0.9953571230773914},
{-0.6191542787576572,-0.7683778275553573,-0.16199843584860557},
{0.5331904487775688,0.4594116626786416,-0.7103864226793899},
{0.13145668720685363,-0.9702707796130352,-0.20320864552895496},
{-0.47703834129093886,0.06513903038137375,-0.8764652461218095},
{-0.17153390003229838,-0.6423595626074924,0.7469607174854782},
{-0.9532985758422605,-0.18958513517120085,0.23511550739846052},
{0.1711969745950487,0.7899377415630371,-0.5888038385946466},
{-0.5063596341505865,0.5728782226471061,-0.6445234386114884}};

static param_t loda_delta[35] = {1.6234648209403464,1.4828755787343635,1.9683233192132847,1.3402047628034717,1.5828467222344098,1.444938496257981,1.5155407756339,1.3235406664262919,1.5515984902390347,1.2880789115636058,1.5319930963136512,2.0569593436098805,1.6968244907977192,1.5579382302055713,1.7311918593849422,1.8020420151144465,1.4556834897444366,1.6000676153547622,1.401098977209209,1.7421840543269127,1.644898441517122,1.5636691447704891,1.5374148731128017,1.8101865329891793,1.7947798703315996,1.7553253809644649,1.4639693810529462,1.3244013137617507,2.051096835309755,1.2713293566865826,1.5781171133000902,1.6728902221838586,1.9490467945142302,1.6058041396157987,1.552453126928543};

const static score_t log_LUT_loda[128] = {15.0,7.0,6.0,5.415037499278844,5.0,4.678071905112637,4.415037499278844,4.192645077942396,4.0,3.830074998557688,3.678071905112638,3.5405683813627027,3.415037499278844,3.299560281858908,3.192645077942396,3.0931094043914813,3.0,2.9125371587496605,2.830074998557688,2.7520724865564143,2.678071905112638,2.6076825772212398,2.5405683813627027,2.476438043942987,2.415037499278844,2.356143810225275,2.299560281858908,2.2451124978365313,2.192645077942396,2.1420190048724277,2.0931094043914813,2.0458036896131246,2.0,1.9556058806415466,1.9125371587496607,1.8707169830550336,1.8300749985576876,1.7905466343710503,1.7520724865564146,1.7145977811377517,1.6780719051126376,1.6424479953819162,1.6076825772212398,1.573735245297902,1.5405683813627027,1.5081469036703252,1.4764380439429872,1.4454111483223626,1.415037499278844,1.3852901558847919,1.3561438102252752,1.3275746580285044,1.2995602818589078,1.2720795454368008,1.2451124978365316,1.2186402864753405,1.1926450779423958,1.1671099858352583,1.142019004872428,1.1173569506381587,1.0931094043914815,1.0692626624371138,1.0458036896131249,1.0227200765000835,1.0,0.9776321869715455,0.9556058806415466,0.9339108095422276,0.9125371587496606,0.891475543221831,0.8707169830550335,0.850252880495318,0.8300749985576876,0.8101754411199827,0.7905466343710502,0.7711813095041191,0.7520724865564145,0.7332134593050986,0.7145977811377517,0.6962192518228971,0.6780719051126376,0.6601499971153753,0.6424479953819163,0.6249605686530753,0.6076825772212398,0.5906090638622983,0.5737352452979021,0.5570565041512716,0.5405683813627027,0.5242665690336022,0.5081469036703252,0.49220535980130375,0.47643804394298717,0.4608411888919686,0.44541114832236267,0.4301443916690522,0.4150374992788438,0.40008715781287235,0.3852901558847918,0.37064337992039037,0.3561438102252753,0.34178851724820525,0.3275746580285044,0.31349947281678164,0.2995602818589079,0.28575448233387735,0.27207954543680085,0.25853301359885306,0.24511249783653147,0.23181567522307364,0.2186402864753404,0.20558413364989406,0.1926450779423959,0.1798210375848123,0.16710998583525832,0.1545099490556248,0.14201900487242788,0.12963528041659547,0.11735695063815874,0.1051822366920565,0.09310940439148148,0.0811367627254055,0.06926266243711372,0.05748549466076013,0.04580368961312479,0.03421571533791296,0.02272007650008353,0.011315313227834146};
#endif