#ifndef LODA_GENERATOR_1_H_
#define LODA_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void loda_http1_c1(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_loda
);
    
#define ENSEMBLE 35
#define DIM_MAX 3
#define BATCH_SIZE 128
#define N_BINS 20
const static param_t bottom_loda = 0.8953576384868612;
const static param_t delta_loda = 0.07089864275670443;
static param_t loda_min_X[35] = {-4.980293099142689,-12.967849603926615,-6.435339289007132,-8.364985138145116,-3.1038029153646853,-2.9496618180973484,-9.709886108128357,-5.744683435161983,-13.613223138471273,-4.904031265437211,-8.29914600810951,-17.29941171374788,-16.50561602112477,-3.8500511683036893,-8.955042702853593,-2.841844290600848,-3.6930489514765883,-5.766356262135202,-9.170748085275376,-9.549956121060408,-3.1281757197461286,-3.6885973845599187,-5.610185815758991,-11.101438743498084,-11.799680075348958,-3.844604261591659,-3.389570907423897,-6.264090515383587,-3.578235307268851,-2.6688324794378624,-3.3929669956790947,-17.03079393695422,-10.617714862126538,-14.089423830986746,-3.7830500776335407};

static param_t loda_projections[35][3] = {{0.9620878509661543,0.10736122520546743,-0.2507200317998299},
{-0.8222576334475065,-0.1392418902327797,-0.5518188835494021},
{0.9194542698020428,-0.372669442677178,0.12538473686008858},
{-0.17645446821642002,-0.6546882110459308,0.7350150794126193},
{0.9161760296486187,0.39947098000830694,0.03231746940118313},
{0.09506041647596482,-0.040743374077033746,0.994637368435469},
{-0.9619099692439109,0.02255786621291024,-0.27243412734292055},
{0.9442322214947269,-0.3292700368121431,0.0025989899697858128},
{-0.012378002786039845,-0.9189487004467691,-0.39418278881024604},
{0.40887772540722517,-0.17577609898383673,0.895500847957074},
{0.8951488234337195,-0.38249338715705017,-0.22892660982584473},
{-0.10749671559227246,-0.24651971164217606,-0.963157561310055},
{0.13997798030707057,-0.31759422761838707,-0.9378379772714653},
{0.38933093531948315,0.7547857461120204,0.5279392960079567},
{-0.6322042015621706,-0.6774541736848064,0.37599692829087616},
{-0.5650157275415988,0.8243830282926229,-0.03390944254514575},
{-0.43161622467617183,0.7152472990647375,0.5496623834472267},
{-0.32315801069164174,-0.2616871932271848,0.9094441780707042},
{-0.5645447292291208,-0.8140208032219072,0.13659934341562469},
{-0.24592462356249795,-0.8284413943641902,0.5031957229841683},
{0.12198077564253829,0.9503759248196902,0.2861927530472484},
{-0.4788618570747593,0.7111938897787977,0.5146790970888717},
{-0.9202516133211326,0.26315928129138455,0.2896276244595027},
{0.288802936318219,-0.9565167540856262,0.04084804924929001},
{-0.07019665754542721,-0.9938358156003869,-0.08580676488112016},
{0.6805452788135697,0.6489326546507003,0.34021248244671376},
{0.22505473018633954,0.330400770149027,0.91661644077863},
{-0.7908218624446897,0.11092298035073109,0.6019110185979517},
{0.3902875859134044,0.2898385783142972,0.8738816846705474},
{0.03642976078457454,0.99891084779621,-0.029154599709749717},
{0.8960624486402241,0.41188434087094716,0.16560005399211428},
{0.011010040568642613,-0.24336139053901124,-0.9698731940834305},
{-0.07395793815627562,-0.9116332502780098,0.4042957338028984},
{0.4377010191329793,-0.3171950873510098,-0.8413115323174506},
{0.292219713292541,0.7097273299923273,0.641010730195047}};

static param_t loda_delta[35] = {1.5603996209825808,1.2156285576806014,1.6178573043534517,1.1454313711061086,1.5332766935937339,1.0407915571110984,1.5629912949521572,1.7453711728704528,1.2000968572631796,1.009839825601443,1.5452503492880245,0.98365572865068,1.0178388414348993,1.1187227667897646,1.2784006555889083,1.5226950063821132,1.1461960429078983,1.0982124872830539,1.4620162052273102,1.1805989987382672,1.2195488226019229,1.1632373859532423,1.5136069710129896,1.4564432838020083,1.384343362448878,1.2545761152195585,0.9647836471562077,1.192151900619537,0.9749408696057004,1.486672883887574,1.4383177330411454,1.0078471412527343,1.1878221058196492,1.1397002551045803,1.0619868487108852};

const static score_t log_LUT_loda[128] = {15.0,7.0,6.0,5.415037499278844,5.0,4.678071905112637,4.415037499278844,4.192645077942396,4.0,3.830074998557688,3.678071905112638,3.5405683813627027,3.415037499278844,3.299560281858908,3.192645077942396,3.0931094043914813,3.0,2.9125371587496605,2.830074998557688,2.7520724865564143,2.678071905112638,2.6076825772212398,2.5405683813627027,2.476438043942987,2.415037499278844,2.356143810225275,2.299560281858908,2.2451124978365313,2.192645077942396,2.1420190048724277,2.0931094043914813,2.0458036896131246,2.0,1.9556058806415466,1.9125371587496607,1.8707169830550336,1.8300749985576876,1.7905466343710503,1.7520724865564146,1.7145977811377517,1.6780719051126376,1.6424479953819162,1.6076825772212398,1.573735245297902,1.5405683813627027,1.5081469036703252,1.4764380439429872,1.4454111483223626,1.415037499278844,1.3852901558847919,1.3561438102252752,1.3275746580285044,1.2995602818589078,1.2720795454368008,1.2451124978365316,1.2186402864753405,1.1926450779423958,1.1671099858352583,1.142019004872428,1.1173569506381587,1.0931094043914815,1.0692626624371138,1.0458036896131249,1.0227200765000835,1.0,0.9776321869715455,0.9556058806415466,0.9339108095422276,0.9125371587496606,0.891475543221831,0.8707169830550335,0.850252880495318,0.8300749985576876,0.8101754411199827,0.7905466343710502,0.7711813095041191,0.7520724865564145,0.7332134593050986,0.7145977811377517,0.6962192518228971,0.6780719051126376,0.6601499971153753,0.6424479953819163,0.6249605686530753,0.6076825772212398,0.5906090638622983,0.5737352452979021,0.5570565041512716,0.5405683813627027,0.5242665690336022,0.5081469036703252,0.49220535980130375,0.47643804394298717,0.4608411888919686,0.44541114832236267,0.4301443916690522,0.4150374992788438,0.40008715781287235,0.3852901558847918,0.37064337992039037,0.3561438102252753,0.34178851724820525,0.3275746580285044,0.31349947281678164,0.2995602818589079,0.28575448233387735,0.27207954543680085,0.25853301359885306,0.24511249783653147,0.23181567522307364,0.2186402864753404,0.20558413364989406,0.1926450779423959,0.1798210375848123,0.16710998583525832,0.1545099490556248,0.14201900487242788,0.12963528041659547,0.11735695063815874,0.1051822366920565,0.09310940439148148,0.0811367627254055,0.06926266243711372,0.05748549466076013,0.04580368961312479,0.03421571533791296,0.02272007650008353,0.011315313227834146};
#endif