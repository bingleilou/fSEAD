#ifndef LODA_GENERATOR_1_H_
#define LODA_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void loda_cardio_c2(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_loda
);
    
#define ENSEMBLE 35
#define DIM_MAX 21
#define BATCH_SIZE 128
#define N_BINS 20
const static param_t bottom_loda = 2.580379516762855;
const static param_t delta_loda = 0.0805177582801107;
static param_t loda_min_X[35] = {-3.6061712115957856,-6.005711265191354,-4.757087504381132,-4.515609369623799,-3.90153157205885,-11.125849373277603,-3.3301706492575285,-3.5202056055066824,-4.5716043744452355,-4.082377937444663,-8.58569823455792,-4.834803619980965,-4.64331863918782,-3.7742713104720402,-7.457994070026514,-2.2061102064514637,-3.983946993172152,-2.3861693707237044,-4.04345653692087,-4.861986622857385,-3.6677799095081896,-3.2696566368913906,-2.643211113300366,-4.609296670955595,-5.79181314563124,-5.909163485596821,-4.4337176515140335,-5.09575294345009,-2.140794133352157,-3.6674384516673744,-3.960968687591821,-4.585440398822764,-4.155018082026541,-3.20721264192738,-2.457971479009247};

static param_t loda_projections[35][21] = {{0.37582501745538766,-0.3732571557977398,-0.17840092474167235,0.19744535626396,-0.10456566777078276,-0.2950130913894295,-0.09292824020420437,0.20618271916403597,0.40595814108383077,-0.14670833531926408,-0.04969597557499604,0.2614070964976878,-0.3075244429911561,-0.06358576701329946,-0.2109904825293498,0.0368483850563643,-0.15142566510217154,-0.20933132838130375,-0.014570468723110892,0.11992729992843511,0.12863630043368726},
{0.1701803245298349,-0.13977283798101553,-0.3816432607168873,0.0621399361376276,-0.1343528266380576,0.2248691349342447,-0.03751485317759309,-0.30193810417806094,0.2866626824395483,-0.27609289962841793,-0.006894754099580844,-0.23406006630729315,-0.09779969524245044,-0.2855695880723432,-0.07407861869926143,-0.255251320310518,0.4812110668195328,0.053374729867784916,0.16812839701779,-0.025186019503836615,-0.049939349052378},
{0.24043593819181389,0.3041682138374014,-0.0015284448594624729,-0.11221813749205184,0.4208928589871434,-0.045683642332839114,-0.17999329946848203,0.17408833372296542,-0.26303334271478246,-0.03591075800747753,0.10901235946418002,-0.3580352357032444,0.04612089569464863,-0.1802432647222009,0.10856217065780037,0.06660682090724686,0.34225676050706483,0.025604368091813216,-0.006048230512860712,-0.017876073666720168,0.46432471479278964},
{0.20101779154253996,0.002959904235607299,-0.08036642255858727,-0.28223323118726407,-0.16414068012075594,0.3234136424413884,0.2279711522369805,-0.4009989939608772,0.24752590369324912,0.07371614956326261,-0.31317227607805803,0.0006910139246772886,-0.10861576997675719,-0.08977256022713266,0.3439133708553742,-0.3551538222828253,-0.26597497872197834,-0.09624605431447351,0.140943796153866,-0.0015942610746799305,0.0154212797514635},
{-0.45754439902451577,0.04061699865517814,-0.19143824494642755,0.13789622362095177,-0.24005266341762005,0.12565751975384018,0.2798607644080419,0.10731349384718585,-0.17034253194113932,-0.08109206021784232,0.12008484024034151,-0.07402536789320983,-0.4029990405696738,-0.1087861290418394,-0.4622874561525331,0.2502227520062936,-0.05108289150910579,0.22588135603359383,-0.03285792078676809,-0.07255318181418435,0.06367290388773629},
{0.05857479357367776,-0.10388747781712537,-0.23319742041186067,0.3830019504909539,0.13859704292146421,-0.49973180322289495,0.25083479458979835,0.11861529873104003,-0.17624203078570982,0.06381811728526526,0.26563096014597043,0.17983356511218312,0.21242098306440632,-0.017823559787282988,-0.026670709950758622,-0.040215447895488025,-0.11908555995560621,0.01716579780127973,0.045096482604161534,-0.07174204134782343,0.48095386617048214},
{-0.2861774263674688,0.1525807254516201,-0.202243447747124,-0.34475970559430075,-0.047010042529825234,-0.16223366984526785,0.320469595194163,-0.23619181855344756,0.023917621026864257,-0.04297700166411277,0.002287662652498682,0.14779535728407736,-0.059885464237740806,-0.2961906918615672,0.0663548743844053,0.18430716672368838,-0.3227722382197699,0.42867955268540414,0.08004668085928193,-0.2790604371277285,-0.1478429717528311},
{-0.06491066280019343,-0.1681547861848878,-0.07861814035813022,-0.15315470961541006,0.12174438370928815,0.05376514743014719,-0.17154771678460687,-0.37695481278310355,0.12071643379088583,-0.18226554683773194,0.05972170481064352,0.07557061787907084,0.027005161186124102,-0.3363574039931166,-0.4196126346587456,0.2532793132301968,-0.004091000446558374,0.1716679814574065,-0.2940243409999094,-0.2156679246534259,-0.41836146900998616},
{0.07725856616572874,0.3170194237534098,-0.259049688028781,0.14413817856851074,-0.19603158018623418,-0.11706901096954424,-0.04463147798347328,0.23200217777865062,0.1250041654263781,0.278736853625895,0.5041946559976458,-0.16509488316561718,0.4031247756754363,0.19373296366306977,0.028886334173877582,-0.08680680033271232,-0.21043337678263677,0.03034207656446265,0.2574717410328871,0.020251238895781495,-0.0509051989433823},
{-0.37823196347045573,0.4807455970084392,0.3053976296566017,0.0416641630937557,-0.17895971221504256,0.17900531689727173,-0.09802530504572582,0.10588530711792651,-0.23121043203201666,-0.3851743072726834,-0.18929516583581185,-0.18560217813822955,0.13040336562020974,-0.056936540098621154,-0.15197752277734178,0.053937920653255894,0.12959904059957802,-0.16215928381775055,-0.14552384464041315,-0.22433889539728372,-0.11393950164382362},
{-0.3102183564498607,-0.22823040505118122,0.42560124260004206,0.024195483614730888,-0.023130805973466808,-0.2607922488781131,-0.01677891584857126,-0.14833805506490347,-0.17283203234974756,0.1728841810450551,0.18870916444852665,0.02804215788403194,-0.267818596131317,0.07953550997091802,-0.10386068978929054,-0.5952701184405351,0.01233325038694958,0.044151724568779555,-0.09319911032082492,-0.0031331297957399936,-0.17023301862641438},
{-0.5007063612035834,-0.06328388548200896,0.35330030009344265,-0.2809311185067595,-0.24092791083825255,-0.06542319603123264,-0.04150115759441989,0.10955190525976749,0.2565076955806742,0.04132475592847027,0.30182568712333935,-0.08386631125472888,-0.08493095361107171,-0.19133724647274197,-0.33831824855426623,0.048290520161500504,0.07187354002042727,0.19349015192283128,0.1856609021168984,-0.15204148765312628,-0.19761829104022957},
{-0.03134704369768931,0.015976715079933406,-0.3117555686154326,0.1962549270867441,-0.13991733620873106,-0.02401380024188563,0.17186722216651565,0.44331410395440385,-0.0176805852784051,-0.022918040819320168,0.11619527126016704,-0.1473586791141738,-0.16339370525399224,-0.2784318005731206,0.37209017501035774,-0.366433222216127,0.11572936238966053,-0.25841635660725737,0.2512165985387697,0.24516832046475326,-0.021113891345852967},
{0.1386469281718593,-0.07202347526277646,-0.0663712466849682,0.12926867056004537,-0.21181489877670043,0.090170358468153,0.012835354497754555,-0.42667498580393803,0.042800804847685565,-0.28027886369105764,-0.01923015286659297,0.3977720128514203,0.030199800069043672,0.24105518413421148,-0.10399472755589144,-0.16828395314877231,0.06174611783783699,-0.08741615045833907,0.5494156596157628,-0.14563608219007007,0.2181866972099319},
{0.02661219416717149,-0.15101602097767755,0.4279355111491449,-0.2655825973724585,0.21089015910359263,-0.3674274023110883,0.09984226396199264,0.33856339922306794,0.03257633159094475,0.02845605841095566,0.27946603466713515,0.09768817144599289,0.20328082763838065,0.21702862513478297,-0.3819683449222826,0.1408495983915629,0.13429616834016178,-0.05341709172636492,-0.028334682491618527,-0.22988234082483897,0.023153452597246924},
{-0.047606202861376984,-0.016870381506773335,0.08914033484064761,0.08654361167490635,-0.02779324905272622,0.4475620764226962,-0.1858724039346909,-0.1613609930587069,-0.5134859442536333,-0.06137965398848869,0.13478165776742296,0.3073958830034889,0.17756297775904795,-0.12489461373245915,0.05684667861570879,0.11547785577815027,0.19166948981193505,-0.08399215940191838,-0.3199842411687162,0.24656265740713357,-0.2637812628244712},
{-0.15625730773773935,0.15599629718383307,-0.22995693095423766,0.18645864516204433,0.2871903007752801,0.27717393893167813,-0.026527943979822367,0.1186755195502319,-0.09810484334935995,-0.19320092792959354,0.10446610654973253,0.03583519826854743,0.15612096810027368,0.40259349749392404,0.2657207433637123,-0.33575519889830213,0.2430366844852391,0.056901108922095864,-0.1702590945554211,0.39040629066908733,-0.1298379283735083},
{-0.06197663351382276,0.07973368898468527,0.05689967159781268,-0.1978463480157111,-0.0045035424621126035,-0.02132696329614215,-0.44658381789522456,0.03161962392548317,0.16139400734733217,0.1381085762718688,-0.33691399823561885,0.04320652489316149,-0.08449696731520827,-0.18255587812081575,0.1267733333890859,-0.06151858942352012,0.16801459552603407,0.29948115456224084,-0.5206191155471983,0.0005793515523350057,-0.3697620053016702},
{0.09205641337792529,-0.495573304946653,-0.291960662958748,0.19396177563442737,-0.06265522341005118,0.051745250024551874,0.007680333392305523,-0.16358982730712732,0.23949859417177793,0.2960614312171381,-0.24338721189256582,0.06284482047655199,0.07493724447216078,-0.3198602922554231,-0.3704893827464936,0.21289661937505538,0.12209811814371306,0.24906389515251282,0.023349637812961375,0.08155990738695007,-0.08243996080600567},
{-0.1542142942838415,0.05157923175431418,-0.07064543051464488,-0.15979509023606944,0.13344694663616233,0.41380952161240164,-0.3505478223295724,-0.09581117627362697,0.09781216075184437,-0.20703217189120243,0.4404890523151647,0.04398955370568876,-0.202583093124141,-0.043725576282603505,0.41253259221837557,0.04060613193113013,0.30237605037513043,0.0815388090611022,-0.18527028501020862,0.05036971550565713,-0.1542764510628402},
{-0.11639519359334775,-0.3314862314989545,-0.23126149912218372,0.04472070897745636,-0.05150904945130001,-0.03164969841485002,-0.08093793209549709,0.30823459089854793,0.005310643875109757,0.2885545602201308,-0.07219596877952279,-0.08646336461232801,-0.029167663171056308,-0.15375858661955366,0.2991997472397462,0.2321483684662961,0.3334970156292958,-0.09323308732129287,-0.4502943276052958,-0.356757648207565,-0.045091353898349965},
{0.2567080575624642,-0.05974645179434296,-0.09075879300016654,-0.25967690507863916,-0.3954897994200999,-0.04150286162965253,-0.2429529855843667,-0.12286762816221689,-0.10366690081332194,-0.23018463973058106,-0.23533723327288983,0.09519248590375692,-0.4100602199962998,0.25796974669652445,-0.10804965582917617,-0.1390750950734738,-0.2667842998339805,0.12067494241119216,0.190992661827245,-0.2975290899435373,-0.1340721539430415},
{0.1953053721109023,0.07814495830792755,-0.16068178535741123,-0.11515170170388755,0.2989010682924169,0.44233541597148884,0.2334829696468249,-0.1595206428479012,-0.13531955636970439,0.38024008027859174,0.20505835966595617,0.16702248849374457,-0.10318307674963047,-0.20392081411718363,0.1854526399077047,-0.3067997128755627,-0.0300467944765009,0.21059311622877716,0.1767657990215607,-0.11347229733282724,0.22078068288263517},
{0.10786902261543897,0.11621956035021044,0.22644457106453064,-0.042463830788005495,0.30719599998343555,-0.016070182679160713,0.06588442911048928,0.034610236316451576,-0.12919977258971643,0.2093341847144891,-0.2307239951694938,0.13668437223407442,-0.23876936639559865,0.24994149059876283,0.44658201627596567,-0.3523457026469015,-0.1105972244443294,-0.18981756574971959,-0.10103403397260642,-0.41862559471881383,-0.1113502418394432},
{0.2574750304329644,-0.35534356559225794,0.1301930144337615,0.23839447111493603,-0.07687363645169495,-0.20165745981243485,0.10338288320989086,0.00031635790132793885,0.43626096265818937,0.15110707247413338,0.2534634883950179,-0.24943757977067324,0.20613266313908538,0.2455793218421584,-0.21553817615865847,0.32890392127544205,0.0250543932092951,0.16600848605283483,0.04435364225399114,-0.07290847185112495,0.20944780169406427},
{-0.09260659408683303,0.02418211167203412,-0.32638868791247877,-0.24462718086290475,-0.2645950987890835,-0.05335277379075664,-0.0001765370483314602,-0.07201801721637939,-0.17898360463151916,0.08593498485034005,-0.09030146054596948,0.01693836467543483,0.5164020781533988,-0.28806345102055747,-0.18071904378884468,-0.18681414180467645,-0.135912077951674,-0.07160298198721572,-0.23735149263925456,-0.44879038726529635,0.002026993519418439},
{0.14138267487264566,0.39801454550472587,0.10159383951516143,0.20977628554919633,-0.2534587242274346,-0.21600739099561814,-0.3085137774645755,0.05929084451479111,0.1976337649771098,-0.031066308236777276,0.19515759989325174,-0.21249430822165516,0.21653099140727683,0.2913680533987741,-0.13180036269610096,0.24025271697176334,0.20216984382797334,-0.023314275510629014,-0.22168082737426426,0.26210946998230217,-0.2612911559171397},
{0.17131391092691461,0.37878329079097856,-0.10655314986470628,-0.17480421197056764,0.02131575619777046,0.21919434226648435,-0.09089060666434368,0.35690495597949407,-0.22965468686245863,0.149722445211557,0.1222136245416417,-0.2101245123372909,-0.11702956694237797,-0.10486866053421663,-0.2279339055552189,-0.0512429598588066,0.013927401353027478,0.15078181065125412,0.2704605151297528,-0.12502869804637554,-0.5252543044943304},
{-0.010519912319972648,0.35051973017011845,0.10082006506427711,0.23766155354924087,-0.09230025022834244,0.6631172327584446,0.13474229138677513,-0.36248878983539734,-0.11195336574213317,0.023049226650145003,0.00126034943601126,-0.11975290797274982,-0.10016408129838422,0.23517353281795222,-0.053909250461554765,-0.09249190899341211,-0.014157935939799193,0.006479446388862751,-0.3286134886298857,0.0106427069146158,0.005482253549030056},
{-0.11042591516826525,0.07767624660209244,-0.1853099470849154,0.3161290079979238,0.33341434602503783,-0.13719995799555149,-0.13829099119626323,0.14171773697410672,0.018836792181991642,0.21051724030568325,0.20807692648564174,-0.32699289388517466,0.15309828942244394,0.1400232448642258,-0.28460843742171027,-0.037498518138693315,0.039906344794809256,0.045749258618922935,0.2299365835547926,0.5421723043146935,0.08628082569803713},
{0.0657913985935907,-0.34488505761174276,0.05055520542150833,-0.28409082581315276,-0.19100737898420048,0.35351608175353905,0.06670641946221745,0.04744980026784909,-0.11360188138704781,0.016942093746160784,-0.06514244902952875,-0.16825603141085985,0.006210421143045441,0.21349084341782076,-0.27155498329520467,0.3408351436092028,0.3068202803240866,0.24270093613798724,0.1413382011115008,0.023234377528688392,0.4128816723562106},
{-0.384847634711889,-0.24481193791089886,0.02740981684513902,0.33239940111916066,0.009824847028981195,0.14409333728918816,-0.2322269197186033,-0.3081098800031029,0.029242972897357236,0.23452457103143415,0.18573106806501805,0.1188161566428353,-0.09927547859852771,0.2660367501424117,-0.06471427524082472,0.138644244891646,0.4590083779500165,-0.006991481750777606,-0.22589698983286235,-0.1103932928310037,0.16891720638880472},
{0.1284513001695738,-0.0663338555945429,-0.07292579517945036,0.07175881127313602,0.2224200880946431,0.18784396489559543,-0.21112165697819416,0.24802817674823974,-0.4755992620606926,0.12982883890149147,-0.034533870644039934,0.20028535799979055,0.05988195795417199,-0.15878073545848093,-0.2249769488138108,0.13453702788213834,-0.2932231235666383,-0.41586664877810847,-0.20404322554549753,0.04243950545897208,-0.30587182843154154},
{-0.24654600405071303,-0.16956659980680938,0.09280369275866997,0.17381145064939857,0.3262219579923448,0.2684574105921778,0.011704586209949937,-0.06267598410653248,0.28658963659544273,0.12523028489039928,0.1305078465597968,0.17746946593888785,0.183671314520102,0.13838124614302702,-0.17033028179105078,-0.06370258804435694,-0.46684700552603264,0.13165192896251382,0.2175131998286469,-0.24634349879626774,0.33691170844984203},
{0.29445061965266967,-0.3116396148518681,0.44947437770083165,0.06134892318372652,-0.12362151452881806,-0.07593097441196617,-0.018249960418172777,-0.15241736477280446,0.07923945686369288,-0.11308836321828786,-0.18015269726195418,-0.2206192379230743,0.38786416824060815,-0.10979671290384296,0.3625651415193278,0.3201414287127713,0.05844739339962269,0.01833524463595924,-0.09096957046025583,0.23486267551724976,-0.04421417431274618}};

static param_t loda_delta[35] = {2.3140679246567033,2.2671023901360656,2.7417313912685355,1.8775645551695026,2.586581385981775,1.538997878919536,3.427061439154791,2.9396673719672535,2.492610792576655,2.4818012624394976,1.5325297397975963,2.3898679758961947,2.7922668756949354,2.7504574409628537,1.6763179225607285,1.5929238096096705,2.0306565511742787,4.475101349386102,2.9860644634949427,1.5008382168768626,2.959964792859473,3.483960137396298,2.115273789207343,2.299707866290216,1.7143677049077153,2.163919291950266,2.4765847499372633,2.3366863713313473,1.323834742387695,2.37712441517875,2.0060496102994687,2.790803971488254,1.527234745945882,2.3240929870263036,2.77917306853412};

const static score_t log_LUT_loda[128] = {15.0,7.0,6.0,5.415037499278844,5.0,4.678071905112637,4.415037499278844,4.192645077942396,4.0,3.830074998557688,3.678071905112638,3.5405683813627027,3.415037499278844,3.299560281858908,3.192645077942396,3.0931094043914813,3.0,2.9125371587496605,2.830074998557688,2.7520724865564143,2.678071905112638,2.6076825772212398,2.5405683813627027,2.476438043942987,2.415037499278844,2.356143810225275,2.299560281858908,2.2451124978365313,2.192645077942396,2.1420190048724277,2.0931094043914813,2.0458036896131246,2.0,1.9556058806415466,1.9125371587496607,1.8707169830550336,1.8300749985576876,1.7905466343710503,1.7520724865564146,1.7145977811377517,1.6780719051126376,1.6424479953819162,1.6076825772212398,1.573735245297902,1.5405683813627027,1.5081469036703252,1.4764380439429872,1.4454111483223626,1.415037499278844,1.3852901558847919,1.3561438102252752,1.3275746580285044,1.2995602818589078,1.2720795454368008,1.2451124978365316,1.2186402864753405,1.1926450779423958,1.1671099858352583,1.142019004872428,1.1173569506381587,1.0931094043914815,1.0692626624371138,1.0458036896131249,1.0227200765000835,1.0,0.9776321869715455,0.9556058806415466,0.9339108095422276,0.9125371587496606,0.891475543221831,0.8707169830550335,0.850252880495318,0.8300749985576876,0.8101754411199827,0.7905466343710502,0.7711813095041191,0.7520724865564145,0.7332134593050986,0.7145977811377517,0.6962192518228971,0.6780719051126376,0.6601499971153753,0.6424479953819163,0.6249605686530753,0.6076825772212398,0.5906090638622983,0.5737352452979021,0.5570565041512716,0.5405683813627027,0.5242665690336022,0.5081469036703252,0.49220535980130375,0.47643804394298717,0.4608411888919686,0.44541114832236267,0.4301443916690522,0.4150374992788438,0.40008715781287235,0.3852901558847918,0.37064337992039037,0.3561438102252753,0.34178851724820525,0.3275746580285044,0.31349947281678164,0.2995602818589079,0.28575448233387735,0.27207954543680085,0.25853301359885306,0.24511249783653147,0.23181567522307364,0.2186402864753404,0.20558413364989406,0.1926450779423959,0.1798210375848123,0.16710998583525832,0.1545099490556248,0.14201900487242788,0.12963528041659547,0.11735695063815874,0.1051822366920565,0.09310940439148148,0.0811367627254055,0.06926266243711372,0.05748549466076013,0.04580368961312479,0.03421571533791296,0.02272007650008353,0.011315313227834146};
#endif