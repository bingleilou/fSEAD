#ifndef LODA_GENERATOR_1_H_
#define LODA_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void loda_cardio_c1(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_loda
);
    
#define ENSEMBLE 35
#define DIM_MAX 21
#define BATCH_SIZE 128
#define N_BINS 20
const static param_t bottom_loda = 2.580379516762855;
const static param_t delta_loda = 0.0805177582801107;
static param_t loda_min_X[35] = {-4.3280073286803615,-3.8137132094321835,-9.837814557073331,-5.269191384075208,-5.118695442577823,-4.370658238320012,-2.763043238565005,-1.475455382278895,-3.2482199787249555,-2.6913367842274045,-4.879336850560977,-2.742959571368814,-8.334398045739556,-2.7349702404396172,-3.2210448184960505,-2.1197510675,-2.751622729968722,-3.4639485773325878,-2.62901580578661,-2.996180745938505,-3.1022331194850015,-3.548076751070646,-6.067551652770793,-3.578433372258214,-6.963363814013981,-2.431902119458975,-6.370973550377319,-3.333866465857235,-2.486215111277196,-5.6437931435136734,-6.024285691760425,-2.2807334604179275,-4.235235840298932,-6.075596827494368,-3.6058215620591247};

static param_t loda_projections[35][21] = {{0.27048382837445917,-0.3256490371455896,-0.14530212982703217,0.08127930131683389,-0.03894672425277461,0.16938375361490043,0.034306761557826686,0.16693154305721356,-0.04808183181305208,0.3234474542694099,0.16560558077981632,-0.24623398499297167,-0.10509985987363704,-0.1503120055529132,-0.33048068128782215,-0.15704453365423443,-0.11377927089126082,0.4701846152537445,0.29815243743212405,-0.05630836855748545,-0.21267327324692722},
{0.47803260738149045,0.04677145916715936,-0.12256883095143972,-0.009153258224073925,0.058462959296987776,0.25001074361401265,-0.30582916243396907,0.13248916426381693,-0.23639549836638202,-0.4374648883551751,0.45654001566159386,-0.06685337136021519,0.022236772410350006,0.2598070758438608,-0.023342378434246077,-0.003605113378806857,0.1734197333800153,-0.058827795608847606,-0.026780375543172075,0.04480849403144111,-0.11051486329592802},
{0.04253303849230891,0.3851047051265362,0.30128176570826953,0.07235129883336407,0.19546885571528372,-0.43311662599429224,-0.32361577648591927,0.11065674127703337,-0.09379532853535204,0.09059378871049295,-0.09550399826819488,0.18527219517501994,0.2886591441200243,0.19221551358803318,-0.13399864888947075,-0.16900956750151566,0.2372183931168384,0.18934310445487246,-0.10292401682976172,-0.03409031392079773,-0.28282232646721217},
{0.005488660036524187,0.044504490519350966,-0.018033997892937553,0.24025768459202523,0.2746719541807819,-0.041428741241388706,-0.18232350011063114,0.22539719390619617,-0.06031775340944224,-0.012612046758266751,0.2552976211119091,-0.08232875303999784,-0.04786220997914077,0.32451141453897797,-0.24235561556401483,0.1364241846592266,0.30347901687100287,0.1953348360967342,-0.10634916356797376,-0.5830348441136675,-0.19115448285968908},
{-0.21259592030924734,0.06023779298808208,-0.04845098410916911,-0.27704792914080717,0.5592087318323925,-0.17723437097896869,-0.17036137991403044,0.18653017524286108,0.188034459502832,0.30168136612213103,-0.19914055919153958,-0.1608030378122839,0.014758349840169334,0.035545875830819126,-0.06307296861968806,-0.18449439055483474,-0.048050727235956416,0.19172107301587252,0.39119274699744433,-0.20115712789000187,0.013627793976309414},
{-0.24397143638268057,0.3360844285435044,0.14475938679604922,-0.007595561255237204,-0.07255238542058445,-0.14884863392634784,0.006889149333468067,0.212632287881367,-0.08414727531377854,0.06704215903005033,-0.27116307151862884,0.13666531003952753,-0.14221145989297637,0.26161062217150377,-0.18422200335269107,0.14631248668136157,0.03757274862136572,0.24565966752303067,0.052811809060176566,-0.41356702172990145,-0.5004536091471732},
{0.03779262231783388,-0.10718754086159775,-0.009935312340891294,-0.03670573555791372,0.06627100618752868,0.2977000474807928,-0.14266664513642915,0.0771513912898312,0.32112062153679516,-0.003967804664096126,-0.3460504785714293,0.19288744472463637,-0.22401564785818057,0.2909998443392029,0.3324502117510312,0.3431617124826791,-0.40697598692350834,-0.1646920382237337,-0.12515539489968855,-0.1563834279472513,-0.10100971234923087},
{-0.1528699126551104,0.32251199998294827,-0.010170450569540248,-0.12328745696094133,0.19841788809940555,0.11783907353829398,0.5585325820239847,0.24349686611728144,0.23450723647292795,-0.025002367817426895,-0.0984061333760498,-0.313543023677138,0.11329126220910885,0.18035062407227373,0.19430113381873995,0.11616871848873891,-0.22359296775405033,0.30420032360451116,-0.053759749293405885,0.012754505305553275,0.16432569260393726},
{0.3019806472257112,-0.023781272347651684,0.12152732634956777,0.06709660527156877,-0.4083860047499127,0.40859709888316553,0.10468057338818582,-0.019848379225312157,-0.14177627936268988,-0.026383001635638555,-0.22457374039400452,-0.3307371051803727,-0.22274449158696624,0.08869872285173494,0.29150765452145017,0.025620600257812667,-0.08509619458894975,0.4127971012853981,0.13797077010804118,-0.0516583528408106,0.14425184250277603},
{-0.49536570978347466,0.4072969662466114,0.19126408702084452,-0.06984826670469664,0.16584823988524075,-0.08975192659525102,0.03842901164730587,0.010753313504945128,-0.16016780125905863,-0.1547216243911385,-0.04654476459678097,-0.34959106413172214,-0.21944050046324845,-0.05668197495849233,-0.23559335751784344,0.15305544545866592,0.26186634080887705,-0.09451530838679251,0.03686400545451023,0.09641606755314991,-0.34303883892110754},
{-0.14829516229640388,-0.03616529980978859,-0.1905896885364963,-0.3909082457771693,-0.23153871128317577,0.19170273338262975,-0.3591914677249896,0.09830501255491156,-0.06319084850012928,-0.060184686130359925,0.4862524844888768,-0.39605904773539075,-0.22444723432814973,-0.09941829925766665,-0.13931878059090239,0.0446525595962019,-0.04211379096924883,0.25905519188904347,-0.07719494129331185,0.019051406062986498,-0.027121792093958114},
{0.1847853456764328,-0.4425271924372276,0.18334116397059202,0.3887760892063309,-0.03940339142254698,-0.06498154596598694,-0.2873331603014021,0.0009735987354915162,0.10218883467308179,-0.109847241576638,0.0341032316583198,-0.41019413875753835,0.10711587706683924,0.21429233298216735,0.00846542682511808,-0.12083782020276625,-0.10891877474672587,0.3242359815000864,-0.26387635523146136,-0.14608056853354862,-0.15800152018372024},
{0.22025799811878977,0.20957407535273406,-0.054689506118697995,-0.2114236013906104,-0.030199638253148735,-0.3777182192005892,-0.07299231320902284,-0.14831133961097834,0.036089384274538464,-0.5516247268384625,-0.06592665485744574,-0.1761853382614461,-0.07609669072370494,0.434791568653695,0.29362311271635283,-0.17240389286567234,0.15861110779818677,-0.02972421890142774,-0.09146373948647743,0.021014103477631794,-0.04865066528684518},
{0.10410304162095486,-0.21742124659644313,0.15693687116775115,0.29558972961186336,-0.17746927136176466,0.20617745803721177,0.27854300960596795,-0.26640271921243003,0.1624815907445139,-0.027651468751477698,-0.038463038986127185,-0.12562077368069657,0.02606416112192723,-0.1995987784283276,-0.16244524602001553,-0.010538494055153594,0.014422919367831251,0.44070528006012505,-0.23387547790454916,0.48535439810938413,0.10577241474235327},
{0.3948824609139561,-0.14821858615629613,0.18248490523230051,0.12260154927008987,-0.30521491120784444,-0.016022599768887518,0.15396525675004358,-0.08003776619702548,-0.2289666936555905,-0.25189727839489473,-0.18885371587843533,-0.3048052656575321,-0.2039343002899966,-0.1348975429380629,0.02329898095275774,0.1211134333693978,-0.41275709041038033,0.2678420664022517,-0.06216767316913566,-0.07727554877465659,0.28080432717929865},
{-0.03915071773135629,0.07791561144634085,0.46458549215192096,0.008590435206291842,-0.02511439543521128,0.2033956482909814,-0.2691189844949638,-0.2606726002091301,-0.21811904818831512,-0.174000246118496,0.16910344795760118,-0.09416238909197279,0.1169757395006261,-0.004462018510632719,0.24084069822490534,0.03812238946128837,-0.3611584503823209,0.1638785804174867,-0.34985412838843,0.35385562870321946,0.026990517984781835},
{0.1592656028846302,0.10128851005780887,-0.08622377704421845,-0.24363094876960242,-0.021083841866572254,0.2509049256993626,-0.12956962764981575,0.06233343502429093,0.1507384282920465,-0.4829440760399871,-0.028865030755527595,0.2648672738703463,-0.27998628554530014,-0.42734169259507687,-0.19508577516256506,0.25848481396685613,-0.04447044040472065,0.2707469773506221,-0.04897095791977637,-0.16271203824113328,-0.1285575544273025},
{-0.26431877706195944,0.37181870298169756,-0.1356107002252907,-0.1318914145256191,0.2565255460030236,0.2525370989212333,-0.12598447750237365,-0.3455440824917997,0.0029110439417867184,0.09078886360598788,0.14874784638767288,0.045218778689863084,-0.1669474565584188,0.19688284250916327,-0.3678132110631792,0.05980377376385829,-0.2521083978815546,0.07300176793934053,-0.0810275549851907,0.33160927393009026,0.26059643040203956},
{-0.16551777382601365,0.18843752246083267,0.004014718681786959,0.10333760305416197,0.09720943618165875,0.18002896868091153,-0.3600087095694382,0.24876746985230325,-0.11215935307573156,-0.38883697294284225,-0.007823412847603343,-0.09711433233082586,0.16680461995826767,-0.14041833089784359,-0.15150696532457872,0.4928894919291221,-0.1715601748459163,-0.3363818741366018,0.025060540784868107,0.24089699027250228,0.0714275712751286},
{0.194479820948017,0.627567947601059,0.10055290678227904,-0.24815254842643,0.04479164568869541,0.1949717109034035,0.051291870086575986,-0.25585180968592675,-0.09524886539311853,-0.03394226078630127,-0.23531497558300107,-0.12121117816598585,-0.04349708959832175,0.1277523765886329,0.04129324077359845,0.26546486898043375,0.0016565441183372875,-0.08313949921951351,0.2666222178543363,0.134133875691192,0.3490858090440771},
{-0.15371928559024342,-0.6078251049013598,0.0345554508563993,-0.03595236055178443,-0.1679899955775134,-0.15616778838388035,0.39043581960413276,0.09134906878193791,0.009653135905956576,0.176255994938663,-0.12095903754245445,0.17411418169885676,0.1528775217379281,-0.15424447549969825,-0.2882660306820479,0.23575220884740458,-0.0010559680358955626,-0.018877473163241402,0.23521892273364253,0.2204179072350469,0.15755508471523863},
{-0.4055175513009509,-0.349403360387119,-0.19979650509305333,0.3354664546193954,0.2305499111707692,0.011932095806854299,-0.13288508573637373,0.31893326326764165,-0.1581732287467428,-0.17336721197051216,0.11206329357337644,-0.006360551017120832,0.3065363913463533,0.08631486191686065,0.1554131298534256,0.24648096644619932,0.03730498141295628,-0.1799937242432988,-0.10862192591057115,-0.1858011472288191,0.23289310877693703},
{-0.0839618608969195,-0.11302416713455274,-0.004009699643436072,-0.1922431492537495,0.03528561001920411,0.10807196001830761,-0.023151337253976174,-0.16298079201733243,-0.13942603550070273,0.11981101952135567,0.11737141827635365,-0.4101930148390612,-0.01975369605194352,-0.14547492756182642,-0.21577048409128693,-0.28349779871972547,0.4922334844523301,-0.35960254366045763,-0.39150822748097797,0.019429524708499252,-0.11664207914563693},
{-0.04082117818888472,0.15067061817220218,-0.006554675198609967,0.2582389874745079,0.25897484719879343,0.0012625445604248862,-0.23839125203187997,-0.12836478243095026,-0.21057675414070873,0.16360491870649,-0.17885965594355943,0.07647884876652798,0.14458110055066686,0.22916821441367485,0.3745781813179975,0.17681976616885972,-0.3490621310284436,0.522181339608522,-0.019046184246269346,0.06467520446293115,0.1245635802867315},
{-0.12965500493526244,0.17043736082857622,0.31806073884037095,0.10458363830482996,-0.28184912832280906,-0.14649615287612325,0.3366691107285011,-0.14533633145846697,0.3941724614810377,-0.20014730048701207,0.1787188505420018,0.04742233818698696,-0.10797079754709075,-0.1897448792532749,-0.27617361148716063,-0.281434634208129,0.21680067956259066,0.010937854807122154,0.22913540211057049,0.016293665893535845,0.27207081382749027},
{-0.0254415745710281,-0.1292330074899312,-0.24544492265917692,-0.04756730681952418,0.06499282118708458,-0.053505222260956664,0.08681729739627683,-0.28713912398365354,-0.043322602821043915,0.04825782584815378,0.3160278986133616,0.3005036060205653,0.35817927385542525,0.0976170370570095,0.4819183079552277,-0.10212851452047692,-0.3886335507443712,0.2887013858364091,-0.01779455996172794,-0.06632908968003913,0.09535878480100024},
{-0.3035250655469971,0.13571448063484634,0.22287974015182715,0.07024082227625976,-0.254768380110154,-0.2827371426209117,-0.28853278580649344,-0.33368934942945633,-0.12372979326364898,-0.4019649895584595,-0.03716175868571225,0.08603201377763674,-0.2637636524231897,-0.11419698828342902,-0.08750423615552183,0.3682832134071944,0.09363701343969272,0.19363142160776223,-0.03076459537737437,-0.1912538050377067,0.006583734272146374},
{-0.07689936959072273,-0.10313102621093084,-0.23190092349899735,-0.1722461114523497,-0.1161472613097696,-0.04734089072696787,-0.1842144206290287,0.567514137522967,0.4686292302264559,0.18298804764865262,0.1602489165325867,0.054661529112382375,-0.12640028014614885,-0.018676198464845115,0.0663825997790273,-0.17370036175762865,-0.16767211738974477,-0.02137468383396506,-0.4086065067010738,0.0027516056668578795,0.007588259962643538},
{0.09045230846843358,-0.2526354772275126,0.13402852147041602,0.08319536766343696,-0.020116896198384738,0.16482291041874164,0.12947693766020138,0.6156564754946404,0.04305952924700385,-0.21624895064219096,0.013980418063577044,-0.05374149649205237,0.36536488978171877,-0.0021303515919125484,0.2045062018997892,0.14335838126087053,-0.360841975874191,-0.20823753954269814,0.15873072762134688,-0.17223027919293443,0.061154104043782465},
{-0.059409870360698086,0.10789643795307899,0.08335622718380005,-0.030425208625044768,0.160389298335851,0.18194487742189727,0.1735166185429019,0.3407376821147164,-0.14889700555181334,0.35341848358703687,0.1109485067175756,-0.17131793758637587,0.4021126587235682,0.1151082151032111,-0.2663002363940787,-0.23192773906946493,0.11839161408860258,-0.40248123946760617,-0.2882335764104966,-0.1328972066121421,0.08235838726208619},
{-0.3977469824305169,-0.0003111044115091942,-0.3029170298827366,0.19507384585323392,-0.1933690628402816,0.30291092594876595,-0.4463135817574723,0.16430627076238877,-0.14595723885677359,-0.06899447900614161,0.04468547523519955,-0.22726066564510156,0.05074655117415752,-0.05679840563383275,0.0010835026862220057,0.19733870054167427,0.07568498900346983,0.41638640555177975,-0.026674304639826923,0.09730123637011506,-0.2071421068687473},
{0.3819823637438953,-0.07817310097727535,0.20644703555957403,-0.26907503574355307,0.21801108294712707,-0.01701495134796358,-0.011187436692482724,0.21228145361658926,0.1248309511326294,-0.053737959200008394,0.018303031243984403,-0.0077898513409010335,-0.39968488583250633,-0.1434416390555341,0.4459668129508443,0.018397101360253864,-0.13675569919937444,0.06456172294212201,0.23400369720102546,-0.23240493567226192,-0.3315042519885866},
{0.17221326294994851,0.1608235025006662,0.24081669287760196,-0.36736696064316143,-0.04298949081619615,-0.1481690431981514,-0.11472471682792257,-0.09152829987847565,-0.13949013743321073,0.033188618372748994,-0.5631086745122528,-0.1798184972875958,-0.2058625855690388,-0.05063501838721118,-0.1695539387478231,0.19682493640589627,0.03434866254970481,-0.04663914211323537,-0.1146483785623656,-0.20728493173309304,0.405342554956683},
{0.2635648531712455,0.11063012867212364,-0.1764402445670115,-0.15379331025789605,0.24306477275623545,0.09299391690770234,-0.39392272821587876,0.1186290677134034,-0.13872354663679895,0.30181325043752205,-0.27364560699986823,0.0798911454652128,0.2830468377587878,0.22685916284239363,-0.12168362712615809,-0.4243997161756181,-0.011217735632835062,0.06352564976669589,0.1812661086014361,-0.24860582783055885,-0.09802285970633796},
{-0.2088012776395446,-0.5079581595219934,0.14668468222371073,0.1457652464557311,0.29251533004626595,0.05212050497872324,-0.15561253881004924,-0.31765798078193214,0.2972285271876168,0.37197259837402225,-0.16356143948962057,-0.00928492537023661,0.058606525552548756,-0.0506521807153129,0.18388121458111442,0.06340825634919986,-0.22164249829044916,-0.14971566074903633,-0.11808574692084743,-0.11549159349084961,0.21449951366446965}};

static param_t loda_delta[35] = {2.3409999087533127,2.574517555250272,1.5609583354737133,2.58981841966791,2.6012937085769314,2.8198704515881206,1.4471682815409697,3.294119137006422,2.10848971696343,3.3065787478282,2.286206299393749,4.070656345157598,1.7306630074637734,2.5289058932539015,2.8847181414826975,2.437471460645501,2.3323655594911097,2.0959062655816725,2.006606198201068,2.674856088930179,2.663394303746615,3.122454403122408,2.347780124576683,3.049192341146199,1.770470221840012,3.6139606662251524,1.7630814181373127,3.0634779014170377,2.503627871156634,1.9955168909688712,1.743382766050452,3.756464568762407,2.6875785155547836,1.9958917270606413,2.449945672888948};

const static score_t log_LUT_loda[128] = {15.0,7.0,6.0,5.415037499278844,5.0,4.678071905112637,4.415037499278844,4.192645077942396,4.0,3.830074998557688,3.678071905112638,3.5405683813627027,3.415037499278844,3.299560281858908,3.192645077942396,3.0931094043914813,3.0,2.9125371587496605,2.830074998557688,2.7520724865564143,2.678071905112638,2.6076825772212398,2.5405683813627027,2.476438043942987,2.415037499278844,2.356143810225275,2.299560281858908,2.2451124978365313,2.192645077942396,2.1420190048724277,2.0931094043914813,2.0458036896131246,2.0,1.9556058806415466,1.9125371587496607,1.8707169830550336,1.8300749985576876,1.7905466343710503,1.7520724865564146,1.7145977811377517,1.6780719051126376,1.6424479953819162,1.6076825772212398,1.573735245297902,1.5405683813627027,1.5081469036703252,1.4764380439429872,1.4454111483223626,1.415037499278844,1.3852901558847919,1.3561438102252752,1.3275746580285044,1.2995602818589078,1.2720795454368008,1.2451124978365316,1.2186402864753405,1.1926450779423958,1.1671099858352583,1.142019004872428,1.1173569506381587,1.0931094043914815,1.0692626624371138,1.0458036896131249,1.0227200765000835,1.0,0.9776321869715455,0.9556058806415466,0.9339108095422276,0.9125371587496606,0.891475543221831,0.8707169830550335,0.850252880495318,0.8300749985576876,0.8101754411199827,0.7905466343710502,0.7711813095041191,0.7520724865564145,0.7332134593050986,0.7145977811377517,0.6962192518228971,0.6780719051126376,0.6601499971153753,0.6424479953819163,0.6249605686530753,0.6076825772212398,0.5906090638622983,0.5737352452979021,0.5570565041512716,0.5405683813627027,0.5242665690336022,0.5081469036703252,0.49220535980130375,0.47643804394298717,0.4608411888919686,0.44541114832236267,0.4301443916690522,0.4150374992788438,0.40008715781287235,0.3852901558847918,0.37064337992039037,0.3561438102252753,0.34178851724820525,0.3275746580285044,0.31349947281678164,0.2995602818589079,0.28575448233387735,0.27207954543680085,0.25853301359885306,0.24511249783653147,0.23181567522307364,0.2186402864753404,0.20558413364989406,0.1926450779423959,0.1798210375848123,0.16710998583525832,0.1545099490556248,0.14201900487242788,0.12963528041659547,0.11735695063815874,0.1051822366920565,0.09310940439148148,0.0811367627254055,0.06926266243711372,0.05748549466076013,0.04580368961312479,0.03421571533791296,0.02272007650008353,0.011315313227834146};
#endif