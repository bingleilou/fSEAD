#ifndef LODA_GENERATOR_1_H_
#define LODA_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void loda_shuttle_c3(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_loda
);
    
#define ENSEMBLE 35
#define DIM_MAX 9
#define BATCH_SIZE 128
#define N_BINS 20
const static param_t bottom_loda = 0.0327397510472687;
const static param_t delta_loda = 0.06681249496346338;
static param_t loda_min_X[35] = {-4181.364248496696,-10019.731873882278,-8636.908686166938,-2253.485414058634,-2155.3556149613314,-3229.629029182001,-3103.2642345346467,-1357.7298514399624,-14433.53929690991,-10169.588586759777,-1018.0085416919862,-3290.836021478176,-1903.1488386631547,-8352.816627517004,-1688.2943139658628,-7829.12074290857,-10705.454812407548,-18063.494965315724,-2399.9926589147053,-5238.690390374577,-6415.617529683713,-2112.8175454429743,-9118.618534385567,-2374.648159454046,-2874.2822587122364,-8456.190138123771,-1847.6805433894688,-11220.420391216043,-7691.274965000815,-5651.768117920701,-5169.242229938044,-3432.117080159419,-11586.337026177103,-1853.4459479117263,-10449.813080531125};

static param_t loda_projections[35][9] = {{-0.06468644587965143,0.14255644647989293,0.3444282703003576,0.19730753434280898,0.4490456991019847,-0.30199253746711646,-0.025439071941705714,0.7218442007519061,-0.058176435845776475},
{0.017996213997528127,-0.33087068256171553,-0.032330442767441965,-0.08690607985643656,-0.32725144378206766,0.37420774722663663,0.2683669173304856,0.3945310993817592,-0.6378105261114919},
{0.055113084805769604,-0.3247608105525534,-0.5530741539032646,-0.13987641946483143,0.3125011303450234,-0.55942939631403,0.15240938758478315,-0.354194357631745,0.08207351000777688},
{-0.2668371964894866,0.45720311715898554,-0.2726594965648151,0.3621715555339621,-0.5523669027348055,0.08561319986777724,-0.11901905546198722,0.19797153146060914,0.3852982032977899},
{0.15572959128421404,0.4482076442716825,0.17612575358537277,-0.009393176971126066,0.43494079079798725,-0.14149258296965903,-0.44272596894452637,-0.24066807964015574,0.5297439367225448},
{-0.017946497280943587,-0.38721640707748967,0.46552176642612664,-0.18868063205414853,-0.3840830261654014,0.12496138239781537,0.5510925230187099,0.2987982414804656,0.20325354923936587},
{-0.3248947868809633,0.2358029827221622,-0.6072980190825971,0.3610815685291659,0.2839306741929988,0.11053222517107779,-0.03153658874061026,-0.027049754767314565,-0.49506494672158813},
{0.05221527921037586,-0.12687285073117222,0.019440480571770377,-0.07583860596946426,-0.11862257955314205,-0.0767412507524471,-0.6947675534759744,0.5153651274191301,-0.45473477330687656},
{0.30918564849139535,-0.014261776776507248,0.48707924927307533,-0.3373591552379454,0.14474559073592125,0.5441597776252424,-0.341296385653394,0.2982096934873003,0.1751286613388736},
{0.010143476168347883,0.5436475677540411,0.3718092594584182,0.05771719071070108,-0.016438150691782664,0.38268606621559165,-0.5798021091061518,0.02360961011897488,0.28164569046257903},
{0.11156282170417345,0.1962312299088528,-0.2419594767141479,0.25676646698917793,-0.26605115297393084,-0.06529482369626945,0.19329886663600565,0.7423828992326652,-0.4012856630429577},
{0.1548014180047597,-0.16644304612403468,0.13790531904108108,-0.6631593749159725,0.4836526316085452,-0.1593763360431796,-0.05078329506340441,0.04093319541258295,-0.47535233850829123},
{-0.2483004470674541,0.04262095667382876,-0.7069161710654386,-0.015810081196272394,-0.04663202455997868,0.06804637063581635,-0.5852964570314164,0.18253983145609082,-0.2320610340066613},
{-0.0019932690291458053,-0.38326837843995054,-0.3269492145842075,0.43788515063602296,0.19579267970544753,0.31043828469918844,0.26165511801954655,-0.4736010950866678,0.3563622915173514},
{0.032618928311834265,-0.041313873242416324,0.2275067159606964,0.42418672968290394,-0.3109747983231545,0.052340365925136335,-0.3250722294105755,-0.29747729033268666,-0.6869686675913652},
{0.07142219140370755,0.6373601780403476,-0.16654048646199945,-0.39964169698269175,-0.06684299944614706,-0.4741550027064594,-0.22191776337570301,-0.1982548411965338,-0.28875287963794594},
{0.024469939245817286,-0.07137287184832745,-0.4805318423109237,-0.0018709694382779225,0.025326828290671295,-0.6966866234601327,0.1222106221948934,-0.15684272321366086,0.4876925339741967},
{0.16190955966747672,-0.3315156115801709,-0.42012945233278115,-0.1320570769585139,-0.10345326389591732,0.6730129323059012,0.2912237496886973,-0.3265512998123692,-0.1218148464721797},
{-0.18905474684105164,-0.036462187604036876,0.1806666876404432,-0.04494660672509347,0.5215125306067413,-0.16283044190378154,-0.3008696032529712,0.6032052547077462,-0.4188078225557145},
{0.18056582952600578,0.05376867819801487,0.09230825438777497,-0.5008529314033183,-0.30184374543366005,0.19304120346221365,-0.16702806050777871,-0.6775450766366496,-0.29965009755695865},
{-0.25746055399410783,-0.1404761443512848,-0.06925559842018585,-0.5099501858809946,-0.14418322862266522,0.24095803020561982,-0.6124600661074141,-0.02850028506049584,0.4408693813945229},
{0.21643161885302506,0.4245139158706573,-0.7162400142733522,-0.11995289904467822,0.1636902453156602,-0.11264084571986735,-0.108634405417202,-0.38509349374887486,0.21442001784640694},
{0.4843217811957308,-0.13740278730592145,0.11513343055608766,-0.46468571423474014,0.2019709784686209,0.3458211725645605,0.2497999988873065,0.21771502259955292,0.49717193847538543},
{0.17380742898266235,0.05619827224682339,-0.45260364954373683,0.4809396518648542,-0.12579308503581374,0.08947054145704163,0.6119704538141613,-0.006620556632470237,0.3634544997212633},
{0.16928603753796015,-0.5645415136631764,-0.26294698889370627,-0.4501199896194491,-0.012261440366826354,-0.02684675021079028,0.5366710519795916,-0.17732984417939768,0.24607561893853955},
{0.32898215779208534,0.4256378431148501,0.36409328078358777,0.21763619242528928,-0.12151523937210444,-0.5773566077473694,0.20704842424555628,0.2914126003392511,0.23404439209176983},
{-0.6486041228795733,0.3878789074881271,0.3438902943866098,-0.0459158080352433,-0.0051458304670802075,-0.09663018409887415,0.42004312593607507,0.14482166849046404,-0.3189364098811994},
{0.019572095031415174,-0.4115092942034632,-0.278600852408566,-0.38427120631095063,-0.31405752963052935,0.42154008372505447,-0.21985101541181612,-5.971713560335499e-05,0.5294634947468017},
{-0.25141283196675845,0.3013605471557523,-0.14591106353226185,0.2930599069542921,-0.30504775128213085,-0.5318492495861008,-0.2509674146162996,0.44014025429668985,-0.32584262998591546},
{-0.5128541563201243,0.2146147382534477,0.3860516383338355,0.13652619456742626,-0.14146334268757196,0.20718544206217185,-0.13535516527790464,-0.385538310322038,-0.5416155139820649},
{-0.608477081173054,0.3106823571731833,0.3346232347856621,-0.14250774736344327,0.40367473733637343,-0.32610502658536233,-0.17342995268573994,0.2546223090407389,0.19168384552112486},
{0.20844559186011694,0.7117973075046998,0.03478840517857135,-0.4872542773650916,-0.1065214764022844,0.08880674392281221,0.2749600824156714,-0.33732912516115693,-0.05138692452930618},
{-0.14025170427253458,0.7762770302522757,-0.14491983252536159,0.2658900654092243,0.08270973202384807,0.4330444502808343,-0.16330248237943434,0.2484642958739951,-0.05703984785151941},
{0.3068656631248092,-0.06882219583295945,0.7691902913807522,0.47627277224098524,0.21866326264866592,-0.09231442655613772,0.04792756220240987,-0.09169706811163346,-0.12476591249895652},
{-0.14041393863679877,0.32189831123713064,0.0540090377244778,0.09362175487512013,0.45870352746517273,0.38573950476210334,-0.01884297580825049,-0.6001381869050808,-0.3811280639827384}};

static param_t loda_delta[35] = {0.0016205914704997381,0.0012861562789586729,0.0008505562209908005,0.0043812451314512255,0.003344047250081822,0.0038716154352394097,0.0036055998202453054,0.00583648118801295,0.0009056898186952268,0.001250645054084044,0.007140063847202913,0.0026600190783204304,0.007189208644606828,0.0014425284383889146,0.00593279274018767,0.0009780694779412387,0.0006818434367303093,0.0007122694569224744,0.002958475528614001,0.0025787887976403976,0.0020966571865803432,0.003955357627764392,0.0014573680225481447,0.004505611211149896,0.003573209586715558,0.0008328904877793738,0.004553819518320893,0.0011963748240063378,0.0009132024974187761,0.0021696795896631927,0.0014380801108783037,0.002843421610892726,0.0010766287566001582,0.004572761390463558,0.0011891157980050437};

const static score_t log_LUT_loda[128] = {15.0,7.0,6.0,5.415037499278844,5.0,4.678071905112637,4.415037499278844,4.192645077942396,4.0,3.830074998557688,3.678071905112638,3.5405683813627027,3.415037499278844,3.299560281858908,3.192645077942396,3.0931094043914813,3.0,2.9125371587496605,2.830074998557688,2.7520724865564143,2.678071905112638,2.6076825772212398,2.5405683813627027,2.476438043942987,2.415037499278844,2.356143810225275,2.299560281858908,2.2451124978365313,2.192645077942396,2.1420190048724277,2.0931094043914813,2.0458036896131246,2.0,1.9556058806415466,1.9125371587496607,1.8707169830550336,1.8300749985576876,1.7905466343710503,1.7520724865564146,1.7145977811377517,1.6780719051126376,1.6424479953819162,1.6076825772212398,1.573735245297902,1.5405683813627027,1.5081469036703252,1.4764380439429872,1.4454111483223626,1.415037499278844,1.3852901558847919,1.3561438102252752,1.3275746580285044,1.2995602818589078,1.2720795454368008,1.2451124978365316,1.2186402864753405,1.1926450779423958,1.1671099858352583,1.142019004872428,1.1173569506381587,1.0931094043914815,1.0692626624371138,1.0458036896131249,1.0227200765000835,1.0,0.9776321869715455,0.9556058806415466,0.9339108095422276,0.9125371587496606,0.891475543221831,0.8707169830550335,0.850252880495318,0.8300749985576876,0.8101754411199827,0.7905466343710502,0.7711813095041191,0.7520724865564145,0.7332134593050986,0.7145977811377517,0.6962192518228971,0.6780719051126376,0.6601499971153753,0.6424479953819163,0.6249605686530753,0.6076825772212398,0.5906090638622983,0.5737352452979021,0.5570565041512716,0.5405683813627027,0.5242665690336022,0.5081469036703252,0.49220535980130375,0.47643804394298717,0.4608411888919686,0.44541114832236267,0.4301443916690522,0.4150374992788438,0.40008715781287235,0.3852901558847918,0.37064337992039037,0.3561438102252753,0.34178851724820525,0.3275746580285044,0.31349947281678164,0.2995602818589079,0.28575448233387735,0.27207954543680085,0.25853301359885306,0.24511249783653147,0.23181567522307364,0.2186402864753404,0.20558413364989406,0.1926450779423959,0.1798210375848123,0.16710998583525832,0.1545099490556248,0.14201900487242788,0.12963528041659547,0.11735695063815874,0.1051822366920565,0.09310940439148148,0.0811367627254055,0.06926266243711372,0.05748549466076013,0.04580368961312479,0.03421571533791296,0.02272007650008353,0.011315313227834146};
#endif