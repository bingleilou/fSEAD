#ifndef LODA_GENERATOR_1_H_
#define LODA_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void loda_shuttle_c7(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_loda
);
    
#define ENSEMBLE 35
#define DIM_MAX 9
#define BATCH_SIZE 128
#define N_BINS 20
const static param_t bottom_loda = 0.0327397510472687;
const static param_t delta_loda = 0.06681249496346338;
static param_t loda_min_X[35] = {-11108.73028393344,-5999.091717106362,-1358.8637580496063,-3879.469119790726,-3044.246207714205,-10780.90542821236,-6992.990456921235,-8931.447327179883,-8542.570995380418,-10661.934497958837,-1734.1399525648842,-1972.7553174537713,-7007.081895947475,-8065.864687500668,-4195.71596643011,-8790.022280485504,-4989.8806103029065,-1446.997123872553,-2086.5017878677004,-5671.957772122782,-1823.7009382218203,-4078.73658664663,-1473.8356566898788,-5198.797860691961,-1896.6937142945224,-3229.0489438263594,-5214.269902241262,-1720.2751406234609,-2977.11262146207,-4361.005274827035,-2257.7193678020994,-11598.179939914364,-3513.2895208899504,-1416.7158181694128,-8550.797134328157};

static param_t loda_projections[35][9] = {{0.4010565862799899,-0.35152596467603914,0.17007225143227162,-0.30570917618099946,0.33056093169019957,0.41975438674220594,-0.21686455053095616,0.21958667236859267,0.46096380003574067},
{0.025380434146921486,0.026382233247256835,0.18657990983241046,0.1259991728725968,-0.5927403435094973,-0.4026990050630743,0.3659004461602573,0.4039794457649332,-0.3706505421692881},
{0.41363058511774414,-0.27365381547092554,-0.39933130450873067,0.09580949201668425,0.45531956699007076,0.004503056255830432,0.38647237331292356,0.47135768346657103,-0.08064261972092127},
{-0.3285291072732571,0.31504389585558285,-0.06505648339876431,0.0946725414319566,0.5414153622340137,0.14665961289442186,0.37892643944920534,0.33698591761247,0.45589071225993805},
{0.09243659918710283,-0.28766240815913013,-0.22107544904750204,0.14327102105476422,0.3860212915558919,-0.22231833318446306,-0.6627814505619809,-0.40577297969612464,0.1921874953067232},
{0.352973259678136,0.4753409515759352,0.4466160238756906,-0.0340534245711679,0.05291005515454697,0.40329657118119505,-0.08204567792555512,-0.5257963399858676,0.013945125591253537},
{0.43449707415093014,-0.2840838816670687,-0.43168574563963896,-0.2556459113699598,-0.05483507322586545,-0.4285139988185677,-0.5243398520478257,-0.11275191447880546,-0.06726677217829237},
{-0.4319256264978357,-0.19403893416185447,-0.5637658842095439,0.03225436481583777,-0.03443773190290409,-0.5908589823700057,0.17799086833868755,0.07377174811842373,-0.2636162257851334},
{0.13835231212462565,0.2606836158586894,-0.0937032688100574,-0.23509721746421763,0.4251221668059899,-0.5395011776380624,0.4596276964706089,0.38152998583511744,0.14226228969970534},
{0.5126570235097122,0.05276851521279887,-0.21330840105830887,-0.14527122107269974,0.04071219071531107,0.3984704136158966,-0.2846981091272171,-0.5634891631812449,0.3298254918150163},
{-0.028687843493675546,0.12276348529564525,-0.8188730243884355,-0.07780636936831095,-0.21015143027792726,0.05948266313655441,-0.09243732956591576,-0.40641473204254025,-0.29339370809246107},
{-0.19218287160371836,0.09884930957323716,-0.09709415196144235,0.503605474524188,-0.4909648365083856,0.05559990434995269,-0.39044553709836344,-0.03220756895169669,0.5409491145699025},
{-0.6375789726166162,-0.5123508310116063,0.27238558235216975,-0.28724942439891504,-0.27146149360446686,0.26160973866481263,-0.016043627046268823,-0.10520592091637654,0.14431514372759235},
{-0.1874887698666389,0.49211579356584956,0.0616629975196008,0.32708951864041047,-0.00031482985851025147,-0.5668028484436537,-0.5279644527203532,0.0945921232117907,-0.05404097702424413},
{0.02375504149721069,-0.8309566767575569,0.11298392875463283,0.10130386139435596,0.44464292258252425,-0.0026173839980878698,0.2285866767274402,0.18927623465839277,0.011283518058997894},
{0.5054301591283372,-0.13020137808493518,-0.42785985301681606,-0.06924119309501515,-0.2688439105098397,-0.5578304592681566,-0.2649814064343723,0.2751627807785786,0.10172505864442474},
{-0.0014898049166613878,0.04233812795060673,-0.24970803863566118,-0.4996745816525869,0.04291929122756595,0.18229731352420064,-0.5271114714859069,-0.5298087054792497,-0.30423400112863436},
{0.48525891849661207,-0.3045792515247945,-0.40624699734061187,0.20442840768828052,-0.31458390654155,-0.040025691859432805,-0.1813005274250054,0.15809748779223426,0.5536225046792225},
{-0.3935295634012864,0.16548724876478219,-0.4016505264456705,0.34921886604745755,0.6117792975673476,-0.15763035613117024,0.3351173060172168,-0.12183911654240467,0.09056419938249412},
{0.13126848707517177,-0.2490307057901716,-0.14297853738704044,0.14787120752765956,0.15025044901730744,-0.39421219999984686,0.6716412284748576,-0.3257786577900463,0.37845925274499137},
{0.42554639152584106,-0.3179693032798255,-0.19993834666735177,0.46482749343739294,-0.22175488052353287,-0.13450990670455862,-0.3492498032454646,-0.5220002132151753,-0.006169279241084795},
{0.21126311017338878,-0.8036634299252409,-0.3627497829838554,-0.16860828347341908,-0.04324661645123769,-0.12075244336397861,-0.0333714588917878,-0.3185304529662305,0.17449958516193462},
{0.8186737992253483,0.18777012255439215,-0.06299830080487964,0.0593971483934532,-0.1286759067950323,0.05485021330786598,-0.24313745381519591,-0.19452277404207188,-0.41291381478229233},
{-0.05002832387412639,-0.6763735898666876,-0.3616164855411777,0.2440643394994575,0.34203568638630244,0.19187289707337854,0.03595526850492303,0.19339691588120073,-0.39646346806740546},
{-0.07952968710592694,-0.06076646441382857,0.7655387390915283,0.4872424906326862,0.2781149430212552,-0.1466383528009278,0.06131811296453211,0.16803928707918364,0.1888910239269964},
{0.41858555555724314,-0.02636547541704431,-0.24077422390495887,-0.24571706830913292,0.7062709311621035,-0.1952836996009876,0.2407461762423308,-0.10098180809957243,0.3172246701513},
{-0.24474233220266542,-0.41302651944021795,0.09405578308490377,-0.2459960931243829,-0.5624043511698171,-0.3082221524964511,0.3457111573523593,-0.389526793810441,0.1326756947767253},
{-0.45097001364403816,-0.24025435063798914,-0.08195559112788353,0.433725081196868,-0.6171115918258168,0.008576886741410179,0.14921273972447907,0.26999420901759946,0.26078369286819075},
{-0.3519059087658342,-0.5796750882214425,0.5971286688955713,0.10813396625977749,0.08155482734030403,-0.1440297157992122,-0.02618910814386564,-0.009029283257788876,-0.379104570478725},
{0.5004881146379706,-0.19313782300153465,-0.004853216139724266,-0.5644479999990032,-0.26888838524738257,0.16618965051570705,0.4857144141613244,0.2401748425995414,-0.007868876750412302},
{0.16615004654276858,0.21111680131598481,-0.08707472359638227,0.21915098879831715,0.8765875627648871,0.08351407311990447,0.23473058467778826,-0.14575483332405725,0.14314824634488038},
{0.23696695340118692,0.13383917300726447,-0.0822330160593811,-0.1860147705369291,0.6295564190029551,0.43661707555767176,0.1864973220906865,0.32017192082512,0.4003784579222018},
{-0.31584330443868097,0.7354234935986523,0.3339909937829568,-0.07327143825072442,-0.023165419871959362,-0.06349170638574163,-0.1764596336507127,0.39113682211838463,0.23191109315925507},
{0.011486473231537165,-0.18559254140058898,-0.519056383840794,-0.30545235080034133,0.22670103156574758,0.05407680902001998,0.2865123201727393,-0.018509109841606815,0.6826076805524376},
{-0.1766779278798537,-0.21348293568595064,-0.5580835269265886,-0.5536503218846458,-0.013919150738221735,-0.4995642552791422,0.057397871886509376,-0.046846900081724964,-0.22355471000842891}};

static param_t loda_delta[35] = {0.0011834520931928506,0.001189821133491633,0.007373622139274825,0.0031961607364518357,0.002238220511699345,0.0011755985745027816,0.001085111026429219,0.0008120078846641001,0.0008687213218439871,0.001215047677712016,0.008047757264867844,0.0052180700693252,0.0019201904002711264,0.0008616581045460812,0.002427138588251019,0.0008416721832923132,0.0027244771668495545,0.006881708584646525,0.0032201203834287006,0.00123363726794837,0.003719554182371699,0.002526541880230783,0.007912895632035096,0.002307556573879735,0.0033885303311077244,0.0023617257046027653,0.0014885568858977714,0.005941697847126079,0.0029397273616305606,0.0030316864338326326,0.004780128887247859,0.0011150625538164235,0.0027451495921768485,0.007611100897572777,0.0009164108220578807};

const static score_t log_LUT_loda[128] = {15.0,7.0,6.0,5.415037499278844,5.0,4.678071905112637,4.415037499278844,4.192645077942396,4.0,3.830074998557688,3.678071905112638,3.5405683813627027,3.415037499278844,3.299560281858908,3.192645077942396,3.0931094043914813,3.0,2.9125371587496605,2.830074998557688,2.7520724865564143,2.678071905112638,2.6076825772212398,2.5405683813627027,2.476438043942987,2.415037499278844,2.356143810225275,2.299560281858908,2.2451124978365313,2.192645077942396,2.1420190048724277,2.0931094043914813,2.0458036896131246,2.0,1.9556058806415466,1.9125371587496607,1.8707169830550336,1.8300749985576876,1.7905466343710503,1.7520724865564146,1.7145977811377517,1.6780719051126376,1.6424479953819162,1.6076825772212398,1.573735245297902,1.5405683813627027,1.5081469036703252,1.4764380439429872,1.4454111483223626,1.415037499278844,1.3852901558847919,1.3561438102252752,1.3275746580285044,1.2995602818589078,1.2720795454368008,1.2451124978365316,1.2186402864753405,1.1926450779423958,1.1671099858352583,1.142019004872428,1.1173569506381587,1.0931094043914815,1.0692626624371138,1.0458036896131249,1.0227200765000835,1.0,0.9776321869715455,0.9556058806415466,0.9339108095422276,0.9125371587496606,0.891475543221831,0.8707169830550335,0.850252880495318,0.8300749985576876,0.8101754411199827,0.7905466343710502,0.7711813095041191,0.7520724865564145,0.7332134593050986,0.7145977811377517,0.6962192518228971,0.6780719051126376,0.6601499971153753,0.6424479953819163,0.6249605686530753,0.6076825772212398,0.5906090638622983,0.5737352452979021,0.5570565041512716,0.5405683813627027,0.5242665690336022,0.5081469036703252,0.49220535980130375,0.47643804394298717,0.4608411888919686,0.44541114832236267,0.4301443916690522,0.4150374992788438,0.40008715781287235,0.3852901558847918,0.37064337992039037,0.3561438102252753,0.34178851724820525,0.3275746580285044,0.31349947281678164,0.2995602818589079,0.28575448233387735,0.27207954543680085,0.25853301359885306,0.24511249783653147,0.23181567522307364,0.2186402864753404,0.20558413364989406,0.1926450779423959,0.1798210375848123,0.16710998583525832,0.1545099490556248,0.14201900487242788,0.12963528041659547,0.11735695063815874,0.1051822366920565,0.09310940439148148,0.0811367627254055,0.06926266243711372,0.05748549466076013,0.04580368961312479,0.03421571533791296,0.02272007650008353,0.011315313227834146};
#endif