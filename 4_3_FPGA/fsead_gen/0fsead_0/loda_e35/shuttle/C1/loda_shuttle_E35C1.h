#ifndef LODA_GENERATOR_1_H_
#define LODA_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void loda_shuttle_c1(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_loda
);
    
#define ENSEMBLE 35
#define DIM_MAX 9
#define BATCH_SIZE 128
#define N_BINS 20
const static param_t bottom_loda = 0.0327397510472687;
const static param_t delta_loda = 0.06681249496346338;
static param_t loda_min_X[35] = {-8106.674826481601,-9554.258882826105,-4987.386794580813,-7635.790922837454,-4040.073954614799,-2655.832682648379,-18542.35273151427,-10838.291851468175,-1748.0010292574757,-7118.581943512919,-8990.07034791784,-14111.929347022757,-6848.28133184724,-2615.7216725943454,-13581.956141188792,-2644.2331479837253,-4133.883627600869,-2275.901001804441,-5484.190468191912,-10390.947166005151,-7240.56013065055,-8062.109410441935,-958.6189652376169,-2760.6905080964066,-11133.027121825273,-2519.078629490216,-12141.24614436089,-4598.196243035695,-7781.374349904332,-13443.471479770811,-2638.5872052852133,-6159.073271233084,-3710.715406911975,-5096.031604828444,-17824.0980597981};

static param_t loda_projections[35][9] = {{0.3054017538053018,-0.7040153631906927,0.18397384819915433,-0.38035239310963453,-0.31831392641040607,0.3059686628632588,-0.1230889355150127,0.14568739638023764,0.03551810083999841},
{-0.33573079953061247,-0.15095429055248216,0.018948123949097243,-0.17234587654184194,-0.2487737601584297,0.3544881573284351,-0.5645416735926425,0.048732106250428474,-0.5707916809277341},
{0.20390771738466143,0.18448898411686762,-0.6502636783359086,0.3260818042867907,-0.05646879368199157,-0.34988909844394095,-0.20471472545858563,0.3482877632910765,0.3261742974744182},
{-0.060332975300574104,0.2712471957376136,0.14639186570266693,-0.16064941766225613,-0.2273757280559231,0.2878897183803474,0.5347759111845201,0.6230646538717894,-0.2584009044315595},
{0.20168370670557728,-0.02513386930537521,0.5505077848331277,0.5336895341167156,-0.18577491994190232,-0.3101132830231299,-0.40469006512381506,0.11726933036753809,0.2501997546642934},
{0.17583825283654442,0.4588223056588363,-0.47586316463642075,-0.24413314813207845,-0.044743417399222565,0.09526541054078158,0.35007906071679973,-0.24394389487777426,-0.5285591837704383},
{-0.03307647383919276,0.06492845329433251,0.05008905120534592,0.2449146187652345,0.09949617514418159,0.6966217789779586,-0.07893627133907183,0.6449706258065759,0.12165000778717408},
{-0.0007236275739409439,0.4778915543449676,0.3923095162569487,0.3852503043826429,-0.07300372257577446,0.406272846769087,-0.5033461967753835,0.13141537891266503,-0.16816664330783243},
{-0.3846614613445502,-0.2432281517760889,0.28798516499107696,0.341530849390006,0.6275283246003555,-0.13615780593571,-0.032419689959345535,0.26848264723210535,-0.3283780375498509},
{0.0641075923398815,0.21758532975292147,-0.16280607015243698,-0.5726958374863471,0.2434776063602333,-0.40542528558417595,-0.45672200039326144,0.3142645957430119,-0.2511021173892544},
{-0.5730514878726154,-0.027427257409863112,0.2869237910646698,0.05125899097346932,-0.18782609012407459,-0.6026894733348375,0.057240185571098966,0.03911810513341507,-0.42730210082569303},
{0.3683806097545966,0.43458493289465516,-0.2483891736918411,0.2269067143300566,0.07585860268103167,0.5288590195882836,0.4186002835506368,-0.0867159280240249,0.30668482857823526},
{0.19176539822747968,0.5446156127521934,0.25591714945611016,-0.3968599463243845,-0.21021746146429196,-0.3997394204196823,-0.46730779031911296,-0.03269052011429346,0.14212753310546544},
{0.8596336733573339,0.042589573880543304,-0.054423273392347114,0.138879810379662,0.08196618789066697,-0.1881076682138831,0.3348070580455211,0.23581720073692838,0.16479718544420324},
{-0.25478970537004625,0.11353534379854341,0.392605303467083,-0.1636705714152428,-0.12355262440705224,0.5083156901104569,0.2963983791823467,0.38317896217379027,-0.4826352074219967},
{0.2259069889499001,0.5580480085935927,0.304084202080317,-0.09843581407032544,0.009511568900871011,0.0507734309298466,-0.33809427669937003,0.33746528132138187,0.551844791346508},
{-0.7451158952104403,0.02342405419378842,0.03862043739355367,0.018471812749430182,0.3959881928919462,0.154886008603902,0.16898929290074965,0.24939312871657038,0.41336452678228064},
{0.4040182243427608,-0.18022263006101163,-0.360132933878553,0.5826098153058656,0.4118092389830929,-0.16773509615025164,-0.08122076582876249,0.3553848181997639,0.06739478805551005},
{0.18427883965777977,0.18945958956366316,-0.07261331146045236,-0.35671365689510076,0.17207250072858427,-0.31280959696514704,-0.7225146970254896,0.093793845497465,0.37329008134224295},
{-0.4007592507009202,-0.12453824998907193,-0.10256342636957333,0.2538254508166656,-0.47312848634323545,0.3857558638825401,-0.5410613559665405,-0.2263487302428666,-0.1797118294499017},
{0.2607312967770092,-0.2518050103611032,-0.23616914732637903,-0.3177622666529344,-0.5411394200831482,-0.4296797092429617,0.48017736392315263,0.023977206813717688,0.05712242647968139},
{0.6599253746179005,0.3333992249715293,-0.15659004776966282,-0.18914675541453893,-0.4105802302493015,0.3040203304883486,0.33666491991196396,0.13284118859487548,-0.03243427309208805},
{-0.38360713728455326,0.12432945043521652,0.3581458601863868,0.23494773736372765,-0.1065152354476192,0.013529616626696503,-0.1381876282166758,-0.26976899253306624,-0.7419697970166049},
{-0.2915720259779812,0.5665704965545451,-0.08365318699352406,0.12904604205711948,0.12001199380337234,-0.13277764474652515,0.4563346429327714,-0.5726209186092697,-0.04651972770396954},
{-0.12622558240461665,-0.07694192499928361,-0.25886047625387254,0.20793587674021516,-0.4867204356456895,0.41420410058554297,0.30890583890589346,-0.5615101735961034,0.22073209042372574},
{0.03246484221137225,-0.10110235788989431,0.1905636940457022,-0.6728168226066711,0.4596520032779657,-0.058013233277309444,-0.33325295828467255,0.40591107522650594,-0.09623156669542246},
{-0.3455877372655276,-0.3512295803428211,0.05708267444524008,-0.5027593998507202,-0.15293592178571652,0.4508917084042372,-0.009967447936936158,-0.5114320266976051,-0.11325482353209987},
{-0.4522531394309524,-0.5846572541166855,-0.2829078366824279,-0.043393034436979644,-0.46797106119048026,-0.2819691036863967,0.03293207205882437,0.26853775199775387,-0.004760086769773003},
{-0.04635011493117458,0.39498767972252985,0.1003208057087655,-0.21574106576529908,-0.7349604043426479,0.29029308596953907,0.1732666786994866,-0.09124500331176884,-0.34992008217239234},
{-0.3068157545933765,-0.054996650240400374,0.2993566034953588,-0.05381958121645428,-0.30380535606265663,0.501443596184988,0.5385122196778002,-0.011984426075983037,-0.4200549084096828},
{-0.25044409631270903,-0.3625992744859591,0.5181852624069657,0.02551214130569207,-0.17796014526584444,-0.1768142633630344,-0.6685530863736644,-0.12194867189459543,-0.10892603144486775},
{-0.49971573854544343,-0.14163828718475713,0.16974650188421958,-0.18068777416620277,-0.21027715560710422,0.22634436049157838,0.20094907063346126,-0.7282192861772963,-0.05127104614405193},
{0.2632277055345233,-0.09120170419581682,-0.44184507014658103,-0.14264164783235792,0.6205641055563655,-0.2466352006490957,-0.24927119478316367,-0.27629137492972616,-0.3498827443133845},
{-0.7191847562877587,0.10066647177988004,0.024425718919813773,0.012456650950357724,-0.08944479237332531,-0.32920503730171813,0.4070333801829283,0.4315401905495274,0.06006935803605296},
{-0.29022118145111736,-0.4627605942800643,-0.14294080953463925,0.06706065547116759,0.1508538928431299,0.6678291558904651,0.07207153404249388,0.2906844168442677,0.3438759616742802}};

static param_t loda_delta[35] = {0.0016472018941807195,0.0013662959120053048,0.0013908174652184848,0.0017163879373069384,0.0016084184171885863,0.004095469406952083,0.0006800646329900875,0.0011312366422711398,0.0037358803014925198,0.0011138749459377784,0.0007985179188492814,0.0008886597996269077,0.0011367718738386353,0.0025798930438172625,0.0009489514299094095,0.003558172186011575,0.0030939270917143794,0.002944217791394969,0.0014383624571471427,0.0012077754150885032,0.0010659485724827768,0.001634950881478515,0.01082881728227143,0.0032232197588682966,0.0011323406040153682,0.003856527715183155,0.001100784187431337,0.001649407005769844,0.0017079440246024727,0.0009508886590207733,0.0027150641820555678,0.0021334183187267696,0.0019610216725628733,0.0014382963728788408,0.0007157100393767668};

const static score_t log_LUT_loda[128] = {15.0,7.0,6.0,5.415037499278844,5.0,4.678071905112637,4.415037499278844,4.192645077942396,4.0,3.830074998557688,3.678071905112638,3.5405683813627027,3.415037499278844,3.299560281858908,3.192645077942396,3.0931094043914813,3.0,2.9125371587496605,2.830074998557688,2.7520724865564143,2.678071905112638,2.6076825772212398,2.5405683813627027,2.476438043942987,2.415037499278844,2.356143810225275,2.299560281858908,2.2451124978365313,2.192645077942396,2.1420190048724277,2.0931094043914813,2.0458036896131246,2.0,1.9556058806415466,1.9125371587496607,1.8707169830550336,1.8300749985576876,1.7905466343710503,1.7520724865564146,1.7145977811377517,1.6780719051126376,1.6424479953819162,1.6076825772212398,1.573735245297902,1.5405683813627027,1.5081469036703252,1.4764380439429872,1.4454111483223626,1.415037499278844,1.3852901558847919,1.3561438102252752,1.3275746580285044,1.2995602818589078,1.2720795454368008,1.2451124978365316,1.2186402864753405,1.1926450779423958,1.1671099858352583,1.142019004872428,1.1173569506381587,1.0931094043914815,1.0692626624371138,1.0458036896131249,1.0227200765000835,1.0,0.9776321869715455,0.9556058806415466,0.9339108095422276,0.9125371587496606,0.891475543221831,0.8707169830550335,0.850252880495318,0.8300749985576876,0.8101754411199827,0.7905466343710502,0.7711813095041191,0.7520724865564145,0.7332134593050986,0.7145977811377517,0.6962192518228971,0.6780719051126376,0.6601499971153753,0.6424479953819163,0.6249605686530753,0.6076825772212398,0.5906090638622983,0.5737352452979021,0.5570565041512716,0.5405683813627027,0.5242665690336022,0.5081469036703252,0.49220535980130375,0.47643804394298717,0.4608411888919686,0.44541114832236267,0.4301443916690522,0.4150374992788438,0.40008715781287235,0.3852901558847918,0.37064337992039037,0.3561438102252753,0.34178851724820525,0.3275746580285044,0.31349947281678164,0.2995602818589079,0.28575448233387735,0.27207954543680085,0.25853301359885306,0.24511249783653147,0.23181567522307364,0.2186402864753404,0.20558413364989406,0.1926450779423959,0.1798210375848123,0.16710998583525832,0.1545099490556248,0.14201900487242788,0.12963528041659547,0.11735695063815874,0.1051822366920565,0.09310940439148148,0.0811367627254055,0.06926266243711372,0.05748549466076013,0.04580368961312479,0.03421571533791296,0.02272007650008353,0.011315313227834146};
#endif