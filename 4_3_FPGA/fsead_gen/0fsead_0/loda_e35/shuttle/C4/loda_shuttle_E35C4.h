#ifndef LODA_GENERATOR_1_H_
#define LODA_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void loda_shuttle_c4(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_loda
);
    
#define ENSEMBLE 35
#define DIM_MAX 9
#define BATCH_SIZE 128
#define N_BINS 20
const static param_t bottom_loda = 0.0327397510472687;
const static param_t delta_loda = 0.06681249496346338;
static param_t loda_min_X[35] = {-4037.2097678617283,-7105.981829774107,-2278.0147758482976,-1762.6132162199806,-4335.183834857317,-2269.2120890439332,-1345.0516003906366,-2700.0042418405524,-2233.885180657473,-2080.5956469835205,-3307.3380843682257,-10812.71793577685,-6952.306645696472,-2714.6966736250884,-2749.0438305860307,-1387.706986276578,-4236.199362460909,-9216.769410726401,-5680.542285832231,-7731.942580732212,-10965.77631751546,-3853.3175959143878,-6084.979638692386,-3226.4906474443824,-3864.922500586984,-3436.836278069241,-19694.412760283256,-5129.857777724423,-16944.678074642245,-9123.033513754895,-8681.873345113181,-7113.741483423077,-5240.682027982262,-6023.988543613641,-14700.952911456077};

static param_t loda_projections[35][9] = {{0.18292391995621493,-0.7911089505386785,-0.05771772851727705,-0.0933070713743648,0.16997297642631343,-0.17817372378519117,0.48441238132105613,-0.11254057599804164,-0.14384191720767273},
{0.4092418811933589,-0.08092156635840991,0.37206777736512964,0.35678616534434004,0.5256230018608581,-0.5256389496197171,-0.04344915488168769,0.010000891214200494,-0.07535444056805968},
{0.047956787646965905,0.1029859550277938,-0.1459932281576272,0.19784735913568194,0.5386646931732377,-0.16598229657190725,-0.10434736302831657,0.4280812836526375,0.6440378151703456},
{-0.11578102074912765,0.3763591558397281,0.8791624639620063,-0.059196478787006915,0.13259731090905208,-0.053922854680820004,-0.13557124067847104,-0.1685862585082531,0.035029572295685686},
{0.6047675950096989,-0.25509668665567903,-0.3217947008759381,-0.4291037028675846,-0.024908406435183213,-0.2281280350516864,-0.3992550956316849,0.043139985943412736,0.25994518709571185},
{0.7040218202365484,0.23057078186820834,0.08595432803431499,0.3287593946349465,0.2633235556489684,-0.17602802124885866,-0.3347191817871726,-0.19018804421736601,0.29527262498753265},
{-0.23282207880801659,-0.04617916105736779,0.5147891424274544,0.34722329978190347,0.5626421271128641,-0.07753670880480441,-0.1591501647442271,0.3714322243138848,0.2687391058623213},
{0.05962291208999033,0.5580563598840954,-0.41627619476780486,0.22763081945275643,-0.3408590685281413,-0.02613761380484119,0.4980874061863124,0.03947189568966758,0.30561311007170133},
{-0.085261039413818,-0.20042823562711629,-0.7904578936352243,0.21594739953236358,-0.0030804085575735028,-0.16320658689656944,-0.3246804967169368,-0.3832712110632639,0.046281653437227274},
{0.5317461042056806,-0.12654490231118806,0.15025841908091442,-0.21665725116560677,0.0010624655920195478,0.07833375229471544,-0.2688182100801376,-0.6685438756432418,0.3261335034327529},
{0.28754582003054074,0.11674590754512597,-0.6777947097339321,-0.22017693166561086,0.1256548793864662,-0.19400945397402627,-0.5111054688250546,-0.06433761629663703,-0.27750188935375036},
{-0.4126944796041951,0.07864587081059302,0.00645936041151095,0.21353972231916724,0.4089769685211103,-0.7408840600467957,-0.18522263664923033,0.020824420516807163,0.16414848258299072},
{-0.031982015318968465,0.17556823096990382,-0.7306841044784836,0.2106861246024634,-0.35378752895605264,-0.47317480666308853,0.15498545168268785,-0.10537217606610312,-0.07537402938037613},
{-0.33438567049516127,0.5021415191317408,0.01801415907555149,0.3797146896855295,-0.18865134263886874,0.10083695605528593,0.6398350832183635,0.14141168583384564,-0.1280185269717942},
{0.0671796436005418,0.24565624803395958,0.17747125444415235,0.6121951873990991,0.2310205158439955,-0.21311638408758254,0.39368860128552424,0.4320394554735715,0.2973601047274809},
{-0.28009480987609814,0.3055128007138839,0.7147373763904497,-0.006096702835407005,0.18634642164465234,0.045900098264487106,0.24467773434944354,0.46610207246379176,0.058068886364300576},
{-0.6824399978150825,-0.21607810934540805,-0.03270626537481357,0.32953327445185765,-0.23272833529979686,-0.31735947027480443,-0.18795186252316406,-0.24800981484116905,-0.3552601004477372},
{-0.755468413399619,-0.2982344021440598,0.10165649744176317,0.19396768285242255,-0.20189589893640073,0.3413099915239561,-0.2527663783094801,-0.2087642162493843,-0.16624803144290481},
{-0.22552694330601075,-0.11406059754281588,0.15642402078186685,-0.43140928249795163,-0.4668014597755977,0.21392892976476643,-0.005189599587738705,-0.34511242814428517,0.5854456633931172},
{-0.10549202453961168,0.2531440975621792,0.037613346315069685,-0.4547460754278881,0.0898351133726393,-0.4447194786689995,0.12990845326208994,0.4173818784027243,0.5653769899276441},
{0.13199831174596244,0.011904272128392802,-0.014290710439524403,-0.15900171320265175,-0.037142846333675594,-0.7019797950314824,-0.5161888378537826,-0.36326872944898647,0.25372949179891474},
{0.2646716863268077,-0.7578144993984296,-0.03281274535207736,-0.12721549449391148,-0.49541526260292945,-0.08383893080864074,-0.07841256335289779,-0.06315580138213689,-0.2753237922568682},
{-0.10529017107892967,0.5949420054038852,0.22622905521912856,0.20898152662684832,0.5180657203006759,0.22855855025079497,-0.3878547685239297,0.07289443380281982,0.25244624139399935},
{-0.048981813124323,0.33853260958802733,0.16904893117376582,-0.6421578900969616,-0.06740300570055864,-0.13063153555264814,0.01370983278818415,0.6480224413342478,-0.017981936425457243},
{-0.15886951770940466,-0.13585542297515768,-0.044895681010686736,-0.5469832592816553,0.02214295850400704,0.13945339938656845,-0.21076880127521425,-0.4989505400568225,-0.584623624272455},
{-0.41714501275378274,-0.6778653918516357,0.2046108101071039,0.16523330616886908,-0.22748951381055724,0.017855247159850075,0.16638860163935498,0.3315003584611647,0.32813560706514366},
{-0.4389392892607247,0.22556468712952726,-0.10544120916438716,0.2141029887411177,-0.37027870002167385,0.7360199988099034,-0.07078530384246852,0.09291627705443575,0.08378058107892909},
{0.5854181078532074,0.6516029517312388,-0.36638850813309043,-0.03152549032980892,0.13077832600740846,0.19340469735900606,0.09273237292260293,0.12198791916903266,0.1395569558829112},
{0.2130184641894631,0.05116523983959321,0.6279222098407051,0.10021174582948067,-0.02880605953694507,0.6381397294617214,0.21156343215499007,0.17543562314261005,0.2531555044966083},
{-0.14906339883708553,0.2072811631653528,0.190229715849427,-0.4410907642499709,-0.5622870300009666,0.3439350019427194,-0.23621189098931006,-0.029919643516223816,0.4614292830365746},
{-0.19802650395259383,-0.0004703496382347181,0.35652567358223686,0.3450878905732551,-0.3902863904837378,0.3274949107279966,0.13961368691295986,-0.17041192834748814,0.637558220332749},
{-0.13586269453330022,-0.08601114628496713,0.6453989481436593,-0.26000520655307086,-0.16471947581484556,0.26746983921167033,-0.5422174425368916,0.16425333712670073,-0.26523455072842783},
{-0.6884838392492146,0.2864395983668929,0.10176774531254368,-0.3504408537587172,0.3247010685298296,-0.3082360283467974,-0.16803457804056085,-0.1851042234231314,0.2187177806881889},
{0.4657139458976739,-0.10066700667472166,0.166214186401828,-0.19516617139757378,-0.2985872454875385,-0.3764579254881113,-0.2740370896643561,-0.6281546324192515,0.08191582614023901},
{-0.1381995845872918,0.33648600798969946,0.03815474800842397,-0.3263274381535056,-0.08802194551327856,0.5501415388262207,-0.6581188931940238,0.1270351889398433,-0.00840637363589645}};

static param_t loda_delta[35] = {0.0022779036695046925,0.0009435518603117164,0.002936698791587184,0.005363140140406034,0.0019058374386028043,0.0028423979503284006,0.005723886537577743,0.003629174941215442,0.003085132329642319,0.006398118843280556,0.002375627591085701,0.0006536817371667391,0.0010240528132816839,0.0038592615617716645,0.0023421212463072363,0.006706897636308235,0.0015872692343022812,0.001359364742740621,0.002364252100885411,0.0010135727584769186,0.0006726787784338554,0.0026691205870549577,0.002001913138451879,0.0029361210723524733,0.003339186609460768,0.0029713054698531794,0.00064436516223377,0.002352495647274741,0.0007466377034163842,0.0014688923258510702,0.001424618089882866,0.0018635103719484632,0.0014890196397415738,0.0012432494936318054,0.0008939422762312095};

const static score_t log_LUT_loda[128] = {15.0,7.0,6.0,5.415037499278844,5.0,4.678071905112637,4.415037499278844,4.192645077942396,4.0,3.830074998557688,3.678071905112638,3.5405683813627027,3.415037499278844,3.299560281858908,3.192645077942396,3.0931094043914813,3.0,2.9125371587496605,2.830074998557688,2.7520724865564143,2.678071905112638,2.6076825772212398,2.5405683813627027,2.476438043942987,2.415037499278844,2.356143810225275,2.299560281858908,2.2451124978365313,2.192645077942396,2.1420190048724277,2.0931094043914813,2.0458036896131246,2.0,1.9556058806415466,1.9125371587496607,1.8707169830550336,1.8300749985576876,1.7905466343710503,1.7520724865564146,1.7145977811377517,1.6780719051126376,1.6424479953819162,1.6076825772212398,1.573735245297902,1.5405683813627027,1.5081469036703252,1.4764380439429872,1.4454111483223626,1.415037499278844,1.3852901558847919,1.3561438102252752,1.3275746580285044,1.2995602818589078,1.2720795454368008,1.2451124978365316,1.2186402864753405,1.1926450779423958,1.1671099858352583,1.142019004872428,1.1173569506381587,1.0931094043914815,1.0692626624371138,1.0458036896131249,1.0227200765000835,1.0,0.9776321869715455,0.9556058806415466,0.9339108095422276,0.9125371587496606,0.891475543221831,0.8707169830550335,0.850252880495318,0.8300749985576876,0.8101754411199827,0.7905466343710502,0.7711813095041191,0.7520724865564145,0.7332134593050986,0.7145977811377517,0.6962192518228971,0.6780719051126376,0.6601499971153753,0.6424479953819163,0.6249605686530753,0.6076825772212398,0.5906090638622983,0.5737352452979021,0.5570565041512716,0.5405683813627027,0.5242665690336022,0.5081469036703252,0.49220535980130375,0.47643804394298717,0.4608411888919686,0.44541114832236267,0.4301443916690522,0.4150374992788438,0.40008715781287235,0.3852901558847918,0.37064337992039037,0.3561438102252753,0.34178851724820525,0.3275746580285044,0.31349947281678164,0.2995602818589079,0.28575448233387735,0.27207954543680085,0.25853301359885306,0.24511249783653147,0.23181567522307364,0.2186402864753404,0.20558413364989406,0.1926450779423959,0.1798210375848123,0.16710998583525832,0.1545099490556248,0.14201900487242788,0.12963528041659547,0.11735695063815874,0.1051822366920565,0.09310940439148148,0.0811367627254055,0.06926266243711372,0.05748549466076013,0.04580368961312479,0.03421571533791296,0.02272007650008353,0.011315313227834146};
#endif