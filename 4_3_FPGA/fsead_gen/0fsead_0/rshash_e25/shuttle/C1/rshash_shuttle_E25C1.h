#ifndef RSHASH_GENERATOR_1_H_
#define RSHASH_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void rshash_shuttle_c1(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_rshash
);
    
#define ENSEMBLE 25
#define DIM_MAX 9
#define BATCH_SIZE 128
#define HASH_NUM 2
#define MATRIX_COL 128
const static param_t bottom_rshash = -6.133982010631548;
const static param_t delta_rshash = 0.1630262361817786;
static param_t rshash_f[25] = {2.6717073286419257,2.161807982683697,1.5469348025067873,2.3854223554025853,11.2898648127885,1.6942913029176603,1.7280493128370564,8.905495613663254,8.85533732978939,1.1971210426514187,8.875276573628176,1.35936245309396,1.135539393882356,1.4543424207168232,1.3097816110537464,2.594384866744901,3.5436397998305638,9.384403897565123,2.2048166925766237,6.650532661788604,3.9861003404908772,1.9785635040059586,2.753673105531417,1.5375808019094759,3.571139702220572};

static param_t rshash_alpha[25][9] = {{0.3158635572156418,0.1237866531581344,0.03560193829418147,0.27454308395582944,0.02587690998211159,0.13204288994899505,0.34748090284094013,0.19112842733217222,0.16266940964582322},
{0.0869063579470084,0.24547763450682314,0.013502935834424554,0.08641091827921393,0.16974281223142842,0.17149404330346033,0.340039286492445,0.07433178074002353,0.34612063460955567},
{0.5374540783921384,0.5304678369218488,0.24242648884422152,0.031759608859155436,0.5282692897215528,0.6339240219558309,0.24185670935340964,0.3847374103906619,0.15953706072674953},
{0.006223486380247713,0.11603378607619674,0.3330964990752132,0.3118717624744214,0.28649265078096464,0.37149365698682496,0.33756420482516103,0.12594612771417443,0.2632385078105509},
{0.0027669247568657997,0.012294631833566211,0.08323233722683844,0.04535778357256144,0.06921327775677741,0.06626250833916439,0.04782648085915895,0.004005958424011437,0.06881615345036406},
{0.47475150184882214,0.37088130197792935,0.41363236065662073,0.34500501021607033,0.3728526164620882,0.5720696941955264,0.09365519611839991,0.23338816624825717,0.4641099734701034},
{0.28851567432443775,0.37213110197685295,0.5495081539850251,0.45800312758752326,0.48684028319124706,0.18701393788224974,0.33965580693517267,0.055418428413625966,0.3276675609108094},
{0.08873311492374741,0.09246965438871417,0.01599941552656873,0.08437931743047093,0.023351772778571995,0.06134480118259977,0.10992834459802882,0.09265742539267262,0.07938375266908751},
{0.06295194199703265,0.011992386711493433,0.11190591485081886,0.05398019751310331,0.10796300239648543,0.06694942545620138,0.10089225531068038,0.06219002899194075,0.09032935982811795},
{0.10695277075294472,0.707597388544192,0.32402855779402695,0.6505265808949158,0.3184491438785148,0.10969209644159425,0.4139932269480884,0.19744031488138894,0.8317928845548954},
{0.08132853159433838,0.07748473729815204,0.07100967899147453,0.048933586017319564,0.006081085376617869,0.09470728716801474,0.030121506029441338,0.07531716769662536,0.05227293094496097},
{0.4122060378828039,0.38046314692743666,0.4954512256681832,0.14168215787115593,0.6222403843071839,0.3448742437784074,0.27616913424489836,0.07503194395029376,0.10813638698185256},
{0.6340038794967957,0.10115485928414154,0.831663147075427,0.3185388936273231,0.8355063446461167,0.8795757121554841,0.40884138161606554,0.0024939812491974037,0.6381589212938881},
{0.5342370851113364,0.5537151405466808,0.3245482418314512,0.0450451042389898,0.09710744385814801,0.6728669208283811,0.1950391964061565,0.19057500078625741,0.1856266319688761},
{0.03419341640137939,0.3838683393626123,0.3712797685090852,0.5125171542365643,0.23362432909490058,0.5925214149103374,0.0847468836584192,0.009686492496722175,0.6925963683518338},
{0.35209662773379946,0.3095776967125638,0.35736062991653306,0.12294474362075035,0.24555925944663953,0.34563322478249986,0.2439848748743087,0.07630859544057178,0.006611603083773134},
{0.21060694215653017,0.11391387687339379,0.26077013958553186,0.19933782028875524,0.13020708950601848,0.12741156563595446,0.15390736322399565,0.025975134726294587,0.24840560790919508},
{0.028784999193055653,0.07626788865105721,0.013082765683604574,0.07070393359010148,0.052760928186089184,0.03477648189253829,0.028666790646765337,0.01767104114133698,0.021783114705484587},
{0.14187269789820955,0.18941000825275614,0.11695092493058748,0.4317477686282853,0.29294972517927614,0.3396623572989714,0.275943983696443,0.07361780644509279,0.21461324743987986},
{0.024328277915923877,0.029556552945316925,0.04499086778921931,0.11645807691037953,0.11507070238326796,0.060868205772268404,0.07179539743586134,0.011858610128247722,0.01656724692134791},
{0.05881390247595252,0.23806058343329575,0.20441258739465784,0.07444726513326531,0.046756868665136626,0.2183934625354858,0.2265705271603078,0.08696268381117138,0.15134798364898402},
{0.40859177560562115,0.07988136545451532,0.38274077471849116,0.4790091846055259,0.13067710988429834,0.40961992881019427,0.18147861005594498,0.2670142055104788,0.3658652798563551},
{0.14892325871776768,0.13252887412226336,0.2081631347785551,0.2026800510673562,0.3161512118918488,0.22214726323504777,0.08216261433357602,0.044582533770066615,0.28101527264727116},
{0.6333609545881995,0.4115296344150799,0.4070236638742922,0.36519482730393044,0.42639945260313145,0.16535602778052394,0.3825458321684079,0.5606337687631987,0.039774493244007975},
{0.1857564859360943,0.15725784849193936,0.037791630697949975,0.04104692977087465,0.06474402755210167,0.07889446289450563,0.15510446103438413,0.1524768273866878,0.16772438317749394}};
static param_t rshash_min_X[9] = {27,-4821,21,-3939,-188,-26739,-48,-353,-356};
static param_t rshash_delta_X[9] = {0.010101010101010102,0.00010105092966855295,0.0078125,0.00012871669455528383,0.0016025641025641025,-4.231371387466678e-05,0.006535947712418301,0.0016051364365971107,0.001607717041800643};

const static score_t log_LUT_rshash[128] = {-0.0,-1.0,-1.584962500721156,-2.0,-2.321928094887362,-2.584962500721156,-2.807354922057604,-3.0,-3.169925001442312,-3.321928094887362,-3.4594316186372973,-3.584962500721156,-3.700439718141092,-3.807354922057604,-3.9068905956085187,-4.0,-4.087462841250339,-4.169925001442312,-4.247927513443585,-4.321928094887363,-4.392317422778761,-4.459431618637297,-4.523561956057013,-4.584962500721156,-4.643856189774724,-4.700439718141092,-4.754887502163468,-4.807354922057604,-4.857980995127572,-4.906890595608519,-4.954196310386875,-5.0,-5.044394119358453,-5.087462841250339,-5.129283016944966,-5.169925001442312,-5.20945336562895,-5.247927513443585,-5.285402218862249,-5.321928094887363,-5.357552004618084,-5.392317422778761,-5.426264754702098,-5.459431618637297,-5.491853096329675,-5.523561956057013,-5.554588851677638,-5.584962500721156,-5.614709844115208,-5.643856189774724,-5.672425341971495,-5.700439718141092,-5.727920454563199,-5.754887502163468,-5.78135971352466,-5.807354922057604,-5.832890014164741,-5.857980995127572,-5.882643049361842,-5.906890595608519,-5.930737337562887,-5.954196310386875,-5.977279923499917,-6.0,-6.022367813028454,-6.044394119358453,-6.066089190457772,-6.087462841250339,-6.108524456778169,-6.129283016944966,-6.149747119504682,-6.169925001442312,-6.189824558880018,-6.20945336562895,-6.22881869049588,-6.247927513443585,-6.266786540694901,-6.285402218862249,-6.303780748177103,-6.321928094887363,-6.339850002884624,-6.357552004618084,-6.3750394313469245,-6.392317422778761,-6.409390936137702,-6.426264754702098,-6.442943495848728,-6.459431618637297,-6.475733430966398,-6.491853096329675,-6.507794640198696,-6.523561956057013,-6.539158811108031,-6.554588851677638,-6.569855608330948,-6.584962500721156,-6.599912842187128,-6.614709844115208,-6.6293566200796095,-6.643856189774724,-6.658211482751795,-6.672425341971495,-6.6865005271832185,-6.700439718141092,-6.714245517666122,-6.727920454563199,-6.7414669864011465,-6.754887502163468,-6.768184324776926,-6.78135971352466,-6.794415866350106,-6.807354922057604,-6.820178962415188,-6.832890014164741,-6.845490050944375,-6.857980995127572,-6.870364719583405,-6.882643049361842,-6.894817763307944,-6.906890595608519,-6.918863237274595,-6.930737337562887,-6.94251450533924,-6.954196310386875,-6.965784284662087,-6.977279923499917,-6.9886846867721655,-7.0};
#endif