#ifndef RSHASH_GENERATOR_1_H_
#define RSHASH_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void rshash_shuttle_c3(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_rshash
);
    
#define ENSEMBLE 25
#define DIM_MAX 9
#define BATCH_SIZE 128
#define HASH_NUM 2
#define MATRIX_COL 128
const static param_t bottom_rshash = -6.133982010631548;
const static param_t delta_rshash = 0.1630262361817786;
static param_t rshash_f[25] = {1.3573426629495393,3.05867961517,5.376176615866949,1.1914290964083727,1.877331287529393,1.7312511292589778,2.5059728983835265,2.2896797711384327,6.120454326159517,1.408607749707735,5.276020210952038,1.6543529269380326,5.524830078675737,1.6185624882801846,2.3868972816836402,1.168452178204923,2.3167076215298104,6.718715596958516,2.277836863114861,5.791671988665492,4.077787609231143,4.984550584356701,5.981234460877375,1.8717955556358405,6.376475190057567};

static param_t rshash_alpha[25][9] = {{0.44418213358206576,0.3417896814252338,0.17698971591281934,0.2549120627547832,0.0278683336926634,0.5473862893730858,0.18840236781244885,0.6496349050405195,0.6001758595352269},
{0.1619309975230073,0.2003468892830802,0.3115357365845234,0.061902546499771866,0.005620287943467542,0.22978691617865588,0.3127469011024619,0.3097834698719197,0.20733562928340768},
{0.16631935081639804,0.09162842468849754,0.020788795148938763,0.04077529409162377,0.14827096582751845,0.057548651364659975,0.11162194289857447,0.17330368467235313,0.15837592828726613},
{0.4594094414808925,0.8027738254352219,0.36757898374868525,0.6932386237194803,0.7659189574059391,0.19323653141068395,0.38850466364943803,0.5842358036076859,0.6160948523454347},
{0.47025003678242505,0.4236464776298915,0.45184202056353096,0.4216557876347279,0.09750843237614064,0.14882295250931685,0.12351622524888978,0.2408242787997655,0.5092478997617746},
{0.047820547373230486,0.27303732322381363,0.008278298912370486,0.2846274038524305,0.21611150724992245,0.391948951075361,0.17084431492344856,0.44646177237729473,0.5271862964510419},
{0.2304236041706082,0.2386159168077643,0.22939887879465445,0.07414522229014205,0.12241936810793565,0.08519084252757493,0.042255644317488066,0.10646597213623343,0.33100360681292174},
{0.20712842501784917,0.39496697377867485,0.07691356290570336,0.2880143181573836,0.10821235094626334,0.04281160452836331,0.05618886831727884,0.07775778921998508,0.09265843119879097},
{0.10048808022399468,0.08217970913796317,0.09464854114116623,0.1322518023663586,0.033087750992449566,0.15637527978152357,0.0077786306049731765,0.06104072836290309,0.11103288393395884},
{0.12564908827418794,0.5646253962215128,0.4010406445576872,0.4387250279978842,0.2890333935283116,0.5126094286099576,0.07860901663517357,0.07052934235970908,0.5507651060180312},
{0.09723209746550136,0.06300273600007429,0.15476066597304503,0.10257405495717811,0.18864499921268887,0.07677460746988317,0.13002958112386567,0.07896622195243967,0.1526023044649438},
{0.5890069234777642,0.38229702527221504,0.518153911433754,0.31569121095130387,0.0004914771627473954,0.05814820796765708,0.3415750873387359,0.2104406823027852,0.38666758671651014},
{0.03921629433674132,0.045392124724940634,0.08720278122026966,0.048444403024163,0.1675752717192623,0.16891022344471082,0.07550444927778079,0.0379015499512974,0.0009286845141570785},
{0.17832125032135143,0.25810640582901595,0.10530735513170605,0.5607271863672,0.23205222330721392,0.4355184510809786,0.26479696431942007,0.4294170940185541,0.2078992515998428},
{0.3566950041700909,0.3580388731084177,0.328224886101801,0.2686234009412805,0.2798095231211362,0.09752069765058557,0.0561769912814765,0.32322392109534415,0.20112478874717324},
{0.7477724262294291,0.519768959509201,0.4413456437945443,0.663491337461914,0.4734145207263488,0.4238095615713559,0.02524971461094084,0.32342304300175145,0.13404077197317735},
{0.4106075331502244,0.42606338025548024,0.3989400537081544,0.0203048601744216,0.05324760930602879,0.000515118528006493,0.2765476726762537,0.35992369724496204,0.40159456082990314},
{0.028300890059901985,0.02511535586884514,0.08525575577043457,0.08364890905693805,0.04568146028295224,0.12186597979702266,0.09732510815781986,0.04463850758898843,0.0586294851233765},
{0.08188062434746915,0.08806221751808245,0.32532194650364615,0.24098544590492188,0.24178114155706062,0.3662318979918208,0.2124852955599207,0.31084436875444765,0.17829861875044783},
{0.05072682105271401,0.14456303062372602,0.05552193737969525,0.018779704519461853,0.1478550110218286,0.14611822704864114,0.09437641140278522,0.045851458726251015,0.005061377187717737},
{0.07605221262940688,0.2311156524547937,0.03273717873058043,0.06899658810613658,0.09500381920717701,0.11436627724886322,0.039284331809228704,0.2212314675453919,0.24503159873982813},
{0.19252016366532257,0.1628601865606401,0.14506522036726432,0.17402057093373557,0.1963224904833217,0.14103978874973788,0.03343752125371182,0.1529568516285466,0.050175589709124224},
{0.010880262146556591,0.13774887334775335,0.03167648746224743,0.10552359105266632,0.14951235709421865,0.0744239507822692,0.010189179458438925,0.11188093293406384,0.13774972730288942},
{0.059920023785467465,0.4005766324095275,0.5111631286268876,0.1702410019436371,0.3089582090900409,0.3161101963513848,0.09582065958242277,0.27193842408896896,0.4465971315693398},
{0.07727375852646678,0.05397210054542325,0.028801031172274363,0.010382091855034858,0.08291114988348822,0.02545922258176723,0.11558109077263802,0.06944802722030848,0.05062531687700002}};
static param_t rshash_min_X[9] = {27,-4821,21,-3939,-188,-26739,-48,-353,-356};
static param_t rshash_delta_X[9] = {0.010101010101010102,0.00010105092966855295,0.0078125,0.00012871669455528383,0.0016025641025641025,-4.231371387466678e-05,0.006535947712418301,0.0016051364365971107,0.001607717041800643};

const static score_t log_LUT_rshash[128] = {-0.0,-1.0,-1.584962500721156,-2.0,-2.321928094887362,-2.584962500721156,-2.807354922057604,-3.0,-3.169925001442312,-3.321928094887362,-3.4594316186372973,-3.584962500721156,-3.700439718141092,-3.807354922057604,-3.9068905956085187,-4.0,-4.087462841250339,-4.169925001442312,-4.247927513443585,-4.321928094887363,-4.392317422778761,-4.459431618637297,-4.523561956057013,-4.584962500721156,-4.643856189774724,-4.700439718141092,-4.754887502163468,-4.807354922057604,-4.857980995127572,-4.906890595608519,-4.954196310386875,-5.0,-5.044394119358453,-5.087462841250339,-5.129283016944966,-5.169925001442312,-5.20945336562895,-5.247927513443585,-5.285402218862249,-5.321928094887363,-5.357552004618084,-5.392317422778761,-5.426264754702098,-5.459431618637297,-5.491853096329675,-5.523561956057013,-5.554588851677638,-5.584962500721156,-5.614709844115208,-5.643856189774724,-5.672425341971495,-5.700439718141092,-5.727920454563199,-5.754887502163468,-5.78135971352466,-5.807354922057604,-5.832890014164741,-5.857980995127572,-5.882643049361842,-5.906890595608519,-5.930737337562887,-5.954196310386875,-5.977279923499917,-6.0,-6.022367813028454,-6.044394119358453,-6.066089190457772,-6.087462841250339,-6.108524456778169,-6.129283016944966,-6.149747119504682,-6.169925001442312,-6.189824558880018,-6.20945336562895,-6.22881869049588,-6.247927513443585,-6.266786540694901,-6.285402218862249,-6.303780748177103,-6.321928094887363,-6.339850002884624,-6.357552004618084,-6.3750394313469245,-6.392317422778761,-6.409390936137702,-6.426264754702098,-6.442943495848728,-6.459431618637297,-6.475733430966398,-6.491853096329675,-6.507794640198696,-6.523561956057013,-6.539158811108031,-6.554588851677638,-6.569855608330948,-6.584962500721156,-6.599912842187128,-6.614709844115208,-6.6293566200796095,-6.643856189774724,-6.658211482751795,-6.672425341971495,-6.6865005271832185,-6.700439718141092,-6.714245517666122,-6.727920454563199,-6.7414669864011465,-6.754887502163468,-6.768184324776926,-6.78135971352466,-6.794415866350106,-6.807354922057604,-6.820178962415188,-6.832890014164741,-6.845490050944375,-6.857980995127572,-6.870364719583405,-6.882643049361842,-6.894817763307944,-6.906890595608519,-6.918863237274595,-6.930737337562887,-6.94251450533924,-6.954196310386875,-6.965784284662087,-6.977279923499917,-6.9886846867721655,-7.0};
#endif