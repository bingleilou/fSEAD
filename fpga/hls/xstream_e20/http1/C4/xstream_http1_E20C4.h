#ifndef XSTREAM_GENERATOR_1_H_
#define XSTREAM_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void xstream_http1_c4(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_xstream
);
    
#define ENSEMBLE 140
#define DIM_MAX 3
#define BATCH_SIZE 128
#define K_NUM 20
#define HASH_NUM 2
#define MATRIX_COL 128
const static param_t bottom_xstream = -7.964051379979506;
const static param_t delta_xstream = 0.1435945752604345;

static param_t xstream_fs[20][2] = {{14,8},
{1,0},
{18,14},
{3,9},
{10,10},
{13,15},
{9,3},
{2,2},
{17,9},
{1,11},
{6,19},
{6,1},
{6,12},
{12,9},
{8,9},
{10,6},
{19,3},
{1,7},
{4,10},
{8,8}};

static param_t xstream_R_T[3][20] = {{0.0,0.0,0.38729833462074165,-0.38729833462074165,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.0,0.0,0.0,0.38729833462074165,0.38729833462074165,0.0,-0.38729833462074165,0.0,0.0,0.0},
{0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.0,0.38729833462074165,0.0,-0.38729833462074165,0.0,-0.38729833462074165,-0.38729833462074165,0.38729833462074165,0.0,0.38729833462074165},
{-0.38729833462074165,0.0,0.0,0.0,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.38729833462074165,-0.38729833462074165,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,-0.38729833462074165}};

static param_t xstream_deltamax[20] = {0.2779276393653878,1.0,0.2774557911045441,0.4964907665775345,1.0,1.0,0.2774557911045441,0.2779276393653878,1.0,1.0,0.2779276393653878,0.20501063765127978,1.0,0.2981485530810293,0.4964907665775345,0.20501063765127978,0.2774557911045441,0.39093570056855725,1.0,0.20501063765127978};

static param_t xstream_shift_deltamax[20][20] = {{-0.016313632049869353,-0.6309954304151362,-0.2475483313187713,-0.569978709859351,-0.6850295650363082,-0.9696542312487075,-0.31914830192522536,-0.06900598983469142,-0.9853502491587136,-0.8710327746632461,-0.7437495000881221,-0.8048703339177811,-0.2602468082047713,-0.43191269736062304,-0.7880705236447564,-0.9865745290175562,-0.4197671925422254,-0.7794249346669049,-0.3571760414502422,-0.6449525341953476},
{-0.1540405931394041,-0.7496889990573242,-0.9583340457407523,-0.7087634828897366,-0.04010612010729819,-0.4295755311709303,-0.6853205770451923,-0.3065416430531588,-0.7827820795370071,-0.9163483632307056,-0.05220742250927046,-0.3408686931114504,-0.770300263545844,-0.8045608964440055,-0.7635166809861239,-0.586236599605454,-0.4961175806489021,-0.24997587340290706,-0.014539007862854114,-0.8465486960482212},
{-0.7516965816630735,-0.31237031065763754,-0.7687400901884298,-0.08222192517130744,-0.022810957573218715,-0.4114817722346946,-0.13546159442322747,-0.06842681713794052,-0.14777291769260215,-0.6838982603100198,-0.5242733161730342,-0.7416787862807184,-0.5935439642793925,-0.4646736964948555,-0.3491687778664482,-0.32282466538358245,-0.27197289770741595,-0.8974166121770053,-0.9541372800016628,-0.9399761173434169},
{-0.28717870750791497,-0.5714722087034402,-0.3998958651611822,-0.17657050443211253,-0.3096559341354075,-0.8571885697554366,-0.517416558332718,-0.9304013258314453,-0.321719744547992,-0.547842442740996,-0.9696375880560416,-0.19279112105414875,-0.15750385439823256,-0.9284314686777816,-0.4369825047862309,-0.5952065449286715,-0.14200493439107365,-0.4100500259947717,-0.4588395346349565,-0.1820921700541268},
{-0.28938219218907,-0.8430345972349277,-0.4111377031262827,-0.39046089262711403,-0.4094376347747726,-0.24374333965808492,-0.007423090857725745,-0.5602454294578011,-0.7018166910914171,-0.7667172790967356,-0.803978619007127,-0.05807274782022775,-0.8660581023282129,-0.8668103912920821,-0.1727921254743776,-0.14395495803490477,-0.8066833698141814,-0.0633394436630359,-0.3291639997106156,-0.7987891754553649},
{-0.8805454014373973,-0.7493158271336776,-0.6694220912313846,-0.3187853756880443,-0.8204519714523748,-0.38392041733488136,-0.607498793498184,-0.7876920549048329,-0.949061185386261,-0.2321877264014519,-0.0878460401634934,-0.5510810666462896,-0.5864403925683893,-0.20656060580050684,-0.40119420664697714,-0.36293235487437603,-0.7291538409349717,-0.17001522858620666,-0.6020207126885417,-0.17921089012828983},
{-0.782241051482457,-0.2213504844194848,-0.9215944545598914,-0.003064364704336353,-0.611632944557892,-0.9241779029048491,-0.5682273288178935,-0.8023238704820779,-0.8110411477792201,-0.2614259084112065,-0.9046851036580247,-0.3503341355604028,-0.7829995850590654,-0.20291841884659567,-0.9825822982877658,-0.5382999851307457,-0.11795818056081042,-0.5341863887884329,-0.1719525473150556,-0.923210187499732},
{-0.02151209786504893,-0.3328549684745348,-0.931162369029636,-0.5837793912937541,-0.4088811779531204,-0.34584307868762754,-0.7842676194874297,-0.05435626899634716,-0.0026807646170544652,-0.6662354640437284,-0.4645923550179595,-0.7813548904894698,-0.7394789956350342,-0.35327633167330763,-0.5721778969869142,-0.910857092822199,-0.04803444686742686,-0.8582199964504028,-0.20573834198492102,-0.9774032792688946},
{-0.946173145367849,-0.4745731918090381,-0.04397321858316383,-0.7231374490665629,-0.018918957795843405,-0.7260600876985573,-0.1936700904849078,-0.9320691660061765,-0.5287523398723702,-0.2405415461395327,-0.9776560890381816,-0.4426358714865395,-0.12811763301948065,-0.8493684500540805,-0.5474904764445873,-0.3062045947018128,-0.7691041960692607,-0.21807225157178414,-0.3228942917750379,-0.6089660488400623},
{-0.9284529519038336,-0.9824271124219979,-0.9324162748005705,-0.5033034950454675,-0.2700050084018524,-0.10846004754192184,-0.4020848674196288,-0.711882255904474,-0.4590930986682773,-0.5298079823642532,-0.6233228347296346,-0.27365135919229444,-0.5862468429056933,-0.41675986027189327,-0.6147334500549761,-0.18444391697887974,-0.6629799779113442,-0.8948089655975645,-0.706365182606825,-0.7407540510174925},
{-0.15592687339177935,-0.8300144265004826,-0.11543059723599403,-0.44860239186910056,-0.5028377304700148,-0.36892952875713547,-0.13962716876601955,-0.7304221397558115,-0.14206719469546614,-0.07302580228513367,-0.08168650040026992,-0.03525292427440074,-0.33426650986243767,-0.5970243805720782,-0.979641414209577,-0.052604627535074784,-0.23193060687218844,-0.632782550641364,-0.15327427554675643,-0.7110618977738815},
{-0.6911958035187015,-0.545661400314849,-0.7470890862444427,-0.5846498701676022,-0.826832945878982,-0.7079499393812531,-0.6997957297919992,-0.8765049385609461,-0.8577328512513182,-0.09784856814024123,-0.5802937553121483,-0.6117344262454428,-0.5436374794143832,-0.3419887033905745,-0.6837225677987847,-0.5763619072337348,-0.7449043826050961,-0.3814500285208581,-0.8373817392851958,-0.518390400915862},
{-0.7926659270944001,-0.3731510376431686,-0.7914882887686474,-0.5981709331554947,-0.024688399224682578,-0.903607777703178,-0.4083243705023501,-0.9444351364894066,-0.11770933482644164,-0.9698178584955931,-0.5622696149711344,-0.35145288211872394,-0.4116992808971406,-0.7889906682617782,-0.3459697278140419,-0.7812015565285398,-0.9864410057405368,-0.39690153889040347,-0.5407344378431165,-0.6563838868414565},
{-0.597242996621055,-0.9240949264547906,-0.6885833390442225,-0.46347179033952335,-0.433783535596889,-0.5059672201341183,-0.6356297771010796,-0.2700110682050877,-0.5031929676241895,-0.1224069374126946,-0.9573669119841165,-0.8117674719125272,-0.4991672842184406,-0.09345755694565805,-0.6362372090739404,-0.03639570628388622,-0.3494738319807833,-0.8746026813667467,-0.46574415880221076,-0.12380300340669104},
{-0.023432421105488817,-0.4894252469519902,-0.978110337181008,-0.649503797927729,-0.7272809453541369,-0.10815824781707051,-0.12088596851129729,-0.34723562643241845,-0.3825248516745565,-0.5102462794067693,-0.5127035523663315,-0.515701906973734,-0.3519218742942709,-0.5160985356530158,-0.04724312357725624,-0.3344023263178202,-0.490508028721695,-0.7677623853356994,-0.7063407770279606,-0.3112206871369252},
{-0.5091731383473317,-0.5786004282305796,-0.20073380470303193,-0.13047134308924935,-0.770042175004081,-0.8590952651081982,-0.6137980955576735,-0.4326942137230858,-0.10629619504508303,-0.4386000381427084,-0.49523609068151764,-0.39257131297322867,-0.11107996028868317,-0.41246328857487413,-0.8988761022747782,-0.3352702412372949,-0.5148645407625507,-0.2819714410633998,-0.8536486404617621,-0.2305937099004396},
{-0.28461544313052745,-0.10981810295354144,-0.01341347226727807,-0.12599480169210175,-0.33351981045076684,-0.555346865183026,-0.6837652139782181,-0.8574917431209425,-0.10552934339793918,-0.9179781876814989,-0.903027024744022,-0.34141084667303545,-0.5716867335047855,-0.4461507930918176,-0.40914918001149114,-0.43311968052201777,-0.5434935688140262,-0.9465263357314856,-0.30288899574473205,-0.5785147441790691},
{-0.5132261975299492,-0.7270516185667728,-0.5154101299028522,-0.31942890236427246,-0.4069077614323543,-0.7460858855293105,-0.3165060364864063,-0.48211305468085464,-0.738565796123301,-0.8224388680452764,-0.2879682736818058,-0.7924913382746049,-0.7007214552746176,-0.17806788118430383,-0.6768542731637971,-0.9759597118192961,-0.8767577003323019,-0.45356384517095794,-0.896494162534214,-0.3514347458546456},
{-0.9756732334839084,-0.15540793245007145,-0.7011016777202397,-0.17228459683793806,-0.4894964653767856,-0.77252779217914,-0.22284391615271437,-0.8959155151624089,-0.3610908435840523,-0.1425018053402335,-0.4893907454041378,-0.27565736339926705,-0.3782169819156883,-0.4844550352431821,-0.7193149461567525,-0.4832844451574732,-0.25220629443776177,-0.7446580277081736,-0.49955792812500643,-0.3103995003212945},
{-0.17889661853970448,-0.630853259405712,-0.27910591092990733,-0.1718886087017104,-0.25709022603996257,-0.47922807075295804,-0.07026769403099875,-0.9651511798592196,-0.8540508454918587,-0.8051389482221416,-0.7870059475638782,-0.25352281094103724,-0.8623413322809605,-0.351280564355598,-0.3923899837432464,-0.4061389766891762,-0.9167669781544098,-0.36764431099959727,-0.7427456669107794,-0.2511294185323636}};

static param_t xstream_shift[20][20] = {{0.05869740802720969,0.6309954304151362,0.892208197685433,1.1480147229894964,0.6850295650363082,0.9696542312487075,1.150267221508351,0.24828761181240475,0.9853502491587136,0.8710327746632461,2.6760544643432334,3.925993027185517,0.2602468082047713,1.4486493155753803,1.5872813286683496,4.812308962697368,1.5129155923224502,1.9937420233899037,0.3571760414502422,3.1459466766422275},
{0.5542471180309239,0.7496889990573242,3.4540062830393627,1.427546151110652,0.04010612010729819,0.4295755311709303,2.4700172028017486,1.10295486894757,0.7827820795370071,0.9163483632307056,0.18784537812964353,1.6626878342345497,0.770300263545844,2.698523565282392,1.5378265466028345,2.8595423453227546,1.7880959653927972,0.639429637762309,0.014539007862854114,4.129291561388091},
{2.7046485314647963,0.31237031065763754,2.770675959323451,0.1656061516271265,0.022810957573218715,0.4114817722346946,0.48822767001531475,0.24620371437034622,0.14777291769260215,0.6838982603100198,1.886366240400362,3.6177575699379245,0.5935439642793925,1.5585307783417917,0.7032734571749991,1.574672753970468,0.9802386773932492,2.295560653252818,0.9541372800016628,4.585011432149697},
{1.0332858875196826,0.5714722087034402,1.4412957955182966,0.35563703560746557,0.3096559341354075,0.8571885697554366,1.864861267710061,3.347638716163307,0.321719744547992,0.547842442740996,3.488813096351572,0.9403956948911292,0.15750385439823256,3.1139895165798683,0.8801422588349174,2.903295905752508,0.5118110305997067,1.0488937832958605,0.4588395346349565,0.8882083980630461},
{1.0412141550579037,0.8430345972349277,1.4818133782306524,0.7864413981325022,0.4094376347747726,0.24374333965808492,0.026754139202409932,2.0157960206370618,0.7018166910914171,0.7667172790967356,2.892762378160407,0.2832669976814017,0.8660581023282129,2.90731040729386,0.3480268659687018,0.7021828705287485,2.9074302850295406,0.16202010604536293,0.3291639997106156,3.8963303787879244},
{3.16825416661693,0.7493158271336776,2.4127162333373295,0.6420771485551106,0.8204519714523748,0.38392041733488136,2.1895336589650825,2.83416236220128,0.949061185386261,0.2321877264014519,0.31607522146440203,2.6880608389876373,0.5864403925683893,0.6928110288174663,0.8080597538853215,1.7703098679772844,2.628000078975572,0.4348930740757241,0.6020207126885417,0.8741541033257262},
{2.8145493311446264,0.2213504844194848,3.3215902644924022,0.006172047720967649,0.611632944557892,0.9241779029048491,2.0479923181844417,2.8868084956000843,0.8110411477792201,0.2614259084112065,3.255110235612973,1.7088583283971648,0.7829995850590654,0.6805950146316744,1.9790545251445693,2.6257173349530594,0.4251422545235839,1.3664303055759275,0.1719525473150556,4.503230652206934},
{0.07740179391358504,0.3328549684745348,3.3560747293206727,1.1758111743304458,0.4088811779531204,0.34584307868762754,2.826639935556152,0.19557705423060026,0.0026807646170544652,0.6662354640437284,1.671630630472006,3.8112894991261066,0.7394789956350342,1.1849003727255922,1.1524441852788414,4.442974780516288,0.17312468655349744,2.195297065993847,0.20573834198492102,4.76757348041346},
{3.404386650886232,0.4745731918090381,0.15848729777132284,1.4564972759742836,0.018918957795843405,0.7260600876985573,0.6980214387088924,3.353639703249512,0.5287523398723702,0.2405415461395327,3.5176641347025948,2.159087335943303,0.12811763301948065,2.8488095658248707,1.1027203591692343,1.49360344521567,2.7719882616523424,0.5578212766309928,0.3228942917750379,2.9704119543099274},
{3.340628352127328,0.9824271124219979,3.3605940286510014,1.013721762672235,0.2700050084018524,0.10846004754192184,1.4491853488404032,2.561394244667303,0.4590930986682773,0.5298079823642532,2.2427522363479664,1.3348154141043722,0.5862468429056933,1.3978262043036929,1.2381568630017539,0.8996797390222074,2.3894977115887133,2.2888903834983587,0.706365182606825,3.6132469002779493},
{0.5610340653697431,0.8300144265004826,0.41603239484195986,0.9035462934415811,0.5028377304700148,0.36892952875713547,0.5032411405441116,2.6281018376712626,0.14206719469546614,0.07302580228513367,0.29391283496233267,0.17195656127056916,0.33426650986243767,2.0024393021616373,1.9731311842162753,0.2565946242484964,0.8359191421050499,1.6186358772582725,0.15327427554675643,3.4684146438458856},
{2.4869631717700287,0.545661400314849,2.692641891777789,1.1775644372961371,0.826832945878982,0.7079499393812531,2.522188226838341,3.153716343442247,0.8577328512513182,0.09784856814024123,2.087931076726212,2.9839155336221843,0.5436374794143832,1.1470412982270304,1.3771103388526182,2.811375613660196,2.6847678314431698,0.9757359790013967,0.8373817392851958,2.52860245134029},
{2.85205864700737,0.3731510376431686,2.852664511408299,1.2047976990163851,0.024688399224682578,0.903607777703178,1.4716736272716517,3.3981331926752714,0.11770933482644164,0.9698178584955931,2.023079159219303,1.714315345511682,0.4116992808971406,2.646300510629513,0.6968301348259082,3.8105415673958962,3.555308764014409,1.015260408075215,0.5407344378431165,3.201706479046011},
{2.1489154442673746,0.9240949264547906,2.48177677713264,0.93349528639652,0.433783535596889,0.5059672201341183,2.290922725276897,0.9715157111456185,0.5031929676241895,0.1224069374126946,3.4446624818249147,3.9596358570101726,0.4991672842184406,0.31345970315763577,1.281468361354878,0.1775308184046274,1.2595658234039278,2.2372034073500284,0.46574415880221076,0.6038857535640575},
{0.08431122992658721,0.4894252469519902,3.5252835534164806,1.3081890775229539,0.7272809453541369,0.10815824781707051,0.4356945228284963,1.2493742156242056,0.3825248516745565,0.5102462794067693,1.8447375494464116,2.515488527238941,0.3519218742942709,1.731011371075657,0.09515408293072157,1.6311462183081145,1.7678781429250245,1.9639096255959851,0.7063407770279606,1.5180709191603374},
{1.8320349120726656,0.5786004282305796,0.723480320608613,0.2627870483647238,0.770042175004081,0.8590952651081982,2.212237463540262,1.5568592411718667,0.10629619504508303,0.4386000381427084,1.7818885945000862,1.9148826493627464,0.11107996028868317,1.3834153622834353,1.8104588499621275,1.6353797299415498,1.8556633426640283,0.7212731931448437,0.8536486404617621,1.1247889989624649},
{1.02406311146459,0.10981810295354144,0.048344538832220424,0.2537706845197206,0.33351981045076684,0.555346865183026,2.4644113977804065,3.0853057474920997,0.10552934339793918,0.9179781876814989,3.249144370117232,1.6653323485280336,0.5716867335047855,1.4964043544110879,0.8240821532933711,2.1126693008913433,1.9588474497158368,2.4211816274515354,0.30288899574473205,2.82187671238365},
{1.846618057498116,0.7270516185667728,1.8576297429259565,0.6433732988957587,0.4069077614323543,0.7460858855293105,1.1407440270985305,1.7346711387960483,0.738565796123301,0.8224388680452764,1.0361267930722706,3.8656108158768894,0.7007214552746176,0.5972454984073308,1.3632766583547251,4.760532053362957,3.1599906307305856,1.160200627651344,0.896494162534214,1.7142268805213474},
{3.5105297037449517,0.15540793245007145,2.5268950953561737,0.3470046341960183,0.4894964653767856,0.77252779217914,0.8031690932295148,3.2235567401936613,0.3610908435840523,0.1425018053402335,1.760856698245626,1.344600292732889,0.3782169819156883,1.6248780355862382,1.4487982346886619,2.357362772460292,0.9089963249054389,1.9048094779401838,0.49955792812500643,1.5140653376693538},
{0.6436805599766617,0.630853259405712,1.0059473252253779,0.3462070601767524,0.25709022603996257,0.47922807075295804,0.25325726217955274,3.472670735674289,0.8540508454918587,0.8051389482221416,2.831693707617226,1.2366324686637773,0.8623413322809605,1.1782065038569172,0.7903268502818548,1.9810629406460991,3.304191181250119,0.9404214311072482,0.7427456669107794,1.2249579895436022}};

const static score_t log_LUT_xstream_d0[128] = {1.0,2.0,2.584962500721156,3.0,3.321928094887362,3.584962500721156,3.807354922057604,4.0,4.169925001442312,4.321928094887362,4.459431618637297,4.584962500721156,4.700439718141093,4.807354922057604,4.906890595608519,5.0,5.087462841250339,5.169925001442312,5.247927513443585,5.321928094887363,5.392317422778761,5.459431618637297,5.523561956057013,5.584962500721156,5.643856189774724,5.700439718141092,5.754887502163468,5.807354922057604,5.857980995127572,5.906890595608519,5.954196310386875,6.0,6.044394119358453,6.087462841250339,6.129283016944966,6.169925001442312,6.20945336562895,6.247927513443585,6.285402218862249,6.321928094887363,6.357552004618084,6.392317422778761,6.426264754702098,6.459431618637297,6.491853096329675,6.523561956057013,6.554588851677638,6.584962500721156,6.614709844115208,6.643856189774724,6.672425341971495,6.700439718141092,6.727920454563199,6.754887502163468,6.78135971352466,6.807354922057604,6.832890014164741,6.857980995127572,6.882643049361842,6.906890595608519,6.930737337562887,6.954196310386875,6.977279923499917,7.0,7.022367813028454,7.044394119358453,7.066089190457772,7.087462841250339,7.108524456778169,7.129283016944966,7.149747119504682,7.169925001442312,7.189824558880018,7.20945336562895,7.22881869049588,7.247927513443585,7.266786540694901,7.285402218862249,7.303780748177103,7.321928094887363,7.339850002884624,7.357552004618084,7.3750394313469245,7.392317422778761,7.409390936137702,7.426264754702098,7.442943495848728,7.459431618637297,7.475733430966398,7.491853096329675,7.507794640198696,7.523561956057013,7.539158811108031,7.554588851677638,7.569855608330948,7.584962500721156,7.599912842187128,7.614709844115208,7.6293566200796095,7.643856189774724,7.658211482751795,7.672425341971495,7.6865005271832185,7.700439718141092,7.714245517666122,7.727920454563199,7.7414669864011465,7.754887502163468,7.768184324776926,7.78135971352466,7.794415866350106,7.807354922057604,7.820178962415188,7.832890014164741,7.845490050944375,7.857980995127572,7.870364719583405,7.882643049361842,7.894817763307944,7.906890595608519,7.918863237274595,7.930737337562887,7.94251450533924,7.954196310386875,7.965784284662087,7.977279923499917,7.9886846867721655,8.0};
#endif