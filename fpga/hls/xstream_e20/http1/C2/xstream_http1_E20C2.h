#ifndef XSTREAM_GENERATOR_1_H_
#define XSTREAM_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void xstream_http1_c2(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_xstream
);
    
#define ENSEMBLE 140
#define DIM_MAX 3
#define BATCH_SIZE 128
#define K_NUM 20
#define HASH_NUM 2
#define MATRIX_COL 128
const static param_t bottom_xstream = -7.964051379979506;
const static param_t delta_xstream = 0.1435945752604345;

static param_t xstream_fs[20][2] = {{4,1},
{3,3},
{7,5},
{7,14},
{10,17},
{6,4},
{19,0},
{14,6},
{4,5},
{18,11},
{0,14},
{4,16},
{19,15},
{19,8},
{0,8},
{6,18},
{1,2},
{5,3},
{5,18},
{8,11}};

static param_t xstream_R_T[3][20] = {{0.0,0.0,0.38729833462074165,-0.38729833462074165,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.0,0.0,0.0,0.38729833462074165,0.38729833462074165,0.0,-0.38729833462074165,0.0,0.0,0.0},
{0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,0.0,0.38729833462074165,0.0,-0.38729833462074165,0.0,-0.38729833462074165,-0.38729833462074165,0.38729833462074165,0.0,0.38729833462074165},
{-0.38729833462074165,0.0,0.0,0.0,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.38729833462074165,-0.38729833462074165,0.0,0.0,0.0,0.38729833462074165,0.0,0.0,0.0,-0.38729833462074165}};

static param_t xstream_deltamax[20] = {0.2779276393653878,1.0,0.2774557911045441,0.4964907665775345,1.0,1.0,0.2774557911045441,0.2779276393653878,1.0,1.0,0.2779276393653878,0.20501063765127978,1.0,0.2981485530810293,0.4964907665775345,0.20501063765127978,0.2774557911045441,0.39093570056855725,1.0,0.20501063765127978};

static param_t xstream_shift_deltamax[20][20] = {{-0.597196051440444,-0.21670290276839643,-0.07966290645739804,-0.6645805850178792,-0.3119621536274023,-0.2652920810366607,-0.20323339807736673,-0.2283944426653417,-0.8806553872373684,-0.39396390777576007,-0.3748233852180347,-0.6869738948052033,-0.6442696963801896,-0.5076852446941322,-0.08143834760942192,-0.5392068447125496,-0.9225431756858113,-0.7329451034958427,-0.46070045851995134,-0.44710306751717427},
{-0.7224305533030247,-0.33970631901804926,-0.2805858151782249,-0.03395788164165381,-0.7456942007269263,-0.6803419194702898,-0.8748316486820128,-0.7956655622896143,-0.8085722010596135,-0.34624093782631127,-0.7089872742326342,-0.46734160201695474,-0.11968604403225591,-0.4565088590274224,-0.22896359841468716,-0.6795977726794721,-0.0821709746189716,-0.7439819936661448,-0.4049155897521084,-0.29278368855333303},
{-0.08202793741879377,-0.17162611337616873,-0.7924988504980953,-0.504391066656161,-0.311488043814274,-0.810586616476846,-0.7055053918675812,-0.42316351554779175,-0.6777128593723627,-0.9373150917721479,-0.5994399155840626,-0.20827916434891772,-0.35198111080091266,-0.4801562098122696,-0.9706741613274797,-0.3299826055038958,-0.6408966213717705,-0.697822897801907,-0.1995501013281381,-0.38566025364631495},
{-0.24990019699190158,-0.10030786840671702,-0.496706353510626,-0.41039188686707706,-0.4161333030713079,-0.10634211968999041,-0.6064021429099341,-0.33446098526672796,-0.5159892926523173,-0.24146522728821684,-0.12132531408724889,-0.37471973696048755,-0.3619984345072842,-0.2797701488247989,-0.9947322840457188,-0.10515328387770884,-0.8729223678798432,-0.7719693423495557,-0.03212693345466977,-0.6763013403624132},
{-0.1736449928348257,-0.09594290776829606,-0.9183669800183916,-0.7793447208666727,-0.7376933189771506,-0.8682425328717965,-0.7180781932044829,-0.08006685125872604,-0.09105432306796712,-0.8368862380705551,-0.7638694803100008,-0.8385731142275283,-0.5126999082234563,-0.817768818430773,-0.7706556335560601,-0.45159927245129605,-0.9804082020341439,-0.08866120546551903,-0.07702464317203483,-0.008123073420109872},
{-0.6782830354011081,-0.6650953826962229,-0.9817662479130512,-0.16641023998477789,-0.541819279048254,-0.8760508188978622,-0.2760248838248547,-0.19880298530590879,-0.09577934616300188,-0.5855917108517734,-0.9013370664314487,-0.9214550094074123,-0.4028553860428269,-0.17962191862741325,-0.95431668787624,-0.8379522214940001,-0.8571831394067616,-0.22620047499707452,-0.8415775061261958,-0.5513978424253473},
{-0.03328937329781145,-0.8715772926554242,-0.8831771242030628,-0.018584492398475372,-0.5310448466234616,-0.8152569744311887,-0.735614810221034,-0.48113222949750023,-0.4242350567393406,-0.07899994221214668,-0.056254140377286814,-0.3751779403564246,-0.03782247886695067,-0.37057782164661046,-0.6535960997870346,-0.10944453301275991,-0.1386102160278151,-0.09972190423485684,-0.10038097711302607,-0.7648989048315272},
{-0.2841635648524746,-0.883416816736594,-0.14915512776753515,-0.40290762545828274,-0.8780643305042706,-0.9592790783556465,-0.10364208342258495,-0.43582162437688776,-0.8742217757793564,-0.498653718181403,-0.6585458165407841,-0.6167921023468284,-0.6957000294702672,-0.9079069333665306,-0.6408850444735552,-0.9431934427759192,-0.897479415652864,-0.6440090879122626,-0.1431492303154469,-0.5399810798784592},
{-0.17237053384861223,-0.5848007440927281,-0.892703028630644,-0.2633490018821535,-0.742643039502783,-0.6681939625324567,-0.37200912067869163,-0.46643656963222935,-0.6616881487087098,-0.22955752413616148,-0.6578943571759446,-0.33071676783340065,-0.6295150477007646,-0.9200465756069094,-0.7707461037649267,-0.09736241181901817,-0.6475475516804751,-0.003626097725474397,-0.5010367895874145,-0.8622656216739268},
{-0.6887693657026388,-0.38790692659057735,-0.8854576376547338,-0.794518654347975,-0.44279943464073623,-0.16712194540618253,-0.455493426752402,-0.36277107672925946,-0.3096293609871148,-0.9149432434986198,-0.14845330953594482,-0.7320662692115547,-0.5079657921373534,-0.8387633199863345,-0.26029938035449973,-0.8878848387943689,-0.6507258312380895,-0.9315914218551857,-0.9866794276015793,-0.24362484545365717},
{-0.8412555763619356,-0.04179870146805986,-0.4686198030106357,-0.4504483935042969,-0.5451196650988573,-0.32637606534924846,-0.14141689096871493,-0.7256502537343823,-0.625176797924239,-0.03978541758729304,-0.7208441379841456,-0.30905111772578087,-0.41273043576458646,-0.340624976668249,-0.7478370892386409,-0.11219756793083556,-0.7720707565681101,-0.79602190098142,-0.158624831401728,-0.8262835255075605},
{-0.9967261539042159,-0.1019088375722802,-0.1646528722787678,-0.7683417849874887,-0.8802101123786858,-0.43165353912341653,-0.7124206021288674,-0.765852377754816,-0.5094199529601806,-0.7670325391237979,-0.5363311172716396,-0.012053190793197333,-0.42303548809611213,-0.9843648500219592,-0.32531530494511296,-0.2886255918967765,-0.7986988636062881,-0.9530214119397407,-0.7346954957837053,-0.2001663015975257},
{-0.9758307520147576,-0.7533226771416798,-0.1866740201280871,-0.9642073581388433,-0.20804188216088282,-0.9249513930985538,-0.423591128720049,-0.16454196366134133,-0.5266050957129303,-0.5242964051909103,-0.9030323068166822,-0.282709796607992,-0.7969470470830137,-0.21483184197914973,-0.4320872535042859,-0.739932355996454,-0.9945410077283895,-0.5650731441946591,-0.18394583935247577,-0.2114763736138686},
{-0.5785729448533772,-0.4271590347228569,-0.42827603335167946,-0.5140082649206121,-0.3588673145868916,-0.13280483985320257,-0.3572724095056561,-0.25454221493956397,-0.15151822936129367,-0.8296842835788661,-0.20767533709477073,-0.4062755452586433,-0.033295722297394525,-0.5275774991139359,-0.4509748308181861,-0.8063067617064678,-0.29757917127026834,-0.3590050631727756,-0.1861670163214515,-0.13254669340106962},
{-0.8634776277825896,-0.35487848206016315,-0.07085615438768089,-0.39155062490497716,-0.02157369019847888,-0.04445822533079291,-0.5725505854519699,-0.19486163636519294,-0.19146460134135201,-0.2670343919186279,-0.9194830652785825,-0.23763004926107378,-0.15020779504033777,-0.24540398814487052,-0.12470751718845863,-0.6444486467164002,-0.4060657902223278,-0.16482390804842084,-0.025422400048897176,-0.7979369977143371},
{-0.8145250595571416,-0.7556131743839234,-0.10072526408536264,-0.3943498676253544,-0.9947700970758689,-0.07687682647695593,-0.14616142716591884,-0.7201904003373494,-0.6639089484282061,-0.03636032600455519,-0.9637376875077839,-0.7766902679577894,-0.09467241012249628,-0.42834030633083575,-0.7323127508476259,-0.06948338893786365,-0.47413248565513516,-0.3281484887895427,-0.8863115410759234,-0.298136103949464},
{-0.6896051325369912,-0.3966053305380064,-0.6044010849156362,-0.4189684112771729,-0.2400125958237801,-0.4458935647406457,-0.9028559968537698,-0.1729889658707736,-0.7258506133823891,-0.09757734457632727,-0.8266214091563269,-0.08458901336866198,-0.289909404103857,-0.7060210310687699,-0.22593182935068257,-0.05525558545707443,-0.8030536837440682,-0.8890577929490846,-0.5050187722680403,-0.9869608417509422},
{-0.03242207896302096,-0.9808160131534294,-0.22799631138592058,-0.1420394939676024,-0.8774326823166757,-0.804905030944593,-0.5813104358809124,-0.8295294119403838,-0.26808030595363397,-0.9923707381144051,-0.1618790207538371,-0.15447464678045464,-0.5114974496682538,-0.8165839737369383,-0.9039286585180583,-0.9221743922906546,-0.531598104313566,-0.4733523748904311,-0.14322700896073615,-0.9564313950435102},
{-0.18922055583476793,-0.24553238112968168,-0.05680949885154951,-0.1764703906891295,-0.19744628113159224,-0.5505983358579654,-0.99093873276819,-0.9709709220376628,-0.6933982415472552,-0.026343888291147866,-0.4299221770324515,-0.4992318938952207,-0.7920859941266816,-0.20544717162153636,-0.7839149392921699,-0.294848631717446,-0.35800922330573237,-0.7602443638927938,-0.5086323483746598,-0.7468707962026434},
{-0.27104325662940476,-0.7481914236479312,-0.9526627089698098,-0.8143952589804128,-0.613906615891596,-0.815045263147333,-0.6566111187600494,-0.05961148299024732,-0.1469379706325713,-0.24609195441287934,-0.11931158509187567,-0.6661975486601263,-0.905155265678828,-0.454341094210383,-0.6622873352715076,-0.22417219103299366,-0.9786395224231593,-0.040118057128130435,-0.018351588368014538,-0.2080615431004308}};

static param_t xstream_shift[20][20] = {{2.148746532745231,0.21670290276839643,0.2871192781389141,1.3385557793935225,0.3119621536274023,0.2652920810366607,0.7324892995323687,0.821776643686289,0.8806553872373684,0.39396390777576007,1.3486365950284613,3.350918287341442,0.6442696963801896,1.7027929179859416,0.164027919735148,2.6301408106916524,3.3250096241033265,1.8748482229427608,0.46070045851995134,2.180877405384643},
{2.599347639380533,0.33970631901804926,1.0112811632484593,0.06839579691629728,0.7456942007269263,0.6803419194702898,3.1530487981502615,2.8628515109415344,0.8085722010596135,0.34624093782631127,2.550977930268166,2.2795968412717014,0.11968604403225591,1.5311456463897537,0.46116386009150695,3.314939070798162,0.2961588017026105,1.9030802062439802,0.4049155897521084,1.4281390073589937},
{0.29514134544550547,0.17162611337616873,2.8563067555489776,1.0159122799666258,0.311488043814274,0.810586616476846,2.5427668640794376,1.522567228340555,0.6777128593723627,0.9373150917721479,2.1568200879653676,1.0159432053628243,0.35198111080091266,1.6104596344687785,1.9550699160402096,1.6095877232731288,2.309905368420598,1.785006835617797,0.1995501013281381,1.8811719141243668},
{0.8991556131751298,0.10030786840671702,1.7902180074643648,0.8265851340922937,0.4161333030713079,0.10634211968999041,2.1855811352715446,1.2034103050363283,0.5159892926523173,0.24146522728821684,0.4365356189988147,1.8278063092407943,0.3619984345072842,0.9383582309345114,2.003526250654606,0.5129162324570352,3.146167410688249,1.9746708761232148,0.03212693345466977,3.298859747525844},
{0.6247849016791631,0.09594290776829606,3.3099578724322063,1.5697063738746615,0.7376933189771506,0.8682425328717965,2.5880814754157146,0.2880852420491479,0.09105432306796712,0.8368862380705551,2.748447337062982,4.090388302942257,0.5126999082234563,2.7428233676804865,1.5522053690311897,2.202808974329713,3.533565466884526,0.22679229688302865,0.07702464317203483,0.0396226923303712},
{2.4405022722816656,0.6650953826962229,3.538460105679056,0.3351728797131425,0.541819279048254,0.8760508188978622,0.9948427557630244,0.7153048389136467,0.09577934616300188,0.5855917108517734,3.2430638006696157,4.494669252113612,0.4028553860428269,0.6024577908268317,1.922123737475809,4.087359715057055,3.089440432994166,0.5786129910061933,0.8415775061261958,2.6896060065100977},
{0.1197771239083075,0.8715772926554242,3.1831273756700416,0.037431697927806526,0.5310448466234616,0.8152569744311887,2.651286560978133,1.731142072073523,0.4242350567393406,0.07899994221214668,0.20240570713202888,1.8300413317800466,0.03782247886695067,1.242930136058372,1.316431530625385,0.5338480688934958,0.4995758620716169,0.25508518175706724,0.10038097711302607,3.731020563589532},
{1.0224372268311486,0.883416816736594,0.5375815987612028,0.8115108126494486,0.8780643305042706,0.9592790783556465,0.3735444951788124,1.5681118487244763,0.8742217757793564,0.498653718181403,2.369486597462884,3.008585844194012,0.6957000294702672,3.0451495537521,1.2908297346421473,4.600704888203304,3.234675376859219,1.6473529712831245,0.1431492303154469,2.6339173716290736},
{0.6201993232562198,0.5848007440927281,3.2174604288373905,0.5304207441711357,0.742643039502783,0.6681939625324567,1.3407870104196897,1.6782662231697345,0.6616881487087098,0.22955752413616148,2.3671426083356164,1.6131688171027752,0.6295150477007646,3.0858663109354882,1.5523875883491645,0.4749139504879267,2.3338765037219282,0.009275432558860148,0.5010367895874145,4.205955513101855},
{2.478232705733606,0.38790692659057735,3.1913467516023024,1.6002687418032757,0.44279943464073623,0.16712194540618253,1.6416792921823502,1.3052716799149622,0.3096293609871148,0.9149432434986198,0.5341437428638582,3.570869675830135,0.5079657921373534,2.813239612665099,0.5242783912152575,4.3309208193608395,2.3453315883138255,2.3829786343389103,0.9866794276015793,1.1883522154984933},
{3.026887064139555,0.04179870146805986,1.6889890859551815,0.9072643920638805,0.5451196650988573,0.32637606534924846,0.5096916175572982,2.610932310983218,0.625176797924239,0.03978541758729304,2.59363962371681,1.5074882028876593,0.41273043576458646,1.1424673141904387,1.5062457140818848,0.5472768106876583,2.782680273114924,2.0361964891508393,0.158624831401728,4.0304422003362435},
{3.5862793501938586,0.1019088375722802,0.5934382253233537,1.5475449629887539,0.8802101123786858,0.43165353912341653,2.567690511316199,2.75558191874526,0.5094199529601806,0.7670325391237979,1.9297509182472212,0.05879300182315242,0.42303548809611213,3.301591907288021,0.6552293151141816,1.4078566615051682,2.8786527050911035,2.437795807734403,0.7346954957837053,0.9763703185880811},
{3.5110964646875074,0.7533226771416798,0.67280635731171,1.9420448939774346,0.20804188216088282,0.9249513930985538,1.5266977381648585,0.59203166708087,0.5266050957129303,0.5242964051909103,3.249163375325466,1.379000620879378,0.7969470470830137,0.7205530255273915,0.8702825562755132,3.6092388398648296,3.584502611277812,1.4454375575646972,0.18394583935247577,1.0315385388615148},
{2.081739499441202,0.4271590347228569,1.54358296738635,1.0352826266313695,0.3588673145868916,0.13280483985320257,1.2876732833125022,0.9158578668921831,0.15151822936129367,0.8296842835788661,0.7472280827087612,1.981729094222478,0.033295722297394525,1.76951219002077,0.9083247084873222,3.932999628428961,1.0725282398526035,0.9183225339887267,0.1861670163214515,0.6465356867311913},
{3.106843312720643,0.35487848206016315,0.25537817792738954,0.7886362673047428,0.02157369019847888,0.04445822533079291,2.0635741037253585,0.7011236335117104,0.19146460134135201,0.2670343919186279,3.3083541722518297,1.1591108246064732,0.15020779504033777,0.8230930038361645,0.25117791826846325,3.1434888164808226,1.4635333023895112,0.4216138557023808,0.025422400048897176,3.8921736298953267},
{2.9307090918233447,0.7556131743839234,0.363031759706215,0.7942743232542487,0.9947700970758689,0.07687682647695593,0.5267917695430111,2.591287437197006,0.6639089484282061,0.03636032600455519,3.467584907022402,3.7885364235534382,0.09467241012249628,1.436667399202248,1.4749775829582608,0.3389257734813445,1.708857774305688,0.8393924840128442,0.8863115410759234,1.4542469959855904},
{2.4812398439810317,0.3966053305380064,2.1783689664920365,0.8438594219289366,0.2400125958237801,0.4458935647406457,3.2540535314095416,0.6224244780611665,0.7258506133823891,0.09757734457632727,2.9742324694435256,0.41260792287543,0.289909404103857,2.3680176334006595,0.45505746442799133,0.26952545531351113,2.894348251111043,2.274179082790555,0.5050187722680403,4.81419331727434},
{0.11665654785919326,0.9808160131534294,0.8217392416942293,0.28608687921172204,0.8774326823166757,0.804905030944593,2.0951461620848892,2.984695634570596,0.26808030595363397,0.9923707381144051,0.5824502418092247,0.7534957627087324,0.5114974496682538,2.7388493598190005,1.8206353861303808,4.498178254824319,1.9159740807617969,1.2108190022093432,0.14322700896073615,4.665276914412542},
{0.6808266938359527,0.24553238112968168,0.20475153402058183,0.3554353928988345,0.19744628113159224,0.5505983358579654,3.571519371872864,3.493610510472261,0.6933982415472552,0.026343888291147866,1.546885290049323,2.4351511688110894,0.7920859941266816,0.689076534158799,1.57891141600868,1.4382113781772603,1.290328891246087,1.9446787867854807,0.5086323483746598,3.6430831334374956},
{0.9752295858313962,0.7481914236479312,3.4335657770100414,1.6403029296884872,0.613906615891596,0.815045263147333,2.3665432108881133,0.2144856234031366,0.1469379706325713,0.24609195441287934,0.42929010358346664,3.2495755161413573,0.905155265678828,1.5238748922819845,1.3339368621834813,1.09346614205604,3.527190831113027,0.10262060249239133,0.018351588368014538,1.0148816933799336}};

const static score_t log_LUT_xstream_d0[128] = {1.0,2.0,2.584962500721156,3.0,3.321928094887362,3.584962500721156,3.807354922057604,4.0,4.169925001442312,4.321928094887362,4.459431618637297,4.584962500721156,4.700439718141093,4.807354922057604,4.906890595608519,5.0,5.087462841250339,5.169925001442312,5.247927513443585,5.321928094887363,5.392317422778761,5.459431618637297,5.523561956057013,5.584962500721156,5.643856189774724,5.700439718141092,5.754887502163468,5.807354922057604,5.857980995127572,5.906890595608519,5.954196310386875,6.0,6.044394119358453,6.087462841250339,6.129283016944966,6.169925001442312,6.20945336562895,6.247927513443585,6.285402218862249,6.321928094887363,6.357552004618084,6.392317422778761,6.426264754702098,6.459431618637297,6.491853096329675,6.523561956057013,6.554588851677638,6.584962500721156,6.614709844115208,6.643856189774724,6.672425341971495,6.700439718141092,6.727920454563199,6.754887502163468,6.78135971352466,6.807354922057604,6.832890014164741,6.857980995127572,6.882643049361842,6.906890595608519,6.930737337562887,6.954196310386875,6.977279923499917,7.0,7.022367813028454,7.044394119358453,7.066089190457772,7.087462841250339,7.108524456778169,7.129283016944966,7.149747119504682,7.169925001442312,7.189824558880018,7.20945336562895,7.22881869049588,7.247927513443585,7.266786540694901,7.285402218862249,7.303780748177103,7.321928094887363,7.339850002884624,7.357552004618084,7.3750394313469245,7.392317422778761,7.409390936137702,7.426264754702098,7.442943495848728,7.459431618637297,7.475733430966398,7.491853096329675,7.507794640198696,7.523561956057013,7.539158811108031,7.554588851677638,7.569855608330948,7.584962500721156,7.599912842187128,7.614709844115208,7.6293566200796095,7.643856189774724,7.658211482751795,7.672425341971495,7.6865005271832185,7.700439718141092,7.714245517666122,7.727920454563199,7.7414669864011465,7.754887502163468,7.768184324776926,7.78135971352466,7.794415866350106,7.807354922057604,7.820178962415188,7.832890014164741,7.845490050944375,7.857980995127572,7.870364719583405,7.882643049361842,7.894817763307944,7.906890595608519,7.918863237274595,7.930737337562887,7.94251450533924,7.954196310386875,7.965784284662087,7.977279923499917,7.9886846867721655,8.0};
#endif