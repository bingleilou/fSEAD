#ifndef LODA_GENERATOR_1_H_
#define LODA_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void loda_cardio_c4(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_loda
);
    
#define ENSEMBLE 35
#define DIM_MAX 21
#define BATCH_SIZE 128
#define N_BINS 20
const static param_t bottom_loda = 2.580379516762855;
const static param_t delta_loda = 0.0805177582801107;
static param_t loda_min_X[35] = {-2.7769518627191414,-5.530948173901694,-3.90376487247862,-3.8981227758371393,-5.844606291465741,-6.3704593087319905,-5.53542778824397,-4.952789405387276,-4.862809475254281,-2.3935415467520715,-5.0433590232755074,-3.8266751710653715,-3.631993769093961,-5.843154786957724,-2.6113758269268437,-1.9708532491935757,-3.334582735476893,-5.559695596243101,-4.163777980957693,-2.9024933491978464,-2.600420480424758,-8.359955881261596,-4.333967636341646,-5.554906516129721,-7.142414867988044,-12.20177295010678,-3.494467653498606,-3.9696785239205146,-3.739444188164188,-3.9020018640773575,-5.777429518034069,-4.093005547861425,-3.41979442338622,-3.655771688668427,-7.786722628385592};

static param_t loda_projections[35][21] = {{-0.11597909078449548,-0.2393623329134947,0.5278421087823775,0.11848697320345297,-0.02328323407719851,-0.10397767175177829,-0.2007146982521887,0.247194347671335,-0.136581381383209,0.2807855957824469,-0.24271343724016095,0.03740919869887908,0.09350378236290975,0.049490697634592615,-0.059580352459419006,0.15287184352710617,0.11171796274153556,-0.11983838295760618,-0.4508017500338531,0.15624659497370968,-0.27103435283167554},
{0.06425619400235352,-0.09680104980624434,-0.35890633784366255,-0.39414417728363255,0.04923050850448353,-0.2685615252385186,0.21075512684815634,-0.029633027251619433,-0.3509577731943835,0.3138777676618022,0.03749061614936855,-0.25555364702740874,-0.1629588302889055,-0.12417437461695961,-0.15380603538898088,0.15241335863594466,0.18236815330978953,0.20954523004447256,-0.06216332453020388,0.2342295608881742,-0.26331086090162015},
{-0.17614802339615138,-0.27144646146637996,-0.0031891669878069966,-0.18115775388742605,0.2894197584599557,0.18296760631988152,0.11710781915140281,0.047331376483373155,0.35523401860661513,0.07541898453898944,0.22323033424315225,-0.1976494310635312,-0.2572625628169953,-0.049450911966868225,0.03342590301533204,0.04595899388800368,-0.19102558978454884,-0.02953736101820825,-0.26663760936135195,-0.18670508247065215,0.5415829240453595},
{-0.06516897886227566,0.16070539710781753,-0.25841469848644405,0.21796441105962894,-0.261802314064028,0.17141354072037104,0.26137659945072234,0.14023772677963955,-0.2346363602303377,0.02430038126859398,0.01277604874910519,0.269043214375584,0.22102406114379192,-0.2747059655102207,0.14527629328206043,-0.1763165461210283,-0.18494061653511287,-0.1019716639876255,-0.49055942776195915,-0.12398535892354146,0.25379248885863},
{0.2672956979475903,-0.06499730873372372,0.018826513550007064,-0.1770792117893642,-0.026663925073836657,-0.41196367693803554,0.21542970362955724,0.07380577903394353,0.36896980182061123,-0.41396630959008923,0.2010567718882571,0.047843705695129225,-0.0347610095610611,0.23842333317439848,0.17184509806549214,0.03037368673464058,-0.35677223096274024,-0.23078318024598618,-0.07496664381552214,0.08223257137366809,0.1966675267384312},
{-0.23697680614651756,-0.2960206166474355,0.11776202056406067,-0.4421486953560534,-0.11560122085761777,0.299713781231137,0.07661010869630329,0.0414121354161777,-0.16194117373279543,-0.15513614434955972,0.1876048136401985,-0.19441882513661823,-0.21699996801455176,0.012179226270829386,-0.024976928312446543,0.0313417890063108,0.03301007385789057,0.004304653673503384,-0.05361997041976594,-0.5529896103835236,0.2327308884522417},
{-0.3259238998132258,-0.19872017960048763,0.24216578815967546,0.25121877027580247,0.08366553190260902,-0.1194400249346321,-0.020668809036791844,-0.12100498376165898,-0.07291444138479135,0.05464165297258711,0.07421807450994576,0.1781281638392809,-0.3149882349365487,-0.15880577380517247,-0.22571432684982898,-0.3241874623340381,-0.01779795817985515,0.24423384377539123,0.03507431304555893,-0.27704450510924794,-0.48189334021200925},
{-0.017853318661743823,0.43061282234961573,-0.0358587452704352,0.018815353497271488,0.17049736859536427,0.3980876117332657,-0.03705381263632298,-0.1324442478775446,-0.40497037665176366,-0.09929986199129748,-0.36164198658189683,0.08014583639721906,0.3862823522555073,-0.1353330239774808,-0.07983786650514686,-0.17084102939437176,0.14009996150037768,0.08085964485113199,-0.24256238635918323,-0.08343391038004613,0.005730663349953179},
{-0.20202266595012353,0.07093938622135205,-0.11522296818735142,-0.33220907831780266,-0.2627231515704152,0.28146722607587593,-0.25218504835736216,-0.3363044641242942,-0.34741440332550094,-0.20862537736310777,0.20061051016915746,-0.116205235393899,-0.13637636623206864,0.09268735370203972,0.3463167071565049,0.17333033176424312,-0.11496949333865039,0.13065630983776222,0.19762416006322275,-0.10309872524174088,0.17452395762157455},
{0.2783061287265703,0.03722485192658302,0.05433592215707699,0.2834599103667865,-0.002970296039209947,0.08657440389295175,-0.18662806728460415,0.276227138728528,0.5490902895087415,0.034535163366995844,0.03720696750136165,0.12085301598968802,0.25084720210467376,0.11575405522078056,-0.30272265840912294,0.32432559238304165,-0.16815476235230908,-0.21781984148512715,-0.0896262651371638,-0.2033304871102865,-0.047864025926719594},
{-0.420368579223505,0.0553693198326158,0.11228967409625758,0.3604279290722278,-0.06164385201474161,-0.020160932750478606,0.2007074517222362,-0.14717112769095445,-0.13414364647933885,-0.10084536457475121,0.4541607921911721,-0.17568275170878445,0.06070336084259897,0.15328183725114713,-0.007062133735184592,-0.29491679948074206,-0.1363489790844622,-0.1422788968761562,-0.34934953401350866,0.0041215974449947,0.26676731138741927},
{0.2599594403046876,0.1524196727963274,0.17954684702718393,-0.006602374862773991,0.22825579704327317,-0.05434572607172229,-0.0811573289671895,-0.2294027483264494,-0.4026819140300641,-0.28370941900157826,-0.1263826966224049,-0.04560359501729725,0.2893793417349936,-0.13056186241097478,-0.4222690360048167,0.16643975988404602,-0.03974361982039806,0.11716787964169996,-0.21364925053899156,-0.19160852868557235,-0.312215479217162},
{-0.35571757673583226,0.006562208082837699,-0.044445405526385935,-0.1976505018155416,0.016948714225386345,0.15637777775849424,-0.27475268260349417,-0.13565369333477953,-0.3896288984835982,0.03150674505789786,-0.23351621612330875,-0.3316055147057979,-0.028814507777453504,0.20917806109171921,-0.3929965576282174,0.17701456543158353,0.018367728271924837,0.014983838839632013,-0.25885256475276985,0.20615427601817027,0.23668732990512478},
{0.37717808459347263,-0.0024322219613705427,0.06907888088808771,-0.09407781204568047,-0.11954731769769493,-0.222499311194383,-0.17591373781293643,0.13122420516996122,-0.6425653703697027,-0.09005938279484559,-0.20586327931130358,0.1113848458038235,0.06700692886511721,0.07197154603168777,0.07037179100898662,-0.32877459289103084,-0.03276397674441814,-0.13752187537107957,0.1898396422074778,-0.057264541791238965,-0.27265229407907376},
{0.44391804413640407,-0.1381105546866053,-0.09758791473559394,0.0185430096118385,-0.015338818684694824,-0.0858131469970339,-0.18303097393765794,0.20746313914989345,0.438420222579145,-0.06174358823421952,0.08212031712777364,-0.14844162099684236,-0.12819948593535166,0.37948480700198,0.18502003185427454,-0.00329776221484818,0.08179648655924378,-0.1400287486961795,0.0782145535222348,0.2521137444332978,-0.41759624429328057},
{0.09771030509828946,0.2613478108850809,0.26037098646276535,-0.1308604118502684,-0.25319857784760597,-0.03512569136242967,0.09182602451432774,-0.15018135367999091,0.19830520357782455,-0.024106777251212852,0.0860773316795999,-0.24974221947401276,-0.47992923101565993,0.23647583574926295,-0.03226205271742609,-0.14197732960684345,0.14296008994681933,-0.46004751377797215,-0.09059101649582349,0.284044794210793,-0.05287140131744955},
{0.2681280868866981,-0.2061241096360404,0.5013610557583925,0.26990021372666895,-0.26790224451079664,0.014492103436825134,-0.18237508734141722,-0.1065208132315561,0.3054303581219597,0.1938127452020286,0.06961872533683437,-0.04260856285097181,-0.2504685158408561,0.2259611140797243,-0.203426880452838,-0.32433717985049715,0.13238135669538661,0.07012078739976906,0.027500546622238175,-0.10420499527783789,-0.11349935095776693},
{0.05085274286167045,-0.08519918079901986,-0.19600486566814693,-0.10916762431884845,-0.3642664707726209,-0.018922335612063475,-0.6271358199918347,0.22183019103599852,0.010846222824572684,0.21473354841347994,-0.1856345523530953,-0.040733932041452564,-0.29089650194704403,-0.055656580472912845,-0.31050990557098185,-0.03194585725084759,0.019355393681532298,-0.22171221820992443,0.20530768924189105,0.04614269762449437,0.054307018429125775},
{-0.20824029312233702,0.15752804288565336,-0.15314391175321748,-0.14471642339977386,-0.31108847846346566,-0.09466755041392212,-0.0858637212194931,-0.0648620188248759,0.20754669957806182,-0.2540596584267801,-0.07498408936320389,0.30217778620788754,-0.07077797667636905,0.35464123592192165,-0.10306836359498393,-0.3652070148360915,-0.030486889665818195,-0.393254937760959,0.28842709965347835,0.19729669198119817,0.11435525934240806},
{0.23636458921209635,-0.13783987004432016,-0.03385322337962599,0.4975567476628078,-0.22556557534677468,-0.011499110522147294,0.17713166237233152,-0.16168085353213563,-0.19433750151439153,0.007093639475795772,-0.08985360965284242,-0.3532406615173111,-0.19328408868688376,-0.4061086939614676,0.15999464609026026,0.011823202399453132,-0.09310672493116465,-0.146215883147995,0.1543612074432896,0.017290448214820644,-0.3391598688317671},
{0.23521253200487433,0.17404890215517074,-0.12486014970197351,-0.0044738469636608534,0.2986613950670119,0.18639834393378082,0.3454648807847681,0.3002445201441654,0.3108223270033087,0.13696840850855327,0.06959470016888782,-0.11208765815099299,0.4498046601209276,0.06256439442292326,-0.3518712210882811,0.27125394842736505,0.028063586633918093,0.0891130104592596,-0.11179818599759812,-0.07993777796982508,-0.03619589554420605},
{-0.048565885557275104,0.12676811973002106,0.4047839348131959,0.1763049936366335,-0.22411947070651286,-0.3808906933787788,-0.15899947271050746,0.12383306152151659,-0.20452864189431247,-0.3415314530065326,-0.026520451814722578,0.09104960026235566,-0.2342010476293215,0.19197897353666957,0.034116093426436005,-0.25627601702001745,-0.1966304852963764,0.07318880738599687,-0.11397471187922999,-0.16675490289249598,0.3740066718832172},
{0.1456838456431807,0.38431133337418755,0.1685005613697282,-0.14896164097075798,-0.07537897286095943,-0.05307865366100331,0.09673634344483367,0.019083867926962858,0.04101029890464608,0.3152800254604181,0.30823941659253346,0.011502883921502612,-0.5101490770787079,0.026316679016603464,0.09194388268024839,-0.004244255392569667,0.17375726792308774,0.07486819695960505,0.17624990617313568,-0.005389374484434165,0.479316300998902},
{0.10500567824582038,-0.1997302892387706,-0.43357502460165154,-0.02109408184076506,-0.3521782567815197,-0.10787528360587795,0.2315342933551246,0.08281178839908615,0.40547397588660505,0.148718126473742,0.04499636231660784,0.02986373156471338,0.15466220554464746,0.21638419522401445,-0.12313241896751946,0.225591235606855,-0.2518306820769713,0.0839895390798851,-0.15844468553899,-0.06557672710175597,-0.3720223330239664},
{0.46883978743244203,-0.1961643454324634,-0.22572027055174076,-0.19949063794558766,-0.032321711680136096,-0.24018940405309527,0.19242437619844147,0.13231791451069944,-0.25569864426389294,0.11715618372471974,0.4914616929763766,-0.10637139962599299,0.10797107123629705,0.16114184299609843,-0.2686900592420252,0.19623321146146686,-0.012186060965993306,0.08407663567802248,0.1864406844189729,-0.04543241372403668,0.1156162404385065},
{-0.05073390568114859,-0.09180929534525402,0.22423889409272424,0.25207370927539113,-0.08637419847200546,-0.563142477564874,0.07453311762087633,0.21523689376806093,-0.3859920000518954,0.4367705477690301,-0.12976756223705666,0.005636098103001599,0.07292383515248729,-0.24711053710866,-0.1444133776331594,0.10198429822106152,-0.005457600955659229,0.1663224194395011,0.05281922131455988,-0.050656661358150834,0.1066990341732281},
{-0.15870405519034186,0.6022575275415067,0.06764744166814801,0.1552224338275898,-0.2350502611013525,-0.21175680020788587,0.2061067536020481,0.10101913449593682,-0.19402640937424842,0.027580531272136156,0.04091512710231279,0.011082070716044636,-0.056532471128166444,0.11829978900222589,0.11632433775251398,0.013807143871397889,-0.18195953272416598,-0.2278118966462737,0.2628901189089223,0.39419902975972493,-0.22366520108585497},
{-0.0058777117045737855,-0.07321625345579795,0.5720158233925702,0.2200899377973624,-0.24037770301898734,-0.03415069027786624,-0.16220961768432307,0.23237150981653162,0.14516121954637035,-0.303398868516603,-0.010725718755566561,0.11168615230378773,-0.03056854357850313,-0.07796939702495698,-0.10726534616746884,-0.2692125867482887,0.12478940875005796,-0.008927309863653579,-0.23815396603808622,0.42163130793006415,0.11339387912621877},
{0.12184760769931177,-0.18096288927206933,-0.16931340824852295,0.2204957252312119,0.09081206294455561,0.018051354410858714,-0.002258769150103733,-0.03048136565988229,-0.08729016553540563,-0.3173973431498161,0.253978618900577,0.10368276134817198,-0.4379402991937412,-0.5069847002094169,-0.2571110333565123,0.12357191818097646,0.09863150844323672,-0.014416094304763311,0.2048554114258423,-0.06763253463292006,0.30873970927173316},
{0.16303356486235032,-0.1423181396077669,-0.1815196979887898,0.20977209466679067,-0.41488053127760194,-0.12376942771461699,-0.37509790515689667,0.3923564890349959,-0.15095569827583658,-0.06786292587408313,-0.09512102399462766,-0.22692193041638145,-0.10463396811969436,-0.14633137711423566,-0.05110736778441736,0.21390957681099662,-0.2718755190042121,0.15276001398347,-0.27191898762962535,0.15130008279508142,0.17713424524343474},
{-0.05179314978384026,-0.33067935918530406,-0.10245991156377314,-0.18552985540814224,-0.07898784244671654,0.07379829256129002,-0.025549624426824635,0.4229836131982038,-0.23108122139601786,-0.21507135646255685,0.018967360277792236,-0.004929362382206668,0.11941246787352672,-0.24766603187015973,0.34151103624579304,-0.1844366396848328,-0.2527693575657572,0.14704701643294082,0.051795078486402794,-0.47335894248339394,-0.11509452464258244},
{-0.033654445634219425,-0.3447140107279341,0.2471369809925229,-0.1990412531924005,-0.2322119875013175,-0.036458560438505115,-0.06118390131658408,0.028114544534873363,0.07423310114378265,-0.3405173720444143,-0.29035457025966843,0.2176713519286083,0.10657520875891836,-0.39581220087657076,0.2635102016032514,-0.27963519730179187,0.1769811031879572,0.21963873951685522,0.020116800304580313,-0.19724889071002735,0.17853969158089816},
{-0.22135389086694732,-0.09655006191289778,-0.31181146555388395,-0.055343380482713665,0.4194286119640953,0.029494018886255687,0.18157772601889477,-0.42512441969518644,-0.06580303846009469,0.08547234641210526,0.041425324592715584,-0.11675238486282014,-0.27222611286887144,0.32120062186882825,0.11869365367756642,-0.10683734152025828,-0.06727127405917929,-0.2565904073468717,-0.2667143304994743,0.027611997657158344,-0.2808464109242409},
{0.15387916811788313,-0.23811314781275078,-0.03276690777222778,-0.26964252461527516,0.2764807987118511,-0.15094990726758523,0.15426579220090458,0.19148681146487673,-0.06061252613446416,0.18258943715523798,0.1912990779161599,0.3403381148834118,-0.18438589480697573,-0.39475098160987687,0.23813999811138603,-0.20108715579715136,-0.01983062932255361,-0.0006560341575825671,-0.05827033427630901,-0.42651173357543226,-0.15503936544382063},
{-0.05915355005760072,-0.12637995484308964,-0.23193196698986265,0.2448391338094776,0.14251323578158268,0.08708477911450781,0.23033258090196687,-0.0648079188375518,-0.30656327128214916,0.016990418336918892,0.33197039492890934,-0.21012458705109818,-0.018697956394068883,-0.23186991892970243,0.025545371638719512,-0.5382120633248473,0.10462943760372077,0.07257333642447891,-0.18664575031417338,-0.27061891434143076,0.25356158303165655}};

static param_t loda_delta[35] = {2.4804608877334298,2.277982024331476,2.114941545935445,2.311407932026667,1.7443266339761394,1.7680969367805937,2.491117883735126,1.6443118791214035,2.1564497797051216,3.0937451668402227,2.438517174663413,3.0681001104810566,2.5543330019390273,2.285570531861061,2.9166600942593592,2.9428695919127765,2.356751014051894,2.4392003313801505,2.656829753476529,3.8357800949504823,2.98394365928495,1.4928109781793213,2.3860506263165213,1.9822911122877207,1.5959742991951764,1.2409390611187328,2.3641901233728846,1.996349006030143,3.0246456231998606,3.0812553755014527,2.365638375405506,2.747356864888928,2.4804490813021904,3.1935070374102006,1.937093488970626};

const static score_t log_LUT_loda[128] = {15.0,7.0,6.0,5.415037499278844,5.0,4.678071905112637,4.415037499278844,4.192645077942396,4.0,3.830074998557688,3.678071905112638,3.5405683813627027,3.415037499278844,3.299560281858908,3.192645077942396,3.0931094043914813,3.0,2.9125371587496605,2.830074998557688,2.7520724865564143,2.678071905112638,2.6076825772212398,2.5405683813627027,2.476438043942987,2.415037499278844,2.356143810225275,2.299560281858908,2.2451124978365313,2.192645077942396,2.1420190048724277,2.0931094043914813,2.0458036896131246,2.0,1.9556058806415466,1.9125371587496607,1.8707169830550336,1.8300749985576876,1.7905466343710503,1.7520724865564146,1.7145977811377517,1.6780719051126376,1.6424479953819162,1.6076825772212398,1.573735245297902,1.5405683813627027,1.5081469036703252,1.4764380439429872,1.4454111483223626,1.415037499278844,1.3852901558847919,1.3561438102252752,1.3275746580285044,1.2995602818589078,1.2720795454368008,1.2451124978365316,1.2186402864753405,1.1926450779423958,1.1671099858352583,1.142019004872428,1.1173569506381587,1.0931094043914815,1.0692626624371138,1.0458036896131249,1.0227200765000835,1.0,0.9776321869715455,0.9556058806415466,0.9339108095422276,0.9125371587496606,0.891475543221831,0.8707169830550335,0.850252880495318,0.8300749985576876,0.8101754411199827,0.7905466343710502,0.7711813095041191,0.7520724865564145,0.7332134593050986,0.7145977811377517,0.6962192518228971,0.6780719051126376,0.6601499971153753,0.6424479953819163,0.6249605686530753,0.6076825772212398,0.5906090638622983,0.5737352452979021,0.5570565041512716,0.5405683813627027,0.5242665690336022,0.5081469036703252,0.49220535980130375,0.47643804394298717,0.4608411888919686,0.44541114832236267,0.4301443916690522,0.4150374992788438,0.40008715781287235,0.3852901558847918,0.37064337992039037,0.3561438102252753,0.34178851724820525,0.3275746580285044,0.31349947281678164,0.2995602818589079,0.28575448233387735,0.27207954543680085,0.25853301359885306,0.24511249783653147,0.23181567522307364,0.2186402864753404,0.20558413364989406,0.1926450779423959,0.1798210375848123,0.16710998583525832,0.1545099490556248,0.14201900487242788,0.12963528041659547,0.11735695063815874,0.1051822366920565,0.09310940439148148,0.0811367627254055,0.06926266243711372,0.05748549466076013,0.04580368961312479,0.03421571533791296,0.02272007650008353,0.011315313227834146};
#endif