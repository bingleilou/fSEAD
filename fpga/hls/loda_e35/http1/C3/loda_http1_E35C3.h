#ifndef LODA_GENERATOR_1_H_
#define LODA_GENERATOR_1_H_

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "ap_int.h"
#include "ap_fixed.h"
#include "hls_stream.h"
#include "hls_math.h"
#define W_WIDTH 32
#define I_WIDTH 16
typedef ap_fixed<W_WIDTH,I_WIDTH> interface_t;
    
typedef ap_fixed<32,16> accum_t;
typedef ap_fixed<32,16> param_t;
typedef ap_fixed<32,16> score_t;
typedef ap_uint<16> const_t;
typedef ap_uint<8> char_t;

struct DataBus_IN {
    float data;
    ap_uint<1> last;
};

struct DataBus_OUT {
    float data;
    ap_uint<1> last;
};
    
void loda_http1_c3(
    hls::stream<DataBus_IN> &data,
    hls::stream<DataBus_OUT> &score_loda
);
    
#define ENSEMBLE 35
#define DIM_MAX 3
#define BATCH_SIZE 128
#define N_BINS 20
const static param_t bottom_loda = 0.8953576384868612;
const static param_t delta_loda = 0.07089864275670443;
static param_t loda_min_X[35] = {-9.285591187615026,-3.4259814173538943,-10.526887611000781,-8.683985396203614,-6.506869393718354,-10.134511071332575,-10.792403123919035,-9.934246285263333,-3.318805499853226,-11.218404436193477,-6.380991994952639,-2.810182937470143,-3.473517529284982,-3.941608005555731,-9.342499014173367,-10.948171865282061,-7.346023685583185,-10.716938614594035,-16.141936224011577,-3.9279592854981025,-12.830368211356904,-7.462147688525101,-12.581044472582862,-3.619056597636824,-6.8151834865317875,-3.4535587123133284,-12.545232524289364,-2.85427594038475,-10.30516372880559,-5.742012159299984,-8.341105340677684,-10.70341408817179,-4.903041597026094,-8.18889859269645,-4.762316373197815};

static param_t loda_projections[35][3] = {{0.577363607141585,0.3728253132640904,-0.7263969651216821},
{-0.0023010446115965576,0.9931131674047556,-0.11713642439902776},
{-0.5976294099620055,-0.8014530280969299,-0.022630335895141095},
{-0.5324711202685518,-0.8118814837913879,0.2394221425780158},
{0.3290746375322806,-0.3444738500403361,0.8792312833216219},
{-0.23060652877242427,-0.9172233398299028,0.32484145942107145},
{0.787327721742508,-0.2420875904458547,-0.5670173340629652},
{0.6400347349295388,-0.7343138269820447,0.22613876621813153},
{-0.1335638631347885,0.8793102045207293,0.45713702397664624},
{0.17137265142671923,-0.9804503583452332,0.0966876887906618},
{0.07790768822282973,-0.377014495076358,0.9229249496129645},
{-0.7058700571769531,0.7071511630644436,-0.041045035724306754},
{-0.3228656112781881,0.9218558565352837,-0.21433519735582485},
{0.5503456240108303,0.6870613459929921,0.4744116366347138},
{-0.9538170157241196,-0.29890653026380004,0.02979910536896514},
{0.11959160380255664,0.5017101674211578,-0.8567291031628177},
{-0.9639099215929606,-0.008810364916718619,0.26608277006354},
{0.4950391070325676,-0.8611935294931056,0.11524750438775397},
{-0.5239168720236923,-0.21525121430519367,-0.824122579443768},
{0.7654221039923049,-0.06391241326915524,0.6403469420166742},
{0.30563565613077354,-0.9249858068993766,-0.22580545329159038},
{0.8069149074089786,0.3158833737738543,-0.4991052257534547},
{-0.4320705062950274,-0.8779110976855236,-0.2063666207276698},
{0.21179917832543407,0.5566263449071527,0.8033107868166433},
{0.8349404152274812,0.36058655400860296,-0.4157545430755536},
{0.11825722767375904,0.8165002961412019,0.5651039678716177},
{0.5072165168707558,0.02682271619178984,-0.8614011533017547},
{-0.09693525459230803,0.18564659078107745,0.9778235524615305},
{0.4342219220934539,0.3537135446879777,-0.8284552194764255},
{-0.6748336180999045,0.11292031702140397,0.7292795005249891},
{-0.8709837731029385,0.3456046705195334,-0.3492057827505918},
{0.7589278041277377,-0.5857878726686798,-0.284396125775568},
{0.6045764896559831,0.7767997558390881,-0.17626516242179552},
{-0.11098897718800432,0.7080647384154033,-0.6973706139173683},
{0.8418120948827723,0.5129134771654563,-0.16814327774585408}};

static param_t loda_delta[35] = {1.1763835924636656,1.3851291908077894,1.4492226178798675,1.4165419184053787,0.9992736983032466,1.2537969105591378,1.2319334531434012,1.5146667732828356,1.1532194371879587,1.4259110683115843,1.017125505766861,1.6425581815154713,1.362575607861113,1.1645927129317437,1.597677394174189,1.1067908092810381,1.529399448851585,1.5004070074505969,1.0130918821084962,1.210461179084816,1.2474395883563651,1.2550897991012502,1.2443564321195737,0.9870754530719897,1.2874107836087179,1.1253487530563633,1.099315136133204,1.0282981077783175,1.1655989345169027,1.1297663196853347,1.343403046142189,1.4205102946833903,1.4545620274275497,1.1295476036464203,1.4500424873106506};

const static score_t log_LUT_loda[128] = {15.0,7.0,6.0,5.415037499278844,5.0,4.678071905112637,4.415037499278844,4.192645077942396,4.0,3.830074998557688,3.678071905112638,3.5405683813627027,3.415037499278844,3.299560281858908,3.192645077942396,3.0931094043914813,3.0,2.9125371587496605,2.830074998557688,2.7520724865564143,2.678071905112638,2.6076825772212398,2.5405683813627027,2.476438043942987,2.415037499278844,2.356143810225275,2.299560281858908,2.2451124978365313,2.192645077942396,2.1420190048724277,2.0931094043914813,2.0458036896131246,2.0,1.9556058806415466,1.9125371587496607,1.8707169830550336,1.8300749985576876,1.7905466343710503,1.7520724865564146,1.7145977811377517,1.6780719051126376,1.6424479953819162,1.6076825772212398,1.573735245297902,1.5405683813627027,1.5081469036703252,1.4764380439429872,1.4454111483223626,1.415037499278844,1.3852901558847919,1.3561438102252752,1.3275746580285044,1.2995602818589078,1.2720795454368008,1.2451124978365316,1.2186402864753405,1.1926450779423958,1.1671099858352583,1.142019004872428,1.1173569506381587,1.0931094043914815,1.0692626624371138,1.0458036896131249,1.0227200765000835,1.0,0.9776321869715455,0.9556058806415466,0.9339108095422276,0.9125371587496606,0.891475543221831,0.8707169830550335,0.850252880495318,0.8300749985576876,0.8101754411199827,0.7905466343710502,0.7711813095041191,0.7520724865564145,0.7332134593050986,0.7145977811377517,0.6962192518228971,0.6780719051126376,0.6601499971153753,0.6424479953819163,0.6249605686530753,0.6076825772212398,0.5906090638622983,0.5737352452979021,0.5570565041512716,0.5405683813627027,0.5242665690336022,0.5081469036703252,0.49220535980130375,0.47643804394298717,0.4608411888919686,0.44541114832236267,0.4301443916690522,0.4150374992788438,0.40008715781287235,0.3852901558847918,0.37064337992039037,0.3561438102252753,0.34178851724820525,0.3275746580285044,0.31349947281678164,0.2995602818589079,0.28575448233387735,0.27207954543680085,0.25853301359885306,0.24511249783653147,0.23181567522307364,0.2186402864753404,0.20558413364989406,0.1926450779423959,0.1798210375848123,0.16710998583525832,0.1545099490556248,0.14201900487242788,0.12963528041659547,0.11735695063815874,0.1051822366920565,0.09310940439148148,0.0811367627254055,0.06926266243711372,0.05748549466076013,0.04580368961312479,0.03421571533791296,0.02272007650008353,0.011315313227834146};
#endif